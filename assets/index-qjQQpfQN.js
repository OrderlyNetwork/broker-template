import{b3 as Li,b4 as _n,_ as G,b5 as Ze,B as y,M as z,ae as Lt,aM as wn,aN as vn,a7 as J,q as F,D as p,au as Ot,aR as Nn,N as be,as as Q,af as Yi,T as Gi,y as $e,a3 as Cn,al as Sn,am as Pn,H as D,aL as Xi,b6 as Ji,j as Je,u as Zi,h as ht,g as we,G as Oi,f as Jt,b7 as Ln,k as er,ax as On,m as tr,b8 as ir,o as kn,b9 as vt,ba as Dn,V as Ie,bb as Tn,bc as In,ag as Kt,a8 as rr,a9 as nr,aa as qn,ab as sr,bd as or,A as Ge,be as En,C as Mn,ad as he,bf as An,c as Ee,bg as Zt,$ as ve,I as ar,s as W,aT as ei,bh as ti,aV as ii,r as $n,Z as B,bi as je,bj as lr,S as zn,bk as Fn,bl as fe,bm as ue,a0 as Se,bn as et,bo as ri,bp as Rn,bq as Un,br as Ut,bs as Wn,bt as ur,J as kt,bu as xt,bv as Dt,bw as _e,W as dr,bx as Bn,by as X,bz as ie,bA as Qn,bB as Vn,av as Xe,aQ as gt,b0 as Hn,b2 as Kn,bC as cr,bD as pr,bE as mr,bF as ee,bG as Yn,a4 as fr,bH as Gn,bI as Xn,bJ as Z,aI as hr,bK as Jn,bL as Zn,bM as es,bN as ts,ap as Yt,bO as is,bP as rs,aO as ni,bQ as ns,bR as xr,bS as ss,bT as os,bU as as}from"./index-B30QhG-o.js";import{j as t,r as c}from"./jsx-runtime-CXrgMc3u.js";import{w as si,T as ls,Y as Tt}from"./index-B8pojRXq.js";import{T as gr,M as us,o as It}from"./index-FUobFp-t.js";function yr(e,i){const r=Li(e),n=Li(i),s=ki(r,n),o=Math.abs(_n(r,n));r.setDate(r.getDate()-s*o);const a=+(ki(r,n)===-s),l=s*(o-a);return l===0?0:l}function ki(e,i){const r=e.getFullYear()-i.getFullYear()||e.getMonth()-i.getMonth()||e.getDate()-i.getDate()||e.getHours()-i.getHours()||e.getMinutes()-i.getMinutes()||e.getSeconds()-i.getSeconds()||e.getMilliseconds()-i.getMilliseconds();return r<0?-1:r>0?1:r}var ds=e=>{let{currentLeverage:i=0}=e;return t.jsxs(y,{itemAlign:"start",direction:"column",mb:0,children:[t.jsx(cs,{currentLeverage:i}),t.jsx(ps,{...e}),t.jsxs(y,{direction:"row",gap:2,width:"100%",mt:0,pt:5,children:[t.jsx(J,{variant:"contained",color:"gray",fullWidth:!0,onClick:e.onCancel,"data-testid":"oui-testid-leverage-cancel-btn",children:"Cancel"}),t.jsx(J,{fullWidth:!0,loading:e.isLoading,onClick:e.onSave,"data-testid":"oui-testid-leverage-save-btn",children:"Save"})]})]})},cs=e=>t.jsxs(y,{justify:"between",width:"100%",children:[t.jsx(p,{as:"div",size:"sm",intensity:54,className:"oui-mt-2",children:"Max account leverage"}),t.jsxs(y,{direction:"row",gap:1,children:[t.jsx(p,{size:"sm",intensity:54,children:"Current:"}),t.jsx(p.numeral,{unit:"x",size:"sm",intensity:80,children:e.currentLeverage??"--"})]})]}),ps=e=>t.jsxs(G,{pt:3,width:"100%",className:e.className,children:[t.jsx(Ze,{max:e.maxLeverage,markCount:5,value:[e.value],onValueChange:i=>{e.onLeverageChange(i[0]),e.setShowSliderTip(!0)},color:"primary",onValueCommit:i=>{var r;(r=e.onValueCommit)==null||r.call(e,i),e.setShowSliderTip(!1)},showTip:e.showSliderTip,tipFormatter:(i,r,n,s)=>`${Math.max(1,i)}x`}),t.jsx(y,{justify:"between",width:"100%",pt:3,children:[1,10,20,30,40,50].map((i,r)=>t.jsx("button",{onClick:n=>{var s;e.onLeverageChange(i),(s=e.onValueCommit)==null||s.call(e,[i])},className:z(" oui-text-2xs oui-pb-3",r===0?"oui-pr-2":r===5?"oui-pl-0":"oui-px-0 oui-ml-2",e.value>=i&&"oui-text-primary-light"),"data-testid":`oui-testid-leverage-${i}-btn`,children:`${i}x`}))})]}),ms=e=>{let{currentLeverage:i}=wn(),[r,n]=c.useState(!1),[s,{update:o,config:a,isMutating:l}]=vn(),u=c.useMemo(()=>(a==null?void 0:a.map(g=>({label:`${g}x`,value:g})))||[],[a]),[d,f]=c.useState(s??0),h=a==null?void 0:a.reduce((g,j)=>Math.max(g,Number(j),0),0),x=100/(((u==null?void 0:u.length)||0)-1),b=g=>{f(g)},m=async()=>{try{o({leverage:d}).then(g=>{var j;(j=e==null?void 0:e.close)==null||j.call(e),F.success("Leverage updated")},g=>{F.error(g.message)})}catch{}};return{currentLeverage:i,value:d,marks:u,onLeverageChange:b,step:x,onCancel:e==null?void 0:e.close,onSave:m,isLoading:l,showSliderTip:r,setShowSliderTip:n,maxLeverage:h}},fs=e=>{let i=ms({close:e.close});return t.jsx(ds,{...i})},hs="leverageEditor";Lt(hs,fs,{title:"Max account leverage",size:"md"});function xs(e,i){let[r,n]=c.useState(""),[s,o]=c.useState(!1);return c.useEffect(()=>{s||typeof i!="function"||(o(!0),i(e.address,e.decimals).then(a=>{n(a)}).catch(a=>{}).finally(()=>{o(!1)}))},[e]),{balance:r,loading:s}}var gs=e=>{let{token:i,isActive:r,onTokenChange:n,fetchBalance:s}=e,{symbol:o,precision:a,decimals:l}=i,{balance:u,loading:d}=xs(i,s),f=typeof s=="function",h=a??2,x=()=>f?d?t.jsx(Ot,{size:"sm"}):t.jsx(p.numeral,{rule:"price",dp:h,rm:D.ROUND_DOWN,className:z("oui-text-base-contrast-80 group-hover:oui-text-base-contrast-54",r&&"oui-text-base-contrast-54"),children:u}):null;return t.jsxs(y,{justify:"between",px:2,r:"base",className:z("group","oui-h-[30px] hover:oui-bg-base-5","oui-text-2xs oui-font-semibold","oui-cursor-pointer",r&&"oui-bg-base-5",e.index!==0&&"oui-mt-[2px]"),onClick:()=>{n==null||n(i)},children:[t.jsxs(y,{gapX:1,children:[t.jsx(Cn,{name:o,className:"oui-w-[16px] oui-h-[16px]"}),t.jsx(p,{className:z("oui-text-base-contrast-54 group-hover:oui-text-base-contrast-80",r&&"oui-text-base-contrast-80"),children:o})]}),x()]},o)},Nt=c.forwardRef((e,i)=>{let{token:r,tokens:n=[],classNames:s,label:o,status:a,hintMessage:l,value:u,onValueChange:d,onTokenChange:f,fetchBalance:h,loading:x,placeholder:b,...m}=e,g=c.useRef(null),[j,_]=c.useState(!1),[w,v]=c.useState(0),L=c.useMemo(()=>n.map(P=>({...P,name:P.display_name||P.symbol})),[n]);c.useEffect(()=>{var E;let P=(E=g==null?void 0:g.current)==null?void 0:E.getBoundingClientRect();v((P==null?void 0:P.width)||0)},[g]);let q=P=>{let E=n.find(M=>M.symbol===P);E&&(f==null||f(E))},O=P=>{let E=P.symbol===(r==null?void 0:r.symbol);return t.jsx(gs,{token:P,fetchBalance:h,onTokenChange:M=>{f==null||f(M),_(!1)},isActive:E})},T=t.jsxs(G,{children:[t.jsx(G,{className:"oui-absolute oui-top-0",children:t.jsx(p,{size:"2xs",intensity:36,children:o||"Quantity"})}),x&&t.jsx(G,{className:"oui-absolute oui-bottom-1",children:t.jsx(Ot,{size:"sm"})})]}),N=n.length>1,C=t.jsx("div",{className:"oui-absolute oui-right-0",children:t.jsx(Nn.tokens,{open:N?j:!1,onOpenChange:_,disabled:m.disabled,variant:"text",tokens:L,value:(r==null?void 0:r.display_name)||(r==null?void 0:r.symbol),size:m.size,onValueChange:q,showIcon:!0,optionRenderer:O,contentProps:{onCloseAutoFocus:P=>{var E;P.preventDefault(),(E=g.current)==null||E.focus()},onClick:P=>{var E;P.preventDefault(),(E=g.current)==null||E.focus()},style:{width:w},align:"end",sideOffset:5,className:"oui-border oui-border-line-6"}})}),S=t.jsxs(y,{mt:1,gapX:1,px:1,children:[t.jsx(G,{width:4,height:4,r:"full",className:z(a==="error"&&"oui-bg-danger-light",a==="warning"&&"oui-bg-warning-light")}),t.jsx(p,{size:"2xs",className:z(a==="error"&&"oui-text-danger-light",a==="warning"&&"oui-text-warning-light"),children:l})]}),I=b??(x?"":"0");return t.jsxs(t.Fragment,{children:[t.jsx(be,{"data-testid":e.testId,ref:g,autoComplete:"off",placeholder:I,prefix:T,suffix:C,value:u,onValueChange:P=>{var E;(E=e.onValueChange)==null||E.call(e,P)},formatters:[Q.numberFormatter,Q.dpFormatter((r==null?void 0:r.precision)??2),Q.currencyFormatter],...m,classNames:{...s,root:z("oui-h-[54px] oui-relative oui-px-3","oui-border oui-border-line oui-rounded-lg",a==="error"&&"focus-within:oui-outline-danger-light oui-outline-danger-light",a==="warning"&&"focus-within:oui-outline-warning-light oui-outline-warning-light",e.readOnly?"oui-bg-base-6 focus-within:oui-outline-0 oui-border-none":"oui-bg-base-5",s==null?void 0:s.root),input:z("oui-absolute oui-bottom-0",s==null?void 0:s.input)}}),l&&S]})}),ys=e=>t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M10.997 8.004a.5.5 0 0 0-.14-.36l-1.86-1.843-.703.703.984 1h-7.28a.5.5 0 0 0 0 1h7.28l-.984 1 .703.703 1.86-1.844a.5.5 0 0 0 .14-.36m-.5-4a.5.5 0 0 0-.5-.5H2.716l.984-1-.703-.703-1.859 1.843a.515.515 0 0 0 0 .719l1.86 1.844.702-.703-.984-1h7.281a.5.5 0 0 0 .5-.5"})}),bs=e=>t.jsx("svg",{width:"20",height:"21",viewBox:"0 0 20 21",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M9.994 5.51a.83.83 0 0 0-.832.833v6.295l-2.498-2.471-1.17 1.17 3.902 3.929a.84.84 0 0 0 .599.244.84.84 0 0 0 .597-.244l3.903-3.928-1.171-1.171-2.498 2.471V6.343a.83.83 0 0 0-.832-.833"})}),js=e=>t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M4.078 1.744a2.333 2.333 0 0 0-2.333 2.333v5.834a2.333 2.333 0 0 0 2.333 2.333h5.833a2.333 2.333 0 0 0 2.334-2.333V4.077A2.333 2.333 0 0 0 9.91 1.744zm2.917 2.333c.322 0 .583.262.583.584v2.916h1.75L6.995 9.911 4.66 7.577h1.75V4.661c0-.322.262-.584.584-.584"})}),_s=e=>t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M4.078 12.244a2.333 2.333 0 0 1-2.333-2.333V4.077a2.333 2.333 0 0 1 2.333-2.333h5.833a2.333 2.333 0 0 1 2.334 2.333v5.834a2.333 2.333 0 0 1-2.334 2.333zm2.917-2.333a.584.584 0 0 0 .583-.584V6.411h1.75L6.995 4.077 4.66 6.411h1.75v2.916c0 .322.262.584.584.584"})}),ws=e=>t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M6.00342 1.49561C4.97642 1.49561 3.99542 1.84011 3.20642 2.46461C2.98992 2.63561 2.95692 2.9511 3.12842 3.1676C3.29992 3.3841 3.61492 3.4171 3.83142 3.2456C4.44492 2.7601 5.20392 2.4956 6.00342 2.4956C7.93642 2.4956 9.50342 4.0626 9.50342 5.9956H8.50342L10.0034 7.9956L11.5034 5.9956H10.5034C10.5034 3.5101 8.48892 1.49561 6.00342 1.49561ZM2.00342 3.9956L0.503418 5.9956H1.50342C1.50342 8.4811 3.51792 10.4956 6.00342 10.4956C7.03092 10.4956 8.01142 10.1516 8.80042 9.52659C9.01692 9.35559 9.04992 9.0401 8.87842 8.8236C8.70692 8.6071 8.39191 8.5741 8.17542 8.7456C7.56142 9.2316 6.80342 9.4956 6.00342 9.4956C4.07042 9.4956 2.50342 7.9286 2.50342 5.9956H3.50342L2.00342 3.9956Z"})}),br=e=>{var b,m;let{chains:i,value:r,wrongNetwork:n,loading:s}=e,[o,a]=c.useState(!1),l=n||(i==null?void 0:i.length)>1,u=n?t.jsx(y,{width:18,height:18,intensity:100,r:"full",justify:"center",itemAlign:"center",children:t.jsx(p,{size:"2xs",intensity:80,children:"U"})}):t.jsx(Kt,{className:"oui-w-[18px] oui-h-[18px]",chainId:r==null?void 0:r.id}),d=n?"Unknown":(m=(b=r==null?void 0:r.info)==null?void 0:b.network_infos)==null?void 0:m.name,f=()=>{if(s)return t.jsx(Ot,{size:"sm"});if(l)return t.jsx(ys,{className:"oui-text-base-contrast-54"})},h=t.jsxs(y,{intensity:500,className:z("oui-rounded-t-xl oui-rounded-b-sm oui-border oui-border-line",l?"oui-cursor-pointer":"oui-cursor-auto"),height:54,px:3,justify:"between",itemAlign:"center",children:[t.jsxs("div",{children:[t.jsx(y,{children:t.jsx(p,{size:"2xs",intensity:54,children:"Network"})}),t.jsxs(y,{gapX:1,children:[u,t.jsx(p,{size:"sm",intensity:80,children:d})]})]}),f()]}),x=i.map((g,j)=>{let _=g.chain_id===(r==null?void 0:r.id);return t.jsxs(y,{px:2,r:"base",justify:"between",className:z("oui-deposit-network-select-item","hover:oui-bg-base-5 oui-h-[30px] oui-cursor-pointer",_&&"oui-bg-base-5",j!==0&&"oui-mt-[2px]"),onClick:async()=>{a(!1),await e.onValueChange(g)},children:[t.jsxs(y,{gapX:1,itemAlign:"center",children:[t.jsx(Kt,{className:"oui-w-[18px] oui-h-[18px]",chainId:g.chain_id}),t.jsx(p,{size:"2xs",intensity:54,children:g.name}),g.bridgeless&&t.jsx(y,{className:"oui-bg-success-light/15",height:18,px:2,r:"base",justify:"center",itemAlign:"center",children:t.jsx(p,{size:"2xs",className:"oui-text-success-light",children:"lowest fee"})})]}),_&&t.jsx(G,{width:4,height:4,r:"full",className:"oui-deposit-network-select-active-dot oui-bg-[linear-gradient(270deg,#59B0FE_0%,#26FEFE_100%)]"})]},g.chain_id)});return t.jsxs(rr,{open:l?o:!1,onOpenChange:a,children:[t.jsx(nr,{asChild:!0,children:h}),t.jsx(qn,{children:t.jsx(sr,{onCloseAutoFocus:g=>g.preventDefault(),align:"start",sideOffset:2,className:z("oui-deposit-token-select-dropdown-menu-content","oui-bg-base-8 oui-p-1","oui-w-[var(--radix-dropdown-menu-trigger-width)]","oui-rounded-md oui-select-none"),children:t.jsx(or,{children:t.jsxs("div",{className:"oui-max-h-[254px]",children:[x," "]})})})})]})},jr=()=>t.jsxs(y,{height:40,gapX:3,children:[t.jsx(y,{height:1,className:"oui-bg-base-contrast-12 oui-flex-1"}),t.jsx(bs,{className:"oui-text-primary-light"}),t.jsx(y,{height:1,className:"oui-bg-base-contrast-12 oui-flex-1"})]});function vs(e){return e?e.replace(/^(.{6})(.*)(.{4})$/,"$1......$3"):"--"}var Ns=(e=[])=>{let i=e.reduce((r,n)=>(r[n.symbol]=n,r),{});return i.USDC||i.USDbC||e[0]},Cs=e=>e+3,_r=()=>{let{wallet:e}=Jt(),{walletName:i,address:r}=c.useMemo(()=>{var n;return{walletName:e==null?void 0:e.label,address:vs((n=e==null?void 0:e.accounts)==null?void 0:n[0].address)}},[e]);return t.jsxs(y,{justify:"between",children:[t.jsx(p,{size:"sm",intensity:98,children:"Your Web3 Wallet"}),t.jsxs(y,{gapX:1,children:[t.jsx(In,{size:"xs",name:i}),t.jsx(p,{size:"sm",intensity:54,children:r})]})]})},wr=()=>{let{appIcons:e}=ls(),i=Je("brokerName"),r=c.useMemo(()=>{let{secondary:n}=e||{};if(!(n!=null&&n.img)&&(n!=null&&n.component))return null;if(n!=null&&n.img)return t.jsx("img",{src:n==null?void 0:n.img,className:"oui-w-5 oui-h-5"});if(n!=null&&n.component)return t.jsx(t.Fragment,{children:n.component})},[e]);return t.jsxs(y,{justify:"between",children:[t.jsx(p,{size:"sm",intensity:98,children:`Your ${i} account`}),r]})},vr=e=>{let{amount:i,maxQuantity:r,token:n,loading:s}=e,o=(n==null?void 0:n.display_name)||(n==null?void 0:n.symbol)||"",a=(n==null?void 0:n.precision)??2;return t.jsxs(y,{justify:"between",px:2,children:[t.jsxs(p,{size:"2xs",intensity:36,children:["$",t.jsx(p.numeral,{dp:2,padding:!1,rm:D.ROUND_DOWN,children:i})]}),t.jsxs(y,{gapX:2,children:[t.jsxs(p,{size:"2xs",intensity:36,children:["Available:"," ",t.jsx(p.numeral,{rm:D.ROUND_DOWN,dp:a,padding:!1,"data-testid":"oui-testid-withdraw_deposit-dialog-available-value",children:r})," ",o]}),s&&t.jsx(Ot,{size:"sm"}),t.jsx(p,{size:"2xs",color:"primary",className:"oui-cursor-pointer oui-select-none",onClick:e.onClick,children:"Max"})]})]})},Ss=e=>{let{token:i,dst:r,price:n}=e,s=(i==null?void 0:i.display_name)||(i==null?void 0:i.symbol)||"USDC";return t.jsx(y,{children:t.jsxs(p,{size:"xs",intensity:36,className:e.className,children:[t.jsx(p,{size:"xs",intensity:80,children:"1"}),` ${s} = `,n?t.jsx(p.numeral,{size:"xs",intensity:80,dp:3,padding:!1,children:n}):"-",` ${r==null?void 0:r.symbol}`]})})},Ps=e=>{let{dstGasFee:i,feeQty:r,feeAmount:n,dp:s,nativeSymbol:o}=e,a=()=>{let u=t.jsxs("div",{className:"oui-text-2xs",children:[t.jsxs(y,{gapX:1,children:[t.jsx(p,{intensity:54,children:"Destination gas fee:"}),t.jsx(p.numeral,{intensity:80,dp:s,rm:D.ROUND_UP,padding:!1,children:r}),t.jsx(p,{intensity:54,children:o})]}),t.jsx(G,{mt:2,children:t.jsx(p,{intensity:36,children:"Additional gas tokens are required to cover operations on the destination chain."})})]});he.alert({title:"Fee",message:u})},l=!!i&&i!=="0";return t.jsxs(p,{size:"xs",intensity:36,className:"oui-border-dashed oui-border-b oui-border-line-12 oui-cursor-pointer",onClick:a,children:["Fee ≈ ",t.jsxs(p,{size:"xs",intensity:80,children:["$",t.jsx(p.numeral,{dp:2,padding:!1,rm:D.ROUND_UP,children:n})," "]}),l&&t.jsxs("span",{children:["(",t.jsxs(p,{intensity:54,children:[t.jsx(p.numeral,{dp:s,padding:!1,rm:D.ROUND_UP,children:r}),o]}),")"]})]})},Ls=(e=>(e[e.Deposit=0]="Deposit",e[e.Approve=1]="Approve",e[e.Increase=2]="Increase",e))(Ls||{}),Os=e=>{let{disabled:i,loading:r,actionType:n,symbol:s="USDC",onDeposit:o,onApprove:a,networkId:l}=e,u=c.useMemo(()=>({1:{children:`Approve ${s}`,onClick:a,disabled:!1,"data-testid":"oui-testid-deposit-dialog-approve-btn"},2:{children:`increase ${s} authorized amount`,onClick:a,"data-testid":"oui-testid-deposit-dialog-increase-btn"},0:{children:"Deposit",onClick:o,"data-testid":"oui-testid-deposit-dialog-deposit-btn"}})[n],[a,o,n,s]),d={initial:"md",lg:"lg"};return t.jsx(G,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:t.jsx(gr,{status:Ge.EnableTrading,networkId:l,buttonProps:{fullWidth:!0,size:d},children:t.jsx(J,{fullWidth:!0,disabled:i,loading:r,size:d,...u})})})},ks=e=>{let{token:i,tokens:r,onTokenChange:n,amount:s,quantity:o,maxQuantity:a,onQuantityChange:l,hintMessage:u,inputStatus:d,chains:f,currentChain:h,settingChain:x,onChainChange:b,actionType:m,onDeposit:g,onApprove:j,fetchBalance:_,dst:w,wrongNetwork:v,balanceRevalidating:L,loading:q,disabled:O,networkId:T,fee:N}=e;return t.jsxs(G,{id:"oui-deposit-form",className:vt({weight:"semibold"}),children:[t.jsxs(G,{className:"oui-mb-6 lg:oui-mb-8",children:[t.jsx(_r,{}),t.jsxs(G,{mt:3,mb:1,children:[t.jsx(br,{chains:f,value:h,onValueChange:b,wrongNetwork:v,loading:x}),t.jsx(Nt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},value:o,onValueChange:l,tokens:r,token:i,onTokenChange:n,status:d,hintMessage:u,fetchBalance:_,"data-testId":"oui-testid-deposit-dialog-quantity-input"})]}),t.jsx(vr,{token:i,amount:s,maxQuantity:a,loading:L,onClick:()=>{l(a)}}),t.jsx(jr,{}),t.jsx(wr,{}),t.jsx(Nt,{readOnly:!0,token:w,value:o,classNames:{root:"oui-mt-3 oui-border-transparent focus-within:oui-outline-transparent"}}),t.jsxs(y,{direction:"column",mt:1,gapY:1,itemAlign:"start",children:[t.jsx(Ss,{token:i,dst:w,price:1}),t.jsx(Ps,{...N})]})]}),t.jsx(y,{justify:"center",children:t.jsx(Os,{actionType:m,symbol:i==null?void 0:i.symbol,disabled:O,loading:q,onDeposit:g,onApprove:j,networkId:T})})]})};function Ds(e){let{isNativeToken:i,allowance:r,quantity:n,maxQuantity:s}=e;return c.useMemo(()=>{let o=i?Number.MAX_VALUE:Number(r);if(o<=0)return 1;let a=Number(n),l=Number(s);return o<a&&a<=l?2:0},[i,r,n,s])}function Ts(){let e=Je("networkId"),[i]=we("orderly_selected_chainId",void 0),{connectedChain:r,settingChain:n,setChain:s}=Jt(),[o,{findByChainId:a}]=er(e,{pick:"network_infos",filter:d=>{var f,h;return((f=d.network_infos)==null?void 0:f.bridge_enable)||((h=d.network_infos)==null?void 0:h.bridgeless)}}),l=c.useMemo(()=>{let d=r?tr(r.id):parseInt(i);if(!d)return null;let f=a(d);return{...r,id:d,info:f}},[a,r,i]),u=c.useCallback(async d=>{var h,x;let f=a(d.chain_id);if(r)return!f||((h=f.network_infos)==null?void 0:h.chain_id)===(l==null?void 0:l.id)?Promise.resolve():s({chainId:ir(Number((x=f.network_infos)==null?void 0:x.chain_id))}).then(b=>{b?F.success("Network switched"):F.error("Switch chain failed")}).catch(b=>{b&&b.message&&F.error(`Switch chain failed: ${b.message}`)})},[l,s,a]);return{chains:o,currentChain:l,settingChain:n,onChainChange:u}}function Is(e){let{quantity:i,allowance:r,approve:n,deposit:s,enableCustomDeposit:o,customDeposit:a,onSuccess:l}=e,[u,d]=c.useState(!1),f=Zi(),h=c.useCallback(async()=>{if(!u)return d(!0),n(i).then(m=>{F.success("Approve success")}).catch(m=>{F.error(m.message||m.errorCode||"Approve failed")}).finally(()=>{d(!1)})},[n,u,i,r]),x=c.useCallback(async()=>s().then(m=>{F.success("Deposit requested"),f.emit("deposit:requested"),l==null||l()}).catch(m=>{F.error(m.message||m.errorCode||"Deposit failed")}),[s,l]),b=c.useCallback(()=>{var g,j;let m=Number(i);if(isNaN(m)||m<=0){F.error("Please input a valid number");return}u||(d(!0),(j=(g=o?a:x)==null?void 0:g())==null||j.finally(()=>{d(!1)}))},[i,u,x,o,a]);return{submitting:u,onApprove:h,onDeposit:b}}function qs(e){let{quantity:i,maxQuantity:r}=e,[n,s]=c.useState("default"),[o,a]=c.useState();return c.useEffect(()=>{if(!i){s("default"),a("");return}new D(i).gt(r)?(s("error"),a("Insufficient balance")):(s("default"),a(""))},[i,r]),{inputStatus:n,hintMessage:o}}function Es(e){let{currentChain:i,tokensFilter:r}=e,[n,s]=c.useState(),[o,a]=c.useState([]),l=c.useCallback(u=>{var d;if(u&&((d=u==null?void 0:u.token_infos)==null?void 0:d.length)>0){let f=typeof r=="function"?r(u):u.token_infos;a(f);let h=Ns(f);if(!h)return;s(h)}},[r]);return c.useEffect(()=>{l(i==null?void 0:i.info)},[i==null?void 0:i.id,l]),{token:n,tokens:o,onTokenChange:s}}var Ms=e=>{var U;let{wrongNetwork:i}=si(),r=Je("networkId"),{chains:n,currentChain:s,settingChain:o,onChainChange:a}=Ts(),{token:l,tokens:u,onTokenChange:d}=Es({currentChain:s}),{dst:f,balance:h,allowance:x,depositFeeRevalidating:b,depositFee:m,quantity:g,setQuantity:j,approve:_,deposit:w,isNativeToken:v,balanceRevalidating:L,fetchBalance:q}=Dn({address:l==null?void 0:l.address,decimals:l==null?void 0:l.decimals,srcChainId:s==null?void 0:s.id,srcToken:l==null?void 0:l.symbol}),O=c.useMemo(()=>new D(h||0).todp((l==null?void 0:l.precision)??2,D.ROUND_DOWN).toString(),[h,l]),{inputStatus:T,hintMessage:N}=qs({quantity:g,maxQuantity:O}),C=()=>{j("")},S=c.useCallback(()=>{var te;C(),(te=e.onClose)==null||te.call(e)},[e.onClose]),{submitting:I,onApprove:P,onDeposit:E}=Is({quantity:g,allowance:x,approve:_,deposit:w,onSuccess:S}),M=I||b,R=!g||Number(g)===0||!l||T==="error"||b,se=c.useMemo(()=>new D(g||0).mul(1).toNumber(),[g]),re=Ds({isNativeToken:v,allowance:x,quantity:g,maxQuantity:O}),k=As({nativeToken:(U=s==null?void 0:s.info)==null?void 0:U.nativeToken,depositFee:m});return c.useEffect(()=>{C()},[l,s==null?void 0:s.id]),{token:l,tokens:u,onTokenChange:d,amount:se,quantity:g,maxQuantity:O,onQuantityChange:j,hintMessage:N,inputStatus:T,chains:n,currentChain:s,settingChain:o,onChainChange:a,actionType:re,onDeposit:E,onApprove:P,fetchBalance:q,dst:f,wrongNetwork:i,balanceRevalidating:L,loading:M,disabled:R,networkId:r,fee:k}};function As(e){let{nativeToken:i,depositFee:r=0}=e,{account:n}=ht(),s=i==null?void 0:i.symbol,{data:o}=En(`SPOT_${s}_USDC`);return{...c.useMemo(()=>{var u;let a=new D(r.toString()).div(new D(10).pow(((u=n.walletAdapter)==null?void 0:u.chainNamespace)===Mn.solana?9:18)).toString(),l=new D(a).mul(o||0).toString();return{dstGasFee:a,feeQty:a,feeAmount:l,dp:Cs(4)}},[r,o]),nativeSymbol:s}}var $s=e=>{let i=Ms(e);return t.jsx(ks,{...i})},zs=({checkIsBridgeless:e,quantity:i,chainVaultBalance:r,currentChain:n,maxAmount:s,crossChainTrans:o})=>{let{wrongNetwork:a}=si(),{state:l}=ht(),u=c.useMemo(()=>{if(n&&n.info&&n.info.network_infos)return n.info.network_infos.name},[n]),d=c.useMemo(()=>!r||!s||!i||new D(i).gt(s)?!1:!!new D(i).gt(r),[i,r]),f=(()=>{if(l.status!==Ge.NotConnected){if(a||!e)return t.jsxs(G,{children:["Withdrawals are not supported on ",u??"this chain",". Please switch to any of the bridgeless networks."]});if(o)return"Your cross-chain withdrawal is being processed...";if(d)return`Withdrawal exceeds the balance of the ${u} vault ( ${r} USDC ). Cross-chain rebalancing fee will be charged for withdrawal to ${u}.`}})();return f?t.jsx(y,{className:"oui-text-warning-darken oui-text-xs oui-justify-center oui-text-center",mb:3,children:f}):null},Fs=({hasPositions:e,unsettledPnl:i,onSettlle:r})=>{if(i===0&&!e)return t.jsx(t.Fragment,{});let n=()=>{he.confirm({title:"Settle PnL",content:t.jsxs("div",{children:["Are you sure you want to settle your PnL?",t.jsx("br",{})," Settlement will take up to 1 minute before you can withdraw your available balance."]}),onOk:()=>r()})};return t.jsxs(y,{justify:"between",className:"oui-text-2xs oui-text-base-contrast-36 oui-mt-1 oui-mx-2",children:[t.jsxs(y,{itemAlign:"center",justify:"start",gap:1,children:[t.jsx(Ie,{className:"oui-max-w-[274px]",content:"Unsettled balance can not be withdrawn. In order to withdraw, please settle your balance first.",children:t.jsxs(y,{itemAlign:"center",justify:"start",gap:1,children:[t.jsx(Tn,{size:14,className:"oui-text-warning-darken"}),t.jsx(p,{className:"oui-border-dashed oui-border-b oui-border-line-12 oui-cursor-pointer",children:"Unsettled:"})]})}),t.jsx(p.numeral,{showIdentifier:!0,coloring:!0,weight:"semibold",dp:6,"data-testid":"oui-testid-withdraw-dialog-unsettledPnl-value",children:i}),t.jsx(p,{children:"USDC"})]}),t.jsxs(y,{itemAlign:"center",gap:1,className:"oui-cursor-pointer",children:[t.jsx(ws,{className:"oui-text-primary"}),t.jsx(p,{"data-testid":"oui-testid-withdraw-dialog-settle-text",size:"2xs",color:"primary",className:" oui-select-none",onClick:n,children:"Settle"})]})]})},Rs=({address:e,amount:i,currentChain:r})=>{let n=c.useMemo(()=>{if(r&&r.info&&r.info.network_infos)return r.info.network_infos.name},[r]);return t.jsxs(y,{direction:"column",itemAlign:"start",justify:"start",className:"oui-gap-1 lg:oui-gap-3",children:[t.jsxs(y,{direction:"column",itemAlign:"start",mb:5,className:"oui-gap-3 lg:oui-gap-4",children:[t.jsxs(y,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(p,{size:"2xs",intensity:36,children:"Recipient address"}),t.jsx(p,{size:"sm",intensity:98,className:"oui-break-all",children:e})]}),t.jsxs(y,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(p,{size:"2xs",intensity:36,children:"Recipient network"}),t.jsxs(y,{gap:1,children:[t.jsx(Kt,{className:"oui-h-[18px] oui-w-[18px]",size:"sm",chainId:r.id}),t.jsx(p,{size:"sm",intensity:98,children:n})]})]}),t.jsxs(y,{direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(p,{size:"2xs",intensity:36,children:"Withdraw amount (USDC)"}),t.jsx(p.numeral,{size:"sm",intensity:98,dp:2,children:i})]})]}),t.jsx(y,{justify:"center",className:"oui-text-warning-darken oui-text-2xs lg:oui-text-xs oui-text-center",mb:3,children:"Withdrawals that require cross-chain rebalancing can't be cancelled or followed up with more withdrawals until they've been processed."})]})};function Us(e){let i=()=>{he.show(us,{networkId:e.networkId,bridgeLessOnly:!0}).then(r=>{F.success("Network switched")},r=>{})};return t.jsx(y,{direction:"column",children:t.jsx(J,{color:"warning",size:e.size,fullWidth:!0,onClick:()=>{i()},children:"Switch Network"})})}var Ws=e=>{let{disabled:i,loading:r,onWithdraw:n,networkId:s,crossChainWithdraw:o,address:a,currentChain:l,quantity:u,fee:d,checkIsBridgeless:f}=e,h=c.useMemo(()=>u?new D(u).minus(d??0).toNumber():0,[u,d]),x=()=>{if(o){he.confirm({title:"Confirm to withdraw",content:t.jsx(Rs,{address:a,amount:h,currentChain:l}),classNames:{content:"oui-font-semibold",body:"!oui-pb-0",footer:"!oui-pt-0"},onOk:async()=>{n()}});return}n()},b={initial:"md",lg:"lg"};return t.jsx(G,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:t.jsx(gr,{status:Ge.EnableTrading,networkId:s,bridgeLessOnly:!0,buttonProps:{fullWidth:!0,size:b},children:f?t.jsx(J,{"data-testid":"oui-testid-withdraw-dialog-withdraw-btn",fullWidth:!0,disabled:i,loading:r,onClick:x,size:b,children:"Withdraw"}):t.jsx(Us,{networkId:s,size:b})})})},Bs=({address:e,loading:i,disabled:r,quantity:n,onQuantityChange:s,token:o,inputStatus:a,hintMessage:l,amount:u,maxQuantity:d,balanceRevalidating:f,chains:h,currentChain:x,onChainChange:b,fee:m,settingChain:g,wrongNetwork:j,hasPositions:_,unsettledPnL:w,onSettlePnl:v,onWithdraw:L,chainVaultBalance:q,crossChainWithdraw:O,crossChainTrans:T,showQty:N,networkId:C,checkIsBridgeless:S})=>t.jsxs(G,{id:"oui-withdraw-form",className:vt({weight:"semibold"}),children:[t.jsxs(G,{className:"oui-mb-6 lg:oui-mb-8",children:[t.jsx(wr,{}),t.jsx(G,{mt:3,mb:1,children:t.jsx(Nt,{value:n,onValueChange:s,token:o,onTokenChange:()=>{},status:a,hintMessage:l,testId:"oui-testid-withdraw-dialog-quantity-input"})}),t.jsx(vr,{token:o,amount:u,maxQuantity:d.toString(),loading:f,onClick:()=>{s(d.toString())}}),t.jsx(Fs,{unsettledPnl:w,hasPositions:_,onSettlle:v}),t.jsx(jr,{}),t.jsx(_r,{}),t.jsxs(G,{mt:3,children:[t.jsx(br,{chains:h,value:x,onValueChange:b,wrongNetwork:j,loading:g}),t.jsx(Nt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},token:o,value:N,readOnly:!0})]}),t.jsx(y,{direction:"column",mt:1,gapY:1,itemAlign:"start",children:t.jsxs(p,{size:"xs",intensity:36,children:["Fee ≈ ",t.jsx(p,{size:"xs",intensity:80,children:`${m} `}),t.jsx(p,{children:"USDC"})]})})]}),t.jsx(zs,{checkIsBridgeless:S,chainVaultBalance:q,currentChain:x,quantity:n,maxAmount:d,crossChainTrans:T}),t.jsx(y,{justify:"center",children:t.jsx(Ws,{checkIsBridgeless:S,networkId:C,disabled:r,loading:i,onWithdraw:L,crossChainWithdraw:O,currentChain:x,address:e,quantity:n,fee:m})})]}),Di=1,Qs=({onClose:e})=>{let[i]=Xi(),[r,n]=c.useState(!1),[s,o]=c.useState(!1),{data:a}=Ji("/v1/asset/history",{revalidateOnMount:!0}),l=Je("networkId"),u=Zi(),[d,f]=c.useState(""),[h,x]=c.useState({symbol:"USDC",decimals:6,address:"",display_name:"",precision:6}),[b,m]=c.useState("default"),[g,j]=c.useState(),{wrongNetwork:_}=si(),{account:w}=ht(),[v]=we("orderly_selected_chainId",void 0),{data:L}=Oi("/v1/public/vault_balance",{revalidateOnMount:!0}),{connectedChain:q,wallet:O,setChain:T,settingChain:N}=Jt();Je();let{walletName:C,address:S}=c.useMemo(()=>{var A;return{walletName:O==null?void 0:O.label,address:(A=O==null?void 0:O.accounts)==null?void 0:A[0].address}},[O]),I=A=>{f(A)},P=c.useMemo(()=>new D(d||0).mul(Di).toNumber(),[d,Di]),{dst:E,withdraw:M,maxAmount:R,unsettledPnL:se}=Ln(),[re,k]=c.useState(!0),[U,{findByChainId:te}]=er(l,{pick:"network_infos",filter:A=>{var ne,me;return((ne=A.network_infos)==null?void 0:ne.bridge_enable)||((me=A.network_infos)==null?void 0:me.bridgeless)}}),V=c.useMemo(()=>l==="mainnet"?U.filter(A=>A.bridgeless):U,[U,l]),{configStore:Ne}=c.useContext(On),De=Ne.get("apiBaseUrl"),{data:pe}=Oi(`${De}/v1/public/token?t=withdraw`,{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1,revalidateOnMount:!0,dedupingInterval:36e5,formatter:A=>{if(A.rows.length===1)return A.rows[0].chain_details}}),H=c.useMemo(()=>{let A=q?tr(q.id):parseInt(v);if(!A)return null;let ne=te(A);return{...q,id:A,info:ne}},[te,q,v]),Pe=c.useMemo(()=>_||!H?!1:l==="testnet"?!0:!(!H.info||!H.info.network_infos||!H.info.network_infos.bridgeless),[H,_]),de=()=>{f("")},ae=c.useCallback(async A=>{var me,Te;let ne=te(A.chain_id);return!ne||((me=ne.network_infos)==null?void 0:me.chain_id)===(H==null?void 0:H.id)?Promise.resolve():T==null?void 0:T({chainId:ir(Number((Te=ne.network_infos)==null?void 0:Te.chain_id))}).then(Me=>{Me?(F.success("Network switched"),de()):F.error("Switch chain failed")}).catch(Me=>{F.error(`Switch chain failed: ${Me.message}`)})},[H,T,te]),Le=c.useMemo(()=>{var A;return((A=i==null?void 0:i.rows)==null?void 0:A.length)>0},[i]),ye=async()=>w.settle().catch(A=>(A.code==-1104&&F.error("Settlement is only allowed once every 10 minutes. Please try again later."),A.message.indexOf("user rejected")!==-1&&F.error("REJECTED_TRANSACTION"),Promise.reject(A))).then(A=>(F.success("Settlement requested"),Promise.resolve(A))),Y=c.useMemo(()=>{if(!L||!H)return null;let A=L.find(ne=>parseInt(ne.chain_id)===(H==null?void 0:H.id));return A?A.balance:null},[V,H,L]),$=c.useMemo(()=>{if(Y!==null){let A=parseFloat(d);return A>Y&&A<=R}return!1},[d,R,Y]),K=c.useMemo(()=>V.minimum_withdraw_amount??1,[V]),le=async()=>{if(!s&&b==="default"){if(new D(d).lt(K)){F.error(`quantity must large than ${K}`);return}return o(!0),M({amount:d,token:"USDC",chainId:H==null?void 0:H.id,allowCrossChainWithdraw:$}).then(A=>{F.success("Withdraw requested"),u.emit("withdraw:requested"),e&&e(),f("")}).catch(A=>{if(A.message.indexOf("user rejected")!==-1){F.error("REJECTED_TRANSACTION");return}F.error(A.message)}).finally(()=>{o(!1)})}},ce=c.useMemo(()=>{if(!H)return 0;let A=pe==null?void 0:pe.find(ne=>parseInt(ne.chain_id)===H.id);return A?$?(A.withdrawal_fee||0)+(A.cross_chain_withdrawal_fee||0):A.withdrawal_fee||0:0},[H,pe,V,$]),Ce=c.useMemo(()=>{if(!d)return"";let A=new D(d).sub(ce??0);return A.isNegative()?"":A.toNumber()},[ce,d]);return c.useEffect(()=>{if(r&&k(!0),!d){m("default"),j(""),k(!0);return}let A=new D(d??0);se<0?A.gt(R)?(m("error"),j("Insufficient balance"),k(!0)):(m("default"),j(""),k(!1)):A.gt(R)?(m("error"),j("Insufficient balance"),k(!0)):A.gt(new D(R).minus(se))&&A.lessThanOrEqualTo(R)?(m("warning"),j("Please settle your balance"),k(!0)):(m("default"),j(""),k(!1))},[d,R,se,r]),c.useEffect(()=>{let A=a==null?void 0:a.find(ne=>ne.trans_status==="pending_rebalance".toUpperCase());n(!!A)},[a]),kn({onMessage(A){if(!r)return;let{trxId:ne,transStatus:me}=A;ne===r&&me==="COMPLETED"&&n(!1)}}),{walletName:C,address:S,quantity:d,onQuantityChange:I,token:h,inputStatus:b,hintMessage:g,dst:E,amount:P,balanceRevalidating:!1,maxQuantity:R,disabled:re,loading:s,hasPositions:Le,unsettledPnL:se,wrongNetwork:_,settingChain:N,chains:V,currentChain:H,onChainChange:ae,onSettlePnl:ye,onWithdraw:le,chainVaultBalance:Y,fee:ce,crossChainWithdraw:$,crossChainTrans:r,showQty:Ce,networkId:l,checkIsBridgeless:Pe}},Vs=e=>{let i=Qs({onClose:e.close});return t.jsx(Bs,{...i})},Hs=e=>t.jsx(Sn,{position:Pn.DepositForm,defaultWidget:$s,...e}),Ks="DepositAndWithdrawWithDialogId",Ys="DepositAndWithdrawWithSheetId",Nr=e=>{let[i,r]=c.useState(e.activeTab||"deposit");return t.jsxs(Gi,{value:i,onValueChange:r,variant:"contained",size:"lg",classNames:{tabsList:"oui-px-0",tabsContent:"oui-pt-5"},children:[t.jsx($e,{title:"Deposit",icon:t.jsx(js,{}),value:"deposit",children:t.jsx(Hs,{onClose:e.close})}),t.jsx($e,{title:"Withdraw",icon:t.jsx(_s,{}),value:"withdraw",children:t.jsx(Vs,{...e})})]})};Lt(Ks,Nr,{size:"md",contentClassName:"oui-border oui-border-line-6"});Yi(Ys,Nr,{classNames:{body:""}});function Gs(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ti(e){return Gs(e)||Array.isArray(e)}function Xs(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function oi(e,i){const r=Object.keys(e),n=Object.keys(i);if(r.length!==n.length)return!1;const s=JSON.stringify(Object.keys(e.breakpoints||{})),o=JSON.stringify(Object.keys(i.breakpoints||{}));return s!==o?!1:r.every(a=>{const l=e[a],u=i[a];return typeof l=="function"?`${l}`==`${u}`:!Ti(l)||!Ti(u)?l===u:oi(l,u)})}function Ii(e){return e.concat().sort((i,r)=>i.name>r.name?1:-1).map(i=>i.options)}function Js(e,i){if(e.length!==i.length)return!1;const r=Ii(e),n=Ii(i);return r.every((s,o)=>{const a=n[o];return oi(s,a)})}function ai(e){return typeof e=="number"}function Gt(e){return typeof e=="string"}function qt(e){return typeof e=="boolean"}function qi(e){return Object.prototype.toString.call(e)==="[object Object]"}function oe(e){return Math.abs(e)}function li(e){return Math.sign(e)}function dt(e,i){return oe(e-i)}function Zs(e,i){if(e===0||i===0||oe(e)<=oe(i))return 0;const r=dt(oe(e),oe(i));return oe(r/e)}function eo(e){return Math.round(e*100)/100}function ct(e){return pt(e).map(Number)}function ke(e){return e[yt(e)]}function yt(e){return Math.max(0,e.length-1)}function ui(e,i){return i===yt(e)}function Ei(e,i=0){return Array.from(Array(e),(r,n)=>i+n)}function pt(e){return Object.keys(e)}function Cr(e,i){return[e,i].reduce((r,n)=>(pt(n).forEach(s=>{const o=r[s],a=n[s],l=qi(o)&&qi(a);r[s]=l?Cr(o,a):a}),r),{})}function Xt(e,i){return typeof i.MouseEvent<"u"&&e instanceof i.MouseEvent}function to(e,i){const r={start:n,center:s,end:o};function n(){return 0}function s(u){return o(u)/2}function o(u){return i-u}function a(u,d){return Gt(e)?r[e](u):e(i,u,d)}return{measure:a}}function mt(){let e=[];function i(s,o,a,l={passive:!0}){let u;if("addEventListener"in s)s.addEventListener(o,a,l),u=()=>s.removeEventListener(o,a,l);else{const d=s;d.addListener(a),u=()=>d.removeListener(a)}return e.push(u),n}function r(){e=e.filter(s=>s())}const n={add:i,clear:r};return n}function io(e,i,r,n){const s=mt(),o=1e3/60;let a=null,l=0,u=0;function d(){s.add(e,"visibilitychange",()=>{e.hidden&&m()})}function f(){b(),s.clear()}function h(j){if(!u)return;a||(a=j,r(),r());const _=j-a;for(a=j,l+=_;l>=o;)r(),l-=o;const w=l/o;n(w),u&&(u=i.requestAnimationFrame(h))}function x(){u||(u=i.requestAnimationFrame(h))}function b(){i.cancelAnimationFrame(u),a=null,l=0,u=0}function m(){a=null,l=0}return{init:d,destroy:f,start:x,stop:b,update:r,render:n}}function ro(e,i){const r=i==="rtl",n=e==="y",s=n?"y":"x",o=n?"x":"y",a=!n&&r?-1:1,l=f(),u=h();function d(m){const{height:g,width:j}=m;return n?g:j}function f(){return n?"top":r?"right":"left"}function h(){return n?"bottom":r?"left":"right"}function x(m){return m*a}return{scroll:s,cross:o,startEdge:l,endEdge:u,measureSize:d,direction:x}}function Ue(e=0,i=0){const r=oe(e-i);function n(d){return d<e}function s(d){return d>i}function o(d){return n(d)||s(d)}function a(d){return o(d)?n(d)?e:i:d}function l(d){return r?d-r*Math.ceil((d-i)/r):d}return{length:r,max:i,min:e,constrain:a,reachedAny:o,reachedMax:s,reachedMin:n,removeOffset:l}}function Sr(e,i,r){const{constrain:n}=Ue(0,e),s=e+1;let o=a(i);function a(x){return r?oe((s+x)%s):n(x)}function l(){return o}function u(x){return o=a(x),h}function d(x){return f().set(l()+x)}function f(){return Sr(e,l(),r)}const h={get:l,set:u,add:d,clone:f};return h}function no(e,i,r,n,s,o,a,l,u,d,f,h,x,b,m,g,j,_,w){const{cross:v,direction:L}=e,q=["INPUT","SELECT","TEXTAREA"],O={passive:!1},T=mt(),N=mt(),C=Ue(50,225).constrain(b.measure(20)),S={mouse:300,touch:400},I={mouse:500,touch:600},P=m?43:25;let E=!1,M=0,R=0,se=!1,re=!1,k=!1,U=!1;function te($){if(!w)return;function K(ce){(qt(w)||w($,ce))&&Pe(ce)}const le=i;T.add(le,"dragstart",ce=>ce.preventDefault(),O).add(le,"touchmove",()=>{},O).add(le,"touchend",()=>{}).add(le,"touchstart",K).add(le,"mousedown",K).add(le,"touchcancel",ae).add(le,"contextmenu",ae).add(le,"click",Le,!0)}function V(){T.clear(),N.clear()}function Ne(){const $=U?r:i;N.add($,"touchmove",de,O).add($,"touchend",ae).add($,"mousemove",de,O).add($,"mouseup",ae)}function De($){const K=$.nodeName||"";return q.includes(K)}function pe(){return(m?I:S)[U?"mouse":"touch"]}function H($,K){const le=h.add(li($)*-1),ce=f.byDistance($,!m).distance;return m||oe($)<C?ce:j&&K?ce*.5:f.byIndex(le.get(),0).distance}function Pe($){const K=Xt($,n);U=K,k=m&&K&&!$.buttons&&E,E=dt(s.get(),a.get())>=2,!(K&&$.button!==0)&&(De($.target)||(se=!0,o.pointerDown($),d.useFriction(0).useDuration(0),s.set(a),Ne(),M=o.readPoint($),R=o.readPoint($,v),x.emit("pointerDown")))}function de($){if(!Xt($,n)&&$.touches.length>=2)return ae($);const le=o.readPoint($),ce=o.readPoint($,v),Ce=dt(le,M),A=dt(ce,R);if(!re&&!U&&(!$.cancelable||(re=Ce>A,!re)))return ae($);const ne=o.pointerMove($);Ce>g&&(k=!0),d.useFriction(.3).useDuration(.75),l.start(),s.add(L(ne)),$.preventDefault()}function ae($){const le=f.byDistance(0,!1).index!==h.get(),ce=o.pointerUp($)*pe(),Ce=H(L(ce),le),A=Zs(ce,Ce),ne=P-10*A,me=_+A/50;re=!1,se=!1,N.clear(),d.useDuration(ne).useFriction(me),u.distance(Ce,!m),U=!1,x.emit("pointerUp")}function Le($){k&&($.stopPropagation(),$.preventDefault(),k=!1)}function ye(){return se}return{init:te,destroy:V,pointerDown:ye}}function so(e,i){let n,s;function o(h){return h.timeStamp}function a(h,x){const m=`client${(x||e.scroll)==="x"?"X":"Y"}`;return(Xt(h,i)?h:h.touches[0])[m]}function l(h){return n=h,s=h,a(h)}function u(h){const x=a(h)-a(s),b=o(h)-o(n)>170;return s=h,b&&(n=h),x}function d(h){if(!n||!s)return 0;const x=a(s)-a(n),b=o(h)-o(n),m=o(h)-o(s)>170,g=x/b;return b&&!m&&oe(g)>.1?g:0}return{pointerDown:l,pointerMove:u,pointerUp:d,readPoint:a}}function oo(){function e(r){const{offsetTop:n,offsetLeft:s,offsetWidth:o,offsetHeight:a}=r;return{top:n,right:s+o,bottom:n+a,left:s,width:o,height:a}}return{measure:e}}function ao(e){function i(n){return e*(n/100)}return{measure:i}}function lo(e,i,r,n,s,o,a){const l=[e].concat(n);let u,d,f=[],h=!1;function x(j){return s.measureSize(a.measure(j))}function b(j){if(!o)return;d=x(e),f=n.map(x);function _(w){for(const v of w){if(h)return;const L=v.target===e,q=n.indexOf(v.target),O=L?d:f[q],T=x(L?e:n[q]);if(oe(T-O)>=.5){j.reInit(),i.emit("resize");break}}}u=new ResizeObserver(w=>{(qt(o)||o(j,w))&&_(w)}),r.requestAnimationFrame(()=>{l.forEach(w=>u.observe(w))})}function m(){h=!0,u&&u.disconnect()}return{init:b,destroy:m}}function uo(e,i,r,n,s,o){let a=0,l=0,u=s,d=o,f=e.get(),h=0;function x(){const O=n.get()-e.get(),T=!u;let N=0;return T?(a=0,r.set(n),e.set(n),N=O):(r.set(e),a+=O/u,a*=d,f+=a,e.add(a),N=f-h),l=li(N),h=f,q}function b(){const O=n.get()-i.get();return oe(O)<.001}function m(){return u}function g(){return l}function j(){return a}function _(){return v(s)}function w(){return L(o)}function v(O){return u=O,q}function L(O){return d=O,q}const q={direction:g,duration:m,velocity:j,seek:x,settled:b,useBaseFriction:w,useBaseDuration:_,useFriction:L,useDuration:v};return q}function co(e,i,r,n,s){const o=s.measure(10),a=s.measure(50),l=Ue(.1,.99);let u=!1;function d(){return!(u||!e.reachedAny(r.get())||!e.reachedAny(i.get()))}function f(b){if(!d())return;const m=e.reachedMin(i.get())?"min":"max",g=oe(e[m]-i.get()),j=r.get()-i.get(),_=l.constrain(g/a);r.subtract(j*_),!b&&oe(j)<o&&(r.set(e.constrain(r.get())),n.useDuration(25).useBaseFriction())}function h(b){u=!b}return{shouldConstrain:d,constrain:f,toggleActive:h}}function po(e,i,r,n,s){const o=Ue(-i+e,0),a=h(),l=f(),u=x();function d(m,g){return dt(m,g)<=1}function f(){const m=a[0],g=ke(a),j=a.lastIndexOf(m),_=a.indexOf(g)+1;return Ue(j,_)}function h(){return r.map((m,g)=>{const{min:j,max:_}=o,w=o.constrain(m),v=!g,L=ui(r,g);return v?_:L||d(j,w)?j:d(_,w)?_:w}).map(m=>parseFloat(m.toFixed(3)))}function x(){if(i<=e+s)return[o.max];if(n==="keepSnaps")return a;const{min:m,max:g}=l;return a.slice(m,g)}return{snapsContained:u,scrollContainLimit:l}}function mo(e,i,r){const n=i[0],s=r?n-e:ke(i);return{limit:Ue(s,n)}}function fo(e,i,r,n){const o=i.min+.1,a=i.max+.1,{reachedMin:l,reachedMax:u}=Ue(o,a);function d(x){return x===1?u(r.get()):x===-1?l(r.get()):!1}function f(x){if(!d(x))return;const b=e*(x*-1);n.forEach(m=>m.add(b))}return{loop:f}}function ho(e){const{max:i,length:r}=e;function n(o){const a=o-i;return r?a/-r:0}return{get:n}}function xo(e,i,r,n,s){const{startEdge:o,endEdge:a}=e,{groupSlides:l}=s,u=h().map(i.measure),d=x(),f=b();function h(){return l(n).map(g=>ke(g)[a]-g[0][o]).map(oe)}function x(){return n.map(g=>r[o]-g[o]).map(g=>-oe(g))}function b(){return l(d).map(g=>g[0]).map((g,j)=>g+u[j])}return{snaps:d,snapsAligned:f}}function go(e,i,r,n,s,o){const{groupSlides:a}=s,{min:l,max:u}=n,d=f();function f(){const x=a(o),b=!e||i==="keepSnaps";return r.length===1?[o]:b?x:x.slice(l,u).map((m,g,j)=>{const _=!g,w=ui(j,g);if(_){const v=ke(j[0])+1;return Ei(v)}if(w){const v=yt(o)-ke(j)[0]+1;return Ei(v,ke(j)[0])}return m})}return{slideRegistry:d}}function yo(e,i,r,n,s){const{reachedAny:o,removeOffset:a,constrain:l}=n;function u(m){return m.concat().sort((g,j)=>oe(g)-oe(j))[0]}function d(m){const g=e?a(m):l(m),j=i.map((w,v)=>({diff:f(w-g,0),index:v})).sort((w,v)=>oe(w.diff)-oe(v.diff)),{index:_}=j[0];return{index:_,distance:g}}function f(m,g){const j=[m,m+r,m-r];if(!e)return m;if(!g)return u(j);const _=j.filter(w=>li(w)===g);return _.length?u(_):ke(j)-r}function h(m,g){const j=i[m]-s.get(),_=f(j,g);return{index:m,distance:_}}function x(m,g){const j=s.get()+m,{index:_,distance:w}=d(j),v=!e&&o(j);if(!g||v)return{index:_,distance:m};const L=i[_]-w,q=m+f(L,0);return{index:_,distance:q}}return{byDistance:x,byIndex:h,shortcut:f}}function bo(e,i,r,n,s,o,a){function l(h){const x=h.distance,b=h.index!==i.get();o.add(x),x&&(n.duration()?e.start():(e.update(),e.render(1),e.update())),b&&(r.set(i.get()),i.set(h.index),a.emit("select"))}function u(h,x){const b=s.byDistance(h,x);l(b)}function d(h,x){const b=i.clone().set(h),m=s.byIndex(b.get(),x);l(m)}return{distance:u,index:d}}function jo(e,i,r,n,s,o,a,l){const u={passive:!0,capture:!0};let d=0;function f(b){if(!l)return;function m(g){if(new Date().getTime()-d>10)return;a.emit("slideFocusStart"),e.scrollLeft=0;const w=r.findIndex(v=>v.includes(g));ai(w)&&(s.useDuration(0),n.index(w,0),a.emit("slideFocus"))}o.add(document,"keydown",h,!1),i.forEach((g,j)=>{o.add(g,"focus",_=>{(qt(l)||l(b,_))&&m(j)},u)})}function h(b){b.code==="Tab"&&(d=new Date().getTime())}return{init:f}}function ut(e){let i=e;function r(){return i}function n(u){i=a(u)}function s(u){i+=a(u)}function o(u){i-=a(u)}function a(u){return ai(u)?u:u.get()}return{get:r,set:n,add:s,subtract:o}}function Pr(e,i){const r=e.scroll==="x"?a:l,n=i.style;let s=null,o=!1;function a(x){return`translate3d(${x}px,0px,0px)`}function l(x){return`translate3d(0px,${x}px,0px)`}function u(x){if(o)return;const b=eo(e.direction(x));b!==s&&(n.transform=r(b),s=b)}function d(x){o=!x}function f(){o||(n.transform="",i.getAttribute("style")||i.removeAttribute("style"))}return{clear:f,to:u,toggleActive:d}}function _o(e,i,r,n,s,o,a,l,u){const f=ct(s),h=ct(s).reverse(),x=_().concat(w());function b(T,N){return T.reduce((C,S)=>C-s[S],N)}function m(T,N){return T.reduce((C,S)=>b(C,N)>0?C.concat([S]):C,[])}function g(T){return o.map((N,C)=>({start:N-n[C]+.5+T,end:N+i-.5+T}))}function j(T,N,C){const S=g(N);return T.map(I=>{const P=C?0:-r,E=C?r:0,M=C?"end":"start",R=S[I][M];return{index:I,loopPoint:R,slideLocation:ut(-1),translate:Pr(e,u[I]),target:()=>l.get()>R?P:E}})}function _(){const T=a[0],N=m(h,T);return j(N,r,!1)}function w(){const T=i-a[0]-1,N=m(f,T);return j(N,-r,!0)}function v(){return x.every(({index:T})=>{const N=f.filter(C=>C!==T);return b(N,i)<=.1})}function L(){x.forEach(T=>{const{target:N,translate:C,slideLocation:S}=T,I=N();I!==S.get()&&(C.to(I),S.set(I))})}function q(){x.forEach(T=>T.translate.clear())}return{canLoop:v,clear:q,loop:L,loopPoints:x}}function wo(e,i,r){let n,s=!1;function o(u){if(!r)return;function d(f){for(const h of f)if(h.type==="childList"){u.reInit(),i.emit("slidesChanged");break}}n=new MutationObserver(f=>{s||(qt(r)||r(u,f))&&d(f)}),n.observe(e,{childList:!0})}function a(){n&&n.disconnect(),s=!0}return{init:o,destroy:a}}function vo(e,i,r,n){const s={};let o=null,a=null,l,u=!1;function d(){l=new IntersectionObserver(m=>{u||(m.forEach(g=>{const j=i.indexOf(g.target);s[j]=g}),o=null,a=null,r.emit("slidesInView"))},{root:e.parentElement,threshold:n}),i.forEach(m=>l.observe(m))}function f(){l&&l.disconnect(),u=!0}function h(m){return pt(s).reduce((g,j)=>{const _=parseInt(j),{isIntersecting:w}=s[_];return(m&&w||!m&&!w)&&g.push(_),g},[])}function x(m=!0){if(m&&o)return o;if(!m&&a)return a;const g=h(m);return m&&(o=g),m||(a=g),g}return{init:d,destroy:f,get:x}}function No(e,i,r,n,s,o){const{measureSize:a,startEdge:l,endEdge:u}=e,d=r[0]&&s,f=m(),h=g(),x=r.map(a),b=j();function m(){if(!d)return 0;const w=r[0];return oe(i[l]-w[l])}function g(){if(!d)return 0;const w=o.getComputedStyle(ke(n));return parseFloat(w.getPropertyValue(`margin-${u}`))}function j(){return r.map((w,v,L)=>{const q=!v,O=ui(L,v);return q?x[v]+f:O?x[v]+h:L[v+1][l]-w[l]}).map(oe)}return{slideSizes:x,slideSizesWithGaps:b,startGap:f,endGap:h}}function Co(e,i,r,n,s,o,a,l,u){const{startEdge:d,endEdge:f,direction:h}=e,x=ai(r);function b(_,w){return ct(_).filter(v=>v%w===0).map(v=>_.slice(v,v+w))}function m(_){return _.length?ct(_).reduce((w,v,L)=>{const q=ke(w)||0,O=q===0,T=v===yt(_),N=s[d]-o[q][d],C=s[d]-o[v][f],S=!n&&O?h(a):0,I=!n&&T?h(l):0,P=oe(C-I-(N+S));return L&&P>i+u&&w.push(v),T&&w.push(_.length),w},[]).map((w,v,L)=>{const q=Math.max(L[v-1]||0);return _.slice(q,w)}):[]}function g(_){return x?b(_,r):m(_)}return{groupSlides:g}}function So(e,i,r,n,s,o,a){const{align:l,axis:u,direction:d,startIndex:f,loop:h,duration:x,dragFree:b,dragThreshold:m,inViewThreshold:g,slidesToScroll:j,skipSnaps:_,containScroll:w,watchResize:v,watchSlides:L,watchDrag:q,watchFocus:O}=o,T=2,N=oo(),C=N.measure(i),S=r.map(N.measure),I=ro(u,d),P=I.measureSize(C),E=ao(P),M=to(l,P),R=!h&&!!w,se=h||!!w,{slideSizes:re,slideSizesWithGaps:k,startGap:U,endGap:te}=No(I,C,S,r,se,s),V=Co(I,P,j,h,C,S,U,te,T),{snaps:Ne,snapsAligned:De}=xo(I,M,C,S,V),pe=-ke(Ne)+ke(k),{snapsContained:H,scrollContainLimit:Pe}=po(P,pe,De,w,T),de=R?H:De,{limit:ae}=mo(pe,de,h),Le=Sr(yt(de),f,h),ye=Le.clone(),Y=ct(r),$=({dragHandler:Be,scrollBody:Ft,scrollBounds:Rt,options:{loop:_t}})=>{_t||Rt.constrain(Be.pointerDown()),Ft.seek()},K=({scrollBody:Be,translate:Ft,location:Rt,offsetLocation:_t,previousLocation:mn,scrollLooper:fn,slideLooper:hn,dragHandler:xn,animation:gn,eventHandler:vi,scrollBounds:yn,options:{loop:Ni}},Ci)=>{const Si=Be.settled(),bn=!yn.shouldConstrain(),Pi=Ni?Si:Si&&bn;Pi&&!xn.pointerDown()&&(gn.stop(),vi.emit("settle")),Pi||vi.emit("scroll");const jn=Rt.get()*Ci+mn.get()*(1-Ci);_t.set(jn),Ni&&(fn.loop(Be.direction()),hn.loop()),Ft.to(_t.get())},le=io(n,s,()=>$(zt),Be=>K(zt,Be)),ce=.68,Ce=de[Le.get()],A=ut(Ce),ne=ut(Ce),me=ut(Ce),Te=ut(Ce),Me=uo(A,me,ne,Te,x,ce),At=yo(h,de,pe,ae,Te),$t=bo(le,Le,ye,Me,At,Te,a),ji=ho(ae),_i=mt(),cn=vo(i,r,a,g),{slideRegistry:wi}=go(R,w,de,Pe,V,Y),pn=jo(e,r,wi,$t,Me,_i,a,O),zt={ownerDocument:n,ownerWindow:s,eventHandler:a,containerRect:C,slideRects:S,animation:le,axis:I,dragHandler:no(I,e,n,s,Te,so(I,s),A,le,$t,Me,At,Le,a,E,b,m,_,ce,q),eventStore:_i,percentOfView:E,index:Le,indexPrevious:ye,limit:ae,location:A,offsetLocation:me,previousLocation:ne,options:o,resizeHandler:lo(i,a,s,r,I,v,N),scrollBody:Me,scrollBounds:co(ae,me,Te,Me,E),scrollLooper:fo(pe,ae,me,[A,me,ne,Te]),scrollProgress:ji,scrollSnapList:de.map(ji.get),scrollSnaps:de,scrollTarget:At,scrollTo:$t,slideLooper:_o(I,P,pe,re,k,Ne,de,me,r),slideFocus:pn,slidesHandler:wo(i,a,L),slidesInView:cn,slideIndexes:Y,slideRegistry:wi,slidesToScroll:V,target:Te,translate:Pr(I,i)};return zt}function Po(){let e={},i;function r(d){i=d}function n(d){return e[d]||[]}function s(d){return n(d).forEach(f=>f(i,d)),u}function o(d,f){return e[d]=n(d).concat([f]),u}function a(d,f){return e[d]=n(d).filter(h=>h!==f),u}function l(){e={}}const u={init:r,emit:s,off:a,on:o,clear:l};return u}const Lo={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function Oo(e){function i(o,a){return Cr(o,a||{})}function r(o){const a=o.breakpoints||{},l=pt(a).filter(u=>e.matchMedia(u).matches).map(u=>a[u]).reduce((u,d)=>i(u,d),{});return i(o,l)}function n(o){return o.map(a=>pt(a.breakpoints||{})).reduce((a,l)=>a.concat(l),[]).map(e.matchMedia)}return{mergeOptions:i,optionsAtMedia:r,optionsMediaQueries:n}}function ko(e){let i=[];function r(o,a){return i=a.filter(({options:l})=>e.optionsAtMedia(l).active!==!1),i.forEach(l=>l.init(o,e)),a.reduce((l,u)=>Object.assign(l,{[u.name]:u}),{})}function n(){i=i.filter(o=>o.destroy())}return{init:r,destroy:n}}function Ct(e,i,r){const n=e.ownerDocument,s=n.defaultView,o=Oo(s),a=ko(o),l=mt(),u=Po(),{mergeOptions:d,optionsAtMedia:f,optionsMediaQueries:h}=o,{on:x,off:b,emit:m}=u,g=I;let j=!1,_,w=d(Lo,Ct.globalOptions),v=d(w),L=[],q,O,T;function N(){const{container:Y,slides:$}=v;O=(Gt(Y)?e.querySelector(Y):Y)||e.children[0];const le=Gt($)?O.querySelectorAll($):$;T=[].slice.call(le||O.children)}function C(Y){const $=So(e,O,T,n,s,Y,u);if(Y.loop&&!$.slideLooper.canLoop()){const K=Object.assign({},Y,{loop:!1});return C(K)}return $}function S(Y,$){j||(w=d(w,Y),v=f(w),L=$||L,N(),_=C(v),h([w,...L.map(({options:K})=>K)]).forEach(K=>l.add(K,"change",I)),v.active&&(_.translate.to(_.location.get()),_.animation.init(),_.slidesInView.init(),_.slideFocus.init(ye),_.eventHandler.init(ye),_.resizeHandler.init(ye),_.slidesHandler.init(ye),_.options.loop&&_.slideLooper.loop(),O.offsetParent&&T.length&&_.dragHandler.init(ye),q=a.init(ye,L)))}function I(Y,$){const K=V();P(),S(d({startIndex:K},Y),$),u.emit("reInit")}function P(){_.dragHandler.destroy(),_.eventStore.clear(),_.translate.clear(),_.slideLooper.clear(),_.resizeHandler.destroy(),_.slidesHandler.destroy(),_.slidesInView.destroy(),_.animation.destroy(),a.destroy(),l.clear()}function E(){j||(j=!0,l.clear(),P(),u.emit("destroy"),u.clear())}function M(Y,$,K){!v.active||j||(_.scrollBody.useBaseFriction().useDuration($===!0?0:v.duration),_.scrollTo.index(Y,K||0))}function R(Y){const $=_.index.add(1).get();M($,Y,-1)}function se(Y){const $=_.index.add(-1).get();M($,Y,1)}function re(){return _.index.add(1).get()!==V()}function k(){return _.index.add(-1).get()!==V()}function U(){return _.scrollSnapList}function te(){return _.scrollProgress.get(_.location.get())}function V(){return _.index.get()}function Ne(){return _.indexPrevious.get()}function De(){return _.slidesInView.get()}function pe(){return _.slidesInView.get(!1)}function H(){return q}function Pe(){return _}function de(){return e}function ae(){return O}function Le(){return T}const ye={canScrollNext:re,canScrollPrev:k,containerNode:ae,internalEngine:Pe,destroy:E,off:b,on:x,emit:m,plugins:H,previousScrollSnap:Ne,reInit:g,rootNode:de,scrollNext:R,scrollPrev:se,scrollProgress:te,scrollSnapList:U,scrollTo:M,selectedScrollSnap:V,slideNodes:Le,slidesInView:De,slidesNotInView:pe};return S(i,r),setTimeout(()=>u.emit("init"),0),ye}Ct.globalOptions=void 0;function Et(e={},i=[]){const r=c.useRef(e),n=c.useRef(i),[s,o]=c.useState(),[a,l]=c.useState(),u=c.useCallback(()=>{s&&s.reInit(r.current,n.current)},[s]);return c.useEffect(()=>{oi(r.current,e)||(r.current=e,u())},[e,u]),c.useEffect(()=>{Js(n.current,i)||(n.current=i,u())},[i,u]),c.useEffect(()=>{if(Xs()&&a){Ct.globalOptions=Et.globalOptions;const d=Ct(a,r.current,n.current);return o(d),()=>d.destroy()}else o(void 0)},[a,o]),[l,s]}Et.globalOptions=void 0;var Lr=e=>{let{pnl:i,hide:r}=e,n=i==null?void 0:i.entity,s=Ee(),{getFirstRefCode:o}=Zt(),a=c.useMemo(()=>{var f;let d=(f=o())==null?void 0:f.code;return{code:(i==null?void 0:i.refCode)??d,slogan:i==null?void 0:i.refSlogan,link:i==null?void 0:i.refLink}},[o,i]),l=c.useMemo(()=>{if(n)return s[n==null?void 0:n.symbol]("base_dp")},[n,s]),u=c.useMemo(()=>{if(n)return s[n==null?void 0:n.symbol]("quote_dp")},[n,s]);return{entity:n,leverage:i==null?void 0:i.leverage,baseDp:l,quoteDp:u,referralInfo:a,shareOptions:i,hide:r}};function Or(e,i,r,n,s,o,a,l,u){let{symbol:d,currency:f}=Do(e.symbol),h={symbol:d,currency:f,side:e.side};switch(s){case"pnl":{e.pnl!=null&&(h.pnl=new D(e.pnl).toFixed(2,D.ROUND_DOWN));break}case"roi":{e.roi!=null&&(h.ROI=new D(e.roi).toFixed(2,D.ROUND_DOWN));break}case"roi_pnl":{e.pnl!=null&&(h.pnl=new D(e.pnl).toFixed(2,D.ROUND_DOWN)),e.roi!=null&&(h.ROI=new D(e.roi).toFixed(2,D.ROUND_DOWN));break}}let x=[];o.has("leverage")&&(h.leverage=i),["openPrice","openTime","markPrice","quantity"].forEach(m=>{if(o.has(m))switch(m){case"leverage":break;case"openPrice":{e.openPrice!=null&&x.push({title:"Open price",value:Wt(e.openPrice,l||2)});break}case"openTime":{e.openTime!=null&&x.push({title:"Opened at",value:Io(e.openTime)});break}case"markPrice":{e.markPrice!=null&&x.push({title:"Mark price",value:Wt(e.markPrice,l||2)});break}case"quantity":e.quantity!=null&&x.push({title:"Quantity",value:Wt(e.quantity,a||2)})}}),h.informations=x;let b={position:h,updateTime:To(new Date),domain:n};return r.length>0&&(b.message=r),typeof u<"u"&&u.code!==void 0&&(b.referral=u),b}function Do(e){let i=e.split("_");if(i.length!==3)return{symbol:e,currency:"USDC"};let[r,n,s]=i;return{symbol:`${n}-${r}`,currency:s||"USDC"}}function To(e){var d,f,h,x,b;let i=e instanceof Date?e:new Date(e),r={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hourCycle:"h24"},n=new Intl.DateTimeFormat("en-US",r).formatToParts(i),s=(d=n.find(m=>m.type==="year"?m.value:""))==null?void 0:d.value,o=(f=n.find(m=>m.type==="month"?m.value:""))==null?void 0:f.value,a=(h=n.find(m=>m.type==="day"?m.value:""))==null?void 0:h.value,l=(x=n.find(m=>m.type==="hour"?m.value:""))==null?void 0:x.value,u=(b=n.find(m=>m.type==="minute"?m.value:""))==null?void 0:b.value;return`${s}-${o}-${a} ${l}:${u}`}function Io(e){var u,d,f,h;let i=e instanceof Date?e:new Date(e),r={year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"},n=new Intl.DateTimeFormat("en-US",r).formatToParts(i),s=(u=n.find(x=>x.type==="month"?x.value:""))==null?void 0:u.value,o=(d=n.find(x=>x.type==="day"?x.value:""))==null?void 0:d.value,a=(f=n.find(x=>x.type==="hour"?x.value:""))==null?void 0:f.value,l=(h=n.find(x=>x.type==="minute"?x.value:""))==null?void 0:h.value;return`${s}-${o} ${a}:${l}`}function Wt(e,i){return new D(e).toFixed(i,D.ROUND_DOWN)}function kr(e,i,r,n){localStorage.setItem("pnl_config_key",JSON.stringify({bgIndex:r,pnlFormat:e,options:Array.from(i),message:n}))}function Dr(){let e=localStorage.getItem("pnl_config_key");if(e&&e.length>0)try{return JSON.parse(e)}catch{}return{bgIndex:0,pnlFormat:"roi_pnl",options:["openPrice","openTime","markPrice","quantity","leverage"],message:""}}var Tr=c.forwardRef((e,i)=>{let{width:r,height:n,className:s,data:o,style:a}=e,{ref:l,download:u,toDataURL:d,copy:f,toBlob:h}=An(o,{ratio:e.ratio});return c.useImperativeHandle(i,()=>({download:u,toDataURL:d,toBlob:h,copy:f})),t.jsx("canvas",{ref:l,width:r,height:n,className:s,style:a})}),qo=e=>{let{children:i,...r}=e;return t.jsx("button",{...r,children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#333948"}),t.jsx("path",{d:"M11.186 5.348a.67.67 0 0 0-.436.27l-2.657 4a.69.69 0 0 0 0 .75l2.657 4a.68.68 0 0 0 .934.188.685.685 0 0 0 .187-.937L9.463 9.993 11.87 6.37a.685.685 0 0 0-.187-.938.65.65 0 0 0-.498-.083",fill:"#fff",fillOpacity:".54"})]})})},Eo=e=>{let{children:i,...r}=e;return t.jsx("button",{...r,children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#333948"}),t.jsx("path",{d:"M8.777 5.348a.65.65 0 0 0-.498.083.685.685 0 0 0-.187.938L10.5 9.993 8.092 13.62a.685.685 0 0 0 .187.937.68.68 0 0 0 .934-.187l2.657-4a.69.69 0 0 0 0-.75l-2.657-4a.67.67 0 0 0-.436-.271",fill:"#fff",fillOpacity:".54"})]})})},Mo=e=>{let{backgroundImages:i,selectedSnap:r,setSelectedSnap:n}=e,[s,o]=Et({containScroll:"keepSnaps",dragFree:!0}),a=c.useCallback(()=>{o&&o.scrollPrev()},[o]),l=c.useCallback(()=>{o&&o.scrollNext()},[o]),u=c.useCallback(d=>{n(d.selectedScrollSnap())},[]);return c.useEffect(()=>{o&&(u(o),o.on("reInit",u),o.on("select",u),o==null||o.scrollTo(r))},[o,u]),t.jsxs(y,{mt:4,px:2,children:[t.jsx(qo,{onClick:a}),t.jsx("div",{ref:s,className:"oui-w-full oui-overflow oui-overflow-x-auto oui-scrollbar-hidden oui-hide-scrollbar oui-mx-0",children:t.jsx(y,{children:i.map((d,f)=>t.jsx(G,{onClick:()=>{o==null||o.scrollTo(f)},mx:2,my:1,mr:6,r:"base",className:z("oui-shrink-0 oui-w-[162px]",r===f&&"oui-outline oui-outline-1 oui-outline-primary-darken"),children:t.jsx("img",{src:d,className:"oui-rounded-sm"})},d))})}),t.jsx(Eo,{onClick:l})]})},Ao=e=>{let{type:i,curType:r,setPnlFormat:n}=e,s=c.useMemo(()=>{switch(i){case"roi_pnl":return"ROI & PnL";case"roi":return"ROI";case"pnl":return"PnL"}},[i]),o=i===r,a="oui-flex oui-items-center oui-gap-1 oui-cursor-pointer";return o?a+=" oui-text-base-contrast":a+="",t.jsxs("div",{className:a,onClick:()=>{n(i)},children:[t.jsx($o,{sel:o}),t.jsx(p,{size:"xs",intensity:54,className:z("oui-ml-2 "),children:s})]})},$o=e=>t.jsx("button",{type:"button",children:e.sel===!0?t.jsx(zo,{}):t.jsx(Fo,{})}),zo=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-primary-darken",children:[t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),t.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),Fo=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),Ir=e=>{let{size:i=16,className:r}=e;return t.jsx("button",{type:"button",onClick:n=>{e.onCheckedChange(!e.checked)},className:r,children:e.checked?t.jsx("svg",{width:i,height:i,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.66 1.953A2.667 2.667 0 0 0 1.995 4.62v6.667a2.667 2.667 0 0 0 2.667 2.666h6.666a2.667 2.667 0 0 0 2.667-2.666V4.62a2.667 2.667 0 0 0-2.667-2.667zm6.664 2.922a.8.8 0 0 1 .557-.208c.2 0 .406.063.558.208a.734.734 0 0 1 0 1.063l-5.434 5.179a.826.826 0 0 1-1.115 0l-2.33-2.22a.736.736 0 0 1 0-1.063.827.827 0 0 1 1.117 0l1.77 1.687z",fill:"#fff",fillOpacity:".8"})}):t.jsx("svg",{width:i,height:i,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M4.66 1.953A2.667 2.667 0 0 0 1.995 4.62v6.667a2.667 2.667 0 0 0 2.667 2.666h6.666a2.667 2.667 0 0 0 2.667-2.666V4.62a2.667 2.667 0 0 0-2.667-2.667zm0 1.334h6.667c.737 0 1.334.596 1.334 1.333v6.667c0 .736-.597 1.333-1.334 1.333H4.661a1.333 1.333 0 0 1-1.334-1.333V4.62c0-.737.597-1.333 1.334-1.333",fill:"#fff",fillOpacity:".8"})})})},Ro=e=>{let{type:i,curType:r,setShareOption:n}=e,s=c.useMemo(()=>{switch(i){case"openPrice":return"Open price";case"openTime":return"Opened at";case"markPrice":return"Mark price";case"quantity":return"Quantity";case"leverage":return"Leverage"}},[i]),o=r.has(i);return t.jsxs(y,{itemAlign:"center",gap:1,className:z("hover:oui-cursor-pointer"),onClick:()=>{n(a=>{let l=new Set(a);return o?l.delete(i):l.add(i),l})},children:[t.jsx(Ir,{size:16,checked:o,className:"oui-pt-[2px]",onCheckedChange:a=>{n(l=>{let u=new Set(l);return o?u.delete(i):u.add(i),u})}}),t.jsx(p,{size:"xs",intensity:54,children:s})]})},Uo=e=>{let{message:i,setMessage:r,check:n,setCheck:s}=e,[o,a]=c.useState(!1),l=c.useRef(null);return t.jsxs("div",{className:"oui-mt-3 oui-mb-6 oui-flex oui-items-center",children:[t.jsx(Ir,{className:"oui-mt-[2px]",checked:n,onCheckedChange:u=>{s(u)}}),t.jsx("div",{className:"oui-text-xs oui-text-base-contrast-54 oui-ml-1 hover:oui-cursor-pointer",onClick:()=>{s(!e.check)},children:"Your message"}),t.jsx("div",{className:"oui-bg-base-900 oui-mx-2 oui-rounded-sm",children:t.jsx(be,{ref:l,placeholder:"Max 25 characters",classNames:{root:"oui-w-[320px]"},size:"sm",value:i,autoFocus:!1,suffix:o&&t.jsx("button",{className:"oui-mr-3 oui-cursor-pointer",onMouseDown:u=>{r(""),setTimeout(()=>{var d;(d=l.current)==null||d.focus()},50),u.stopPropagation()},children:t.jsx(ar,{size:18,color:"white"})}),onFocus:()=>a(!0),onBlur:()=>a(!1),onChange:u=>{if(u.target.value.length>25){F.error("Maximum support of 25 characters");return}s(u.target.value.length>0),r(u.target.value)}})})]})},Wo=e=>{let{onClickDownload:i,onClickCopy:r}=e;return t.jsxs(y,{px:8,gap:3,mt:3,itemAlign:"center",children:[t.jsxs(J,{color:"secondary",className:"oui-flex-1 oui-flex oui-gap-1",onClick:i,children:[t.jsx("span",{children:t.jsx(Bo,{})}),"Download"]}),t.jsxs(J,{className:"oui-flex-1 oui-flex oui-gap-1",onClick:r,children:[t.jsx("span",{children:t.jsx(Qo,{})}),"Copy"]})]})},Bo=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M4.66 1.994A2.667 2.667 0 0 0 1.995 4.66v6.666a2.667 2.667 0 0 0 2.667 2.667h6.666a2.667 2.667 0 0 0 2.667-2.667V4.661a2.667 2.667 0 0 0-2.667-2.667zM7.995 4.66c.368 0 .667.298.667.666V8.66h2l-2.667 2.666L5.328 8.66h2V5.327c0-.368.299-.667.667-.667",fill:"#fff",fillOpacity:".98"})}),Qo=()=>t.jsx("svg",{width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M5.166 1.994A2.667 2.667 0 0 0 2.499 4.66v4a2.667 2.667 0 0 0 2.667 2.667 2.667 2.667 0 0 0 2.666 2.667h4a2.667 2.667 0 0 0 2.667-2.667v-4a2.667 2.667 0 0 0-2.667-2.667 2.667 2.667 0 0 0-2.666-2.666zm6.666 4c.737 0 1.334.596 1.334 1.333v4c0 .737-.597 1.334-1.334 1.334h-4A1.333 1.333 0 0 1 6.5 11.327h2.667a2.667 2.667 0 0 0 2.666-2.667z",fill:"#fff",fillOpacity:".98"})}),Vo=e=>{let{shareOptions:i}=e,r=Dr(),n=e.entity.roi!=null&&e.entity.pnl!=null?["roi_pnl","roi","pnl"]:e.entity.roi!=null?["roi"]:e.entity.pnl!=null?["pnl"]:[],[s,o]=c.useState(n.length==1?n[0]:r.pnlFormat),[a,l]=c.useState(new Set(r.options)),[u,d]=c.useState(r.bgIndex),[f,h]=c.useState(r.message),[x,b]=c.useState(!1),{backgroundImages:m,...g}=i??{backgroundImages:[]},[j,_]=c.useState(""),w=c.useRef(null);c.useEffect(()=>{let N=window.location.hostname;_(N)},[]);let v=c.useMemo(()=>{var N;return(N=i==null?void 0:i.backgroundImages)==null?void 0:N[u]},[i==null?void 0:i.backgroundImages,u]),L=Or(e.entity,e.leverage,x?f:"",j,s,a,e.baseDp,e.quoteDp,e.referral),q=()=>{var N;(N=w.current)==null||N.copy().then(()=>{var C;(C=e.hide)==null||C.call(e),F.success("Image copied")}).catch(C=>{F.error(()=>t.jsxs("div",{children:[t.jsx("div",{children:"Copy failed"}),t.jsx("div",{className:"oui-text-2xs oui-max-w-[396px] oui-mt-2 oui-text-base-contrast-54",children:"Browser version outdated, please update in order to copy image to clipboard."})]}))})},O=()=>{var N,C;(N=w.current)==null||N.download("Poster.png"),(C=e.hide)==null||C.call(e)},T=[...e.entity.openPrice?["openPrice"]:[],...e.entity.markPrice?["markPrice"]:[],...e.entity.openTime?["openTime"]:[],...e.leverage?["leverage"]:[],...e.entity.quantity?["quantity"]:[]];return kr(s,a,u,f),t.jsxs("div",{className:"oui-h-full oui-flex oui-flex-col oui-relative oui-w-full",children:[t.jsxs("div",{className:"oui-flex-1 oui-h-full oui-overflow-y-auto",children:[t.jsxs(G,{mt:9,height:422,children:[t.jsx(y,{itemAlign:"center",justify:"center",children:t.jsx(Tr,{width:552,height:310,data:{backgroundImg:v,...g,data:L},ratio:3,ref:w})}),t.jsx(Mo,{backgroundImages:(i==null?void 0:i.backgroundImages)??[],selectedSnap:u,setSelectedSnap:d})]}),t.jsxs(y,{direction:"column",px:10,mt:6,justify:"start",itemAlign:"start",width:"100%",children:[t.jsx(p,{size:"sm",intensity:80,children:"PnL display format"}),t.jsx(y,{pt:3,gap:3,itemAlign:"center",children:n.map((N,C)=>t.jsx(Ao,{setPnlFormat:o,type:N,curType:s},C))}),t.jsx(ve,{className:"oui-w-full oui-pt-6 oui-border-white/10"}),t.jsxs(y,{mt:6,direction:"column",justify:"start",itemAlign:"start",children:[t.jsx(p,{size:"sm",intensity:80,children:"Optional information to share"}),t.jsx(y,{mt:3,gap:4,children:T.map((N,C)=>t.jsx(Ro,{setShareOption:l,type:N,curType:a},C))})]}),t.jsx(Uo,{message:f,setMessage:h,check:x,setCheck:b})]})]}),t.jsx(Wo,{onClickCopy:q,onClickDownload:O})]})},qr=c.createContext(null);function tt(){let e=c.useContext(qr);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}var Er=c.forwardRef(({orientation:e="horizontal",opts:i,setApi:r,plugins:n,className:s,children:o,...a},l)=>{let[u,d]=Et({...i,axis:e==="horizontal"?"x":"y"},n),[f,h]=c.useState(!1),[x,b]=c.useState(!1),[m,g]=c.useState(a.initIndex||0),[j,_]=c.useState([]),w=c.useCallback(O=>{O&&(j.length===0&&_(O.scrollSnapList()),g(O.selectedScrollSnap()),h(O.canScrollPrev()),b(O.canScrollNext()))},[j]),v=c.useCallback(()=>{d==null||d.scrollPrev()},[d]),L=c.useCallback(()=>{d==null||d.scrollNext()},[d]),q=c.useCallback(O=>{O.key==="ArrowLeft"?(O.preventDefault(),v()):O.key==="ArrowRight"&&(O.preventDefault(),L())},[v,L]);return c.useEffect(()=>{!d||!r||r(d)},[d,r]),c.useEffect(()=>{if(d)return w(d),d.on("reInit",w),d.on("select",w),a.initIndex&&d.scrollTo(a.initIndex),()=>{d==null||d.off("select",w)}},[d,w]),t.jsx(qr.Provider,{value:{carouselRef:u,api:d,opts:i,orientation:e||((i==null?void 0:i.axis)==="y"?"vertical":"horizontal"),scrollPrev:v,scrollNext:L,canScrollPrev:f,canScrollNext:x,selectedIndex:m,scrollSnaps:j},children:t.jsx("div",{ref:l,onKeyDownCapture:q,className:z("oui-relative",s),role:"region","aria-roledescription":"carousel",...a,children:o})})});Er.displayName="Carousel";var di=c.forwardRef(({className:e,...i},r)=>{let{carouselRef:n,orientation:s}=tt();return t.jsx("div",{ref:n,className:"oui-overflow-hidden",children:t.jsx("div",{ref:r,className:z("oui-flex",s==="horizontal"?"oui--ml-4":"oui--mt-4 oui-flex-col",e),...i})})});di.displayName="CarouselContent";var ci=c.forwardRef(({className:e,...i},r)=>{let{orientation:n}=tt();return t.jsx("div",{ref:r,role:"group","aria-roledescription":"slide",className:z("oui-min-w-0 oui-shrink-0 oui-grow-0 oui-basis-full",n==="horizontal"?"oui-pl-4":"oui-pt-4",e),...i})});ci.displayName="CarouselItem";var Mr=c.forwardRef(({className:e,variant:i="contained",size:r="icon",...n},s)=>{let{orientation:o,scrollPrev:a,canScrollPrev:l}=tt();return t.jsxs(J,{ref:s,variant:i,className:z("oui-absolute  oui-h-8 oui-w-8 oui-rounded-full",o==="horizontal"?"oui--left-12 oui-top-1/2 oui--translate-y-1/2":"oui--top-12 oui-left-1/2 oui--translate-x-1/2 oui-rotate-90",e),disabled:!l,onClick:a,...n,children:[t.jsx(ChevronLeft,{size:20}),t.jsx("span",{className:"oui-sr-only",children:"Previous slide"})]})});Mr.displayName="CarouselPrevious";var Ar=c.forwardRef(({className:e,variant:i="contained",size:r="icon",...n},s)=>{let{orientation:o,scrollNext:a,canScrollNext:l}=tt();return t.jsxs(J,{ref:s,variant:i,className:z("oui-absolute oui-h-8 oui-w-8 oui-rounded-full",o==="horizontal"?"oui--right-12 oui-top-1/2 oui--translate-y-1/2":"oui--bottom-12 oui-left-1/2 oui--translate-x-1/2 oui-rotate-90",e),disabled:!l,onClick:a,...n,children:[t.jsx(ChevronRight,{size:20}),t.jsx("span",{className:"oui-sr-only",children:"Next slide"})]})});Ar.displayName="CarouselNext";var $r=e=>{let{scrollSnaps:i,selectedIndex:r}=tt();return t.jsx("div",{className:z("oui-flex oui-gap-1",e.className),children:i.map((n,s)=>t.jsx(zr,{index:s,active:s===r,onClick:e.onClick,className:e.dotClassName,activeClassName:e.dotActiveClassName},s))})};$r.displayName="CarouselIdentifier";var zr=({index:e,active:i,onClick:r,className:n,activeClassName:s})=>t.jsx("button",{onClick:()=>r==null?void 0:r(e),className:z("oui-w-2 oui-h-2 oui-rounded-full oui-bg-white/30",n,i&&`active ${s||"oui-bg-primary-darken"}`)}),it=Er;it.Content=di;it.Item=ci;it.Next=Ar;it.Previous=Mr;it.indentify=$r;var Ho=e=>{var P,E;let{shareOptions:i}=e,r=Dr(),n=e.entity.roi!=null&&e.entity.pnl!=null?["roi_pnl","roi","pnl"]:e.entity.roi!=null?["roi"]:e.entity.pnl!=null?["pnl"]:[],[s,o]=c.useState(n.length==1?n[0]:r.pnlFormat),[a,l]=c.useState(new Set(r.options)),[u,d]=c.useState(r.message),[f,h]=c.useState(r.bgIndex),{backgroundImages:x,...b}=i??{backgroundImages:[]},[m,g]=c.useState(""),j=(P=i==null?void 0:i.backgroundImages)==null?void 0:P.map(()=>c.useRef(null));c.useEffect(()=>{let M=window.location.hostname;g(M)},[]);let _=Or(e.entity,e.leverage,u,m,s,a,e.baseDp,e.quoteDp,e.referral),w=c.useRef(),v=552/310,[L,q]=c.useState(1),[O,T]=c.useState(0),[N,C]=c.useState(!1),S=c.useRef(null);c.useEffect(()=>{if(w.current){let M=w.current.offsetWidth,R=M/v;T(R),q(M/552)}},[w,m]);let I=async M=>{var re,k;if(!M.current)return;let R=(re=M.current)==null?void 0:re.toDataURL(),se=Yo(R);try{navigator.share&&await navigator.share({text:u,files:[new File([se],"image.png",{type:"image/png"})]}),(k=e.hide)==null||k.call(e)}catch{}};return kr(s,a,f,u),t.jsxs("div",{className:"oui-w-full",children:[t.jsx("div",{ref:w,className:"oui-w-full oui-mt-4 oui-overflow-hidden",style:{height:`${O+20}px`},children:t.jsxs(it,{className:"oui-w-full oui-overflow-hidden",opts:{align:"start"},initIndex:f,children:[t.jsx(di,{style:{height:`${O}px`},children:(E=i==null?void 0:i.backgroundImages)==null?void 0:E.map((M,R)=>t.jsx(ci,{children:t.jsx(Tr,{className:"oui-transform oui-origin-top-left",style:{scale:`${L}`},width:552,height:310,data:{backgroundImg:M,...b,data:_},ratio:3,ref:j==null?void 0:j[R]})},R))}),t.jsx("div",{className:"oui-mt-2 oui-mb-1 oui-flex oui-justify-center",children:t.jsx(Go,{dotClassName:"oui-w-[16px] oui-h-[4px] oui-bg-base-300",dotActiveClassName:"!oui-bg-primary-darken oui-w-[20px]",setSelectIndex:h})})]})}),t.jsxs(or,{className:"oui-max-h-[200px] oui-overflow-y-auto oui-custom-scrollbar",children:[t.jsxs("div",{className:"oui-mt-4",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54",children:"PnL display format"}),t.jsx("div",{className:"oui-pt-3 oui-px-1 oui-justify-between oui-gap-3 oui-grid oui-grid-cols-3 oui-row-span-1",children:n.map(M=>t.jsx(Ko,{setPnlFormat:o,type:M,curType:s}))})]}),t.jsxs("div",{className:"oui-mt-3",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54 oui-h-[18px]",children:"Optional information to share"}),t.jsxs("div",{className:"oui-flex oui-flex-wrap oui-gap-3 oui-mt-3",children:[e.entity.openPrice&&t.jsx(nt,{setShareOption:l,type:"openPrice",curType:a}),e.entity.openTime&&t.jsx(nt,{setShareOption:l,type:"openTime",curType:a}),e.leverage&&t.jsx(nt,{setShareOption:l,type:"leverage",curType:a}),e.entity.markPrice&&t.jsx(nt,{setShareOption:l,type:"markPrice",curType:a}),e.entity.quantity&&t.jsx(nt,{setShareOption:l,type:"quantity",curType:a})]})]}),t.jsxs("div",{className:"oui-mt-3 oui-mb-8",children:[t.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54 oui-h-[18px]",children:"Your message"}),t.jsx("div",{className:"oui-mt-3 oui-h-[48px] oui-bg-base-600 oui-mx-1",children:t.jsx(be,{placeholder:"Max 25 characters",containerClassName:"oui-bg-transparent oui-h-[48px]",value:u,autoFocus:!1,onChange:M=>{if(M.target.value.length>25){F.error("Maximum support of 25 characters");return}d(M.target.value)},ref:S,onFocus:()=>C(!0),onBlur:()=>C(!1),suffix:N&&t.jsx("button",{className:"oui-mr-3 oui-cursor-pointer",onMouseDown:M=>{d(""),setTimeout(()=>{var R;(R=S.current)==null||R.focus()},50),M.stopPropagation()},children:t.jsx(ar,{size:18,color:"white"})})})})]})]}),t.jsx("div",{className:"oui-pt-2",children:t.jsx(J,{fullWidth:!0,className:"oui-h-[40px] oui-text-[16px]",onClick:()=>{let M=j==null?void 0:j[f];M&&I(M)},children:"Share"})})]})},Ko=e=>{let{type:i,curType:r,setPnlFormat:n}=e,s=c.useMemo(()=>{switch(i){case"roi_pnl":return"ROI & PnL";case"roi":return"ROI";case"pnl":return"PnL"}},[i]);return t.jsx("div",{className:z("oui-shadow-lg oui-rounded-lg oui-h-[46px] oui-flex-1 oui-bg-base-4 hover:oui-cursor-pointer oui-flex oui-items-center oui-px-3 oui-referral-shadow",i===r&&"oui-bg-primary-darken oui-dot-sel"),onClick:()=>{n(i)},children:t.jsx("div",{className:"oui-text-sm oui-text-base-contrast",children:s})})},nt=e=>{let{type:i,curType:r,setShareOption:n}=e,s=c.useMemo(()=>{switch(i){case"openPrice":return"Open price";case"openTime":return"Opened at";case"markPrice":return"Mark price";case"quantity":return"Quantity";case"leverage":return"Leverage"}},[i]),o=r.has(i);return t.jsxs("div",{className:z("oui-shadow-lg oui-rounded-lg oui-h-[46px] oui-mt-0 oui-w-[calc(50%-6px)] oui-bg-base-4 hover:oui-cursor-pointer oui-items-center oui-flex oui-p-3 oui-referral-shadow"),onClick:()=>{n(a=>{let l=new Set(a);return o?l.delete(i):l.add(i),l})},children:[t.jsx("div",{className:"oui-text-sm oui-flex-1 oui-text-base-contrast",children:s}),o&&t.jsx(Xo,{})]})};function Yo(e){let i=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(i.length),s=new Uint8Array(n);for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o);return new Blob([n],{type:r})}var Go=e=>{let{scrollSnaps:i,selectedIndex:r}=tt();return c.useEffect(()=>{e.setSelectIndex(r)},[r]),t.jsx("div",{className:z("oui-flex oui-gap-1"),children:i.map((n,s)=>t.jsx(zr,{index:s,active:s===r,onClick:e.onClick,className:e.dotClassName,activeClassName:e.dotActiveClassName},s))})},Xo=()=>t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.01416 11.9989C2.01416 6.47589 6.49136 1.9989 12.0142 1.9989C17.5372 1.9989 22.0142 6.47589 22.0142 11.9989C22.0142 17.5219 17.5372 21.9989 12.0142 21.9989C6.49136 21.9989 2.01416 17.5219 2.01416 11.9989ZM16.9853 7.31211C17.2125 7.09537 17.5236 7 17.8218 7C18.1201 7 18.4312 7.09537 18.6583 7.31211C19.1139 7.74546 19.1139 8.47384 18.6583 8.9072L10.5077 16.675C10.0534 17.1083 9.28909 17.1083 8.83472 16.675L5.34077 13.3459C4.88641 12.9126 4.88641 12.1841 5.34077 11.7508C5.79631 11.3175 6.56057 11.3175 7.01493 11.7508L9.67122 14.2822L16.9853 7.31211Z",fill:"white",fillOpacity:"1"})}),Jo=e=>{let{leverage:i,entity:r,baseDp:n,quoteDp:s,referralInfo:o,shareOptions:a,hide:l}=e,[u,d]=c.useState(window.innerHeight<900?660:807);return c.useEffect(()=>{let f=()=>{d(window.innerHeight<900?660:807)};return window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}},[]),a==null||r==null?t.jsx(t.Fragment,{}):t.jsx(Vo,{entity:r,leverage:`${i}`,hide:l,baseDp:n,quoteDp:s,referral:o,shareOptions:a})},Zo=e=>{let{leverage:i,entity:r,baseDp:n,quoteDp:s,referralInfo:o,shareOptions:a,hide:l}=e;return a==null||r==null?t.jsx(t.Fragment,{}):t.jsx(Ho,{entity:r,leverage:i,hide:l,baseDp:n,quoteDp:s,referral:o,shareOptions:a})},ea=e=>{let i=Lr({hide:e.hide,pnl:e.pnl});return t.jsx(Zo,{...i})},ta=e=>{let i=Lr({hide:e.hide,pnl:e.pnl});return t.jsx(Jo,{...i})},pi="sharePnLDialog",mi="sharePnLBottomSheet";Lt(pi,ta,{contentClassName:"!oui-max-w-[624px] oui-p-0"});Yi(mi,ea,{title:"Share PnL",classNames:{body:"oui-pb-4 oui-pt-0"}});var ia=e=>{let{type:i,values:r}=e,[n,s]=we("TP/SL_Mode","Offset%"),[o,a]=c.useState(!0),l=c.useMemo(()=>{switch(n){case"Offset":return`${i.toLowerCase()}_offset`;case"Offset%":return`${i.toLowerCase()}_offset_percentage`;default:return`${i.toLowerCase()}_pnl`}},[n]),u=c.useMemo(()=>r[n],[r]),d=c.useMemo(()=>[{label:"PnL",value:"PnL",testId:"PnL_menu_item"},{label:"Offset",value:"Offset",testId:"Offset_mneu_item"},{label:"Offset%",value:"Offset%",testId:"Offset%_menu_item"}],[]),f=c.useRef(""),h=b=>{e.onChange(l,b)},x=b=>{let{dp:m=2}=b;return{onRenderBefore:(g,j)=>(g=`${g}`,o&&i==="SL"&&n==="PnL"&&(g=g.startsWith("-")?g:"-"+g),g===""||g==="-"?"":n==="Offset%"?`${new D(g.replace(new RegExp(f.current.replace(".","\\.")+"$"),"")).mul(100).todp(2,4).toString()}${f.current}`:(n==="Offset"&&(g=Ut(g,m)),`${g}`)),onSendBefore:g=>{if(/^\-?0{2,}$/.test(g))return"0";if(n==="Offset%"){if(g!==""){g=Ut(g,2);let j=g.match(/\.0{0,2}$/);j?f.current=j[0]:f.current="",g=new D(g).div(100).toString(),g=`${g}${f.current}`}}else n==="PnL"&&i==="SL"&&o?g=g.startsWith("-")?g:"-"+g:g=Ut(g,m);return g===""||g==="-"?"":g}}};return{mode:n,modes:d,type:e.type,formatter:x,onModeChange:b=>{s(b)},value:u,pnl:r.PnL,onValueChange:h,quote_dp:e.quote_dp,setFocus:a}},ra=e=>{let{mode:i,modes:r,onModeChange:n,onValueChange:s,quote:o,quote_dp:a,value:l,pnl:u}=e,[d,f]=c.useState(i),[h,x]=c.useState(i==="Offset%"?"%":o),b=c.useMemo(()=>{let m=Number(u);if(isNaN(m)||m===0)return"";if(m>0)return"oui-text-trade-profit";if(m<0)return"oui-text-trade-loss"},[u]);return c.useEffect(()=>{f(i),x(i==="Offset%"?"%":o)},[i]),t.jsx(be,{prefix:i,size:{initial:"lg",lg:"md"},placeholder:h,align:"right",value:l,"data-testid":e.testId,autoComplete:"off",onValueChange:s,formatters:[e.formatter({dp:a,mode:i}),Q.currencyFormatter,Q.decimalPointFormatter],classNames:{input:b,prefix:"oui-text-base-contrast-54",root:"oui-outline-line-12 focus-within:oui-outline-primary-light"},onFocus:()=>{x(""),e.setFocus(!0)},onBlur:()=>{x(i==="Offset%"?"%":o),e.setFocus(!1)},suffix:t.jsxs(t.Fragment,{children:[i==="Offset%"&&!!l&&t.jsx(p,{size:"2xs",color:"inherit",className:z("oui-ml-[2px]",b),children:"%"}),t.jsx(na,{mode:i,modes:r,onModeChange:m=>n(m.value)})]})})},na=e=>t.jsx(Wn,{currentValue:e.mode,menu:e.modes,align:"end",size:"xs",className:"oui-min-w-[80px]",onSelect:i=>e.onModeChange(i),children:t.jsx("button",{className:"oui-p-2",children:t.jsx(ur,{size:12,color:"white"})})}),Mi=e=>{let{testId:i,quote:r,...n}=e,s=ia(n);return t.jsx(ra,{...s,testId:i,quote:r})},sa=e=>{var u,d;let{TPSL_OrderEntity:i,symbolInfo:r,onCancel:n,onComplete:s,status:o,errors:a,isPosition:l}=e;return t.jsxs("div",{id:"orderly-tp_sl-order-edit-content",children:[(!e.isEditing||e.isEditing&&!e.isPosition)&&t.jsxs(t.Fragment,{children:[t.jsx(oa,{maxQty:e.maxQty,quantity:e.orderQuantity??e.maxQty,baseTick:r("base_tick"),dp:r("base_dp"),onQuantityChange:e.setQuantity,quote:r("base"),isEditing:e.isEditing,isPosition:l,errorMsg:(d=(u=e.errors)==null?void 0:u.quantity)==null?void 0:d.message}),t.jsx(ve,{my:4,intensity:8})]}),t.jsx(aa,{sl_pnl:i.sl_pnl,tp_pnl:i.tp_pnl,quote:r("quote"),quote_dp:r("quote_dp"),onPriceChange:e.setOrderPrice,onPnLChange:e.setPnL,errors:a,tp_values:{PnL:`${i.tp_pnl??""}`,Offset:`${i.tp_offset??""}`,"Offset%":`${i.tp_offset_percentage??""}`},sl_values:{PnL:`${i.sl_pnl??""}`,Offset:`${i.sl_offset??""}`,"Offset%":`${i.sl_offset_percentage??""}`},tp_trigger_price:i.tp_trigger_price??"",sl_trigger_price:i.sl_trigger_price??""}),t.jsxs(Se,{cols:2,gap:3,mt:4,children:[t.jsx(J,{size:"md",color:"secondary","data-testid":"tpsl-cancel",onClick:()=>{n==null||n()},children:"Cancel"}),t.jsx(et,{size:"md","data-testid":"tpsl-confirm",disabled:!e.valid||o.isCreateMutating,loading:o.isCreateMutating||o.isUpdateMutating,onClick:()=>{e.onSubmit().then(()=>{s==null||s()},()=>{})},children:"Confirm"})]})]})},oa=e=>{let{isPosition:i}=e,r=c.useRef(null),n=Rn(e.quantity,0,e.maxQty)/100,s=()=>{var l,u;(l=e.onQuantityChange)==null||l.call(e,0),(u=r.current)==null||u.focus(),setTimeout(()=>{var d;(d=r.current)==null||d.setSelectionRange(0,1)},0)},o=l=>{var u;e.baseTick>0&&((u=e.onQuantityChange)==null||u.call(e,ue.formatNumber(l,e.baseTick)??l))},a=(i?"":e.quantity).toString().length>0?e.errorMsg:void 0;return t.jsxs(t.Fragment,{children:[t.jsxs(y,{gap:2,children:[t.jsx("div",{className:"oui-flex-1",children:t.jsx(be.tooltip,{"data-testid":"oui-testid-tpsl-popUp-quantity-input",ref:r,prefix:"Quantity",size:{initial:"lg",lg:"md"},align:"right",value:i?"":e.quantity,autoComplete:"off",classNames:{prefix:"oui-text-base-contrast-54",root:z("oui-bg-base-5 oui-outline-line-12",a&&"oui-outline-danger")},tooltipProps:{content:{className:"oui-bg-base-6 oui-text-base-contrast-80"},arrow:{className:"oui-fill-base-6"}},tooltip:a,color:a?"danger":void 0,formatters:[Q.dpFormatter(e.dp),Q.numberFormatter,Q.currencyFormatter,Q.decimalPointFormatter],onValueChange:l=>{var d,f,h;(d=e.onQuantityChange)==null||d.call(e,l);let u=Number(l);if(u&&u>e.maxQty){let x=i?0:e.maxQty;(f=e.onQuantityChange)==null||f.call(e,x),(h=r.current)==null||h.blur()}},onBlur:l=>o(l.target.value),suffix:i?t.jsx("button",{className:"oui-text-2xs oui-text-base-contrast-54 oui-px-3",onClick:()=>{s()},children:"Entire position"}):t.jsx("span",{className:"oui-text-2xs oui-text-base-contrast-54 oui-px-3",children:e.quote})})}),!e.isEditing&&t.jsx(J,{onClick:()=>{var u;let l=i?0:e.maxQty;(u=e.onQuantityChange)==null||u.call(e,l),l===0&&s()},variant:"outlined",className:z("oui-text-2xs oui-w-[68px] oui-h-[40px] xl:oui-h-[32px]",i?"oui-border-primary-light oui-text-primary-light hover:oui-bg-primary-light/20":"oui-bg-base-6 oui-border-line-12 oui-text-base-contrast-54 hover:oui-bg-base-5"),children:"Position"})]}),t.jsx(y,{mt:2,itemAlign:"center",height:"15px",children:t.jsx(Ze.single,{markCount:5,color:"primary",max:e.maxQty,min:0,showTip:!0,step:e.baseTick,value:e.quantity,onValueCommit:l=>{o(`${l}`)},onValueChange:l=>{var u;(u=e.onQuantityChange)==null||u.call(e,l)}})}),t.jsxs(y,{justify:"between",children:[t.jsx(p.numeral,{rule:"percentages",color:"primary",size:"2xs",children:n}),t.jsxs(y,{itemAlign:"center",gap:1,children:[t.jsx("button",{className:"oui-leading-none",style:{lineHeight:0},onClick:()=>{var l;(l=e.onQuantityChange)==null||l.call(e,e.maxQty)},children:t.jsx(p,{color:"primary",size:"2xs",children:"Max"})}),t.jsx(p.numeral,{rule:"price",size:"2xs",intensity:54,tick:e.baseTick,children:e.maxQty})]})]})]})},aa=e=>{var r,n,s,o;let i=(a,l)=>{e.onPnLChange(a,l)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsxs(y,{justify:"between",children:[t.jsxs(p,{size:"2xs",intensity:80,children:["Take profit ",t.jsx(p,{intensity:36,children:"(market order)"})]}),t.jsxs(y,{children:[t.jsx(p,{size:"2xs",intensity:36,children:"Est. PNL:"}),t.jsx(p.numeral,{size:"2xs",coloring:!0,showIdentifier:!0,className:"oui-ml-1",children:e.tp_pnl??"-"})]})]}),t.jsxs(Se,{cols:2,gap:2,pt:2,pb:4,children:[t.jsx(Ai,{type:"TP",value:e.tp_trigger_price,error:(n=(r=e.errors)==null?void 0:r.tp_trigger_price)==null?void 0:n.message,onValueChange:a=>{e.onPriceChange("tp_trigger_price",a)},quote_dp:e.quote_dp??2}),t.jsx(Mi,{type:"TP",onChange:i,quote:e.quote,quote_dp:e.quote_dp,values:e.tp_values})]})]}),t.jsxs("div",{children:[t.jsxs(y,{justify:"between",children:[t.jsxs(p,{size:"2xs",intensity:80,children:["Stop loss ",t.jsx(p,{intensity:36,children:"(market order)"})]}),t.jsxs(y,{children:[t.jsx(p,{size:"2xs",intensity:36,children:"Est. PNL:"}),t.jsx(p.numeral,{size:"2xs",coloring:!0,showIdentifier:!0,className:"oui-ml-1",children:e.sl_pnl??"-"})]})]}),t.jsxs(Se,{cols:2,gap:2,pt:2,pb:4,children:[t.jsx(Ai,{type:"SL",value:e.sl_trigger_price,error:(o=(s=e.errors)==null?void 0:s.sl_trigger_price)==null?void 0:o.message,onValueChange:a=>{e.onPriceChange("sl_trigger_price",a)},quote_dp:e.quote_dp??2}),t.jsx(Mi,{type:"SL",onChange:i,quote:e.quote,quote_dp:e.quote_dp,values:e.sl_values})]})]})]})},Ai=e=>{let[i,r]=c.useState("USDC");return t.jsx(be.tooltip,{"data-testid":`oui-testid-tpsl-popUp-${e.type.toLowerCase()}-input`,prefix:`${e.type} price`,size:{initial:"lg",lg:"md"},tooltip:e.error,placeholder:i,align:"right",autoComplete:"off",value:e.value,color:e.error?"danger":void 0,classNames:{prefix:"oui-text-base-contrast-54",root:"oui-outline-line-12 focus-within:oui-outline-primary-light"},onValueChange:e.onValueChange,onFocus:()=>{r("")},onBlur:()=>{r("USDC")},formatters:[Q.numberFormatter,Q.dpFormatter(e.quote_dp),Q.currencyFormatter,Q.decimalPointFormatter]})},Fr=e=>{let{symbol:i,tpPrice:r,slPrice:n,qty:s,maxQty:o,side:a,quoteDP:l,baseDP:u,isEditing:d,isPositionTPSL:f}=e,[h,x]=we("orderly_order_confirm",!0),b=vt({size:"xs",intensity:54}),m=f??s>=o;return t.jsxs(t.Fragment,{children:[d&&t.jsx(p,{as:"div",size:"2xs",intensity:80,className:"oui-mb-3",children:`You agree to edit your ${$n(i)} order.`}),t.jsxs(y,{pb:4,children:[t.jsx(G,{grow:!0,children:t.jsx(p.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,as:"div",intensity:80,children:i})}),t.jsxs(y,{gap:1,children:[m&&t.jsx(B,{size:"xs",color:"primary",children:"Position"}),t.jsx(la,{tpPrice:r,slPrice:n}),a===je.SELL?t.jsx(B,{size:"xs",color:"success",children:"Buy"}):t.jsx(B,{size:"xs",color:"danger",children:"Sell"})]})]}),t.jsx(ve,{}),t.jsxs(y,{direction:"column",itemAlign:"stretch",gapY:1,pt:4,className:z(b,"oui-pb-4 xl:oui-pb-5"),children:[t.jsxs(y,{children:[t.jsx(G,{grow:!0,children:"Qty."}),t.jsx("div",{children:m?t.jsx("span",{className:"oui-text-base-contrast",children:"Entire position"}):t.jsx(p.numeral,{intensity:98,dp:u,padding:!1,children:s})})]}),typeof r=="number"&&r>0?t.jsxs(y,{children:[t.jsx(G,{grow:!0,children:"TP Price"}),t.jsx(p.numeral,{as:"div",coloring:!0,unit:"USDC",size:"sm",dp:l,unitClassName:"oui-text-base-contrast-54 oui-ml-1",children:r})]}):null,typeof n=="number"&&n>0?t.jsxs(y,{children:[t.jsx(G,{grow:!0,children:"SL Price"}),t.jsx(p.numeral,{as:"div",coloring:!0,unit:"USDC",size:"sm",dp:l,className:"oui-text-trade-loss",unitClassName:"oui-text-base-contrast-54 oui-ml-1",children:n})]}):null,t.jsxs(y,{children:[t.jsx(G,{grow:!0,children:"Price"}),t.jsx("div",{className:"oui-text-base-contrast",children:"Market"})]})]}),t.jsx(G,{pt:2,children:t.jsxs(y,{gap:1,children:[t.jsx(lr,{id:"disabledConfirm",color:"white",checked:!h,onCheckedChange:g=>{x(!g)}}),t.jsx("label",{htmlFor:"disabledConfirm",className:vt({size:"xs",intensity:54,className:"oui-ml-1"}),children:"Disable order confirmation"})]})})]})},la=e=>{let{tpPrice:i,slPrice:r}=e;return i&&r?t.jsx(B,{size:"xs",color:"neutral",children:"TP/SL"}):i?t.jsx(B,{size:"xs",color:"neutral",children:"TP"}):r?t.jsx(B,{size:"xs",color:"neutral",children:"SL"}):null},ua=e=>{let{position:i,order:r,isEditing:n}=e;if(n&&!r)throw new zn("order is required when isEditing is true");let s=n?r.symbol:i.symbol,o=Ee(),a=c.useRef(W.TP_SL),[l]=we("orderly_order_confirm",!0),[u,{submit:d,deleteOrder:f,setValue:h,validate:x,errors:b,isCreateMutating:m,isUpdateMutating:g}]=Fn({symbol:s,position_qty:i.position_qty,average_open_price:i.average_open_price},{defaultOrder:r,isEditing:n}),j=C=>{h("quantity",C)},_=(C,S)=>{h(C,S)},w=(C,S)=>{h(C,S)},v=c.useMemo(()=>Math.abs(Number(i.position_qty)),[i.position_qty]),L=c.useMemo(()=>{let C=(r==null?void 0:r.algo_type)===W.POSITIONAL_TP_SL?v:r==null?void 0:r.quantity,S=0;if((Number(u.quantity)!==C||!n&&u.quantity)&&(S=1),r&&n){let I=r.child_orders.find(E=>E.algo_type===fe.TAKE_PROFIT),P=r.child_orders.find(E=>E.algo_type===fe.STOP_LOSS);(I==null?void 0:I.trigger_price)!==Number(u.tp_trigger_price)&&typeof typeof u.tp_trigger_price<"u"&&(S=2),(P==null?void 0:P.trigger_price)!==Number(u.sl_trigger_price)&&typeof u.sl_trigger_price<"u"&&(S=3)}return S===1&&!u.tp_trigger_price&&!u.sl_trigger_price&&(S=-1),S},[u.tp_trigger_price,u.sl_trigger_price,u.quantity,r,n]),q=c.useMemo(()=>(r==null?void 0:r.algo_type)===W.POSITIONAL_TP_SL&&Number(u.quantity)<v&&!u.tp_trigger_price&&!u.sl_trigger_price?!1:L>0&&!!u.quantity&&!b,[u.quantity,v,L,b]),O=c.useMemo(()=>n?r&&r.algo_type!==W.POSITIONAL_TP_SL?!1:u.algo_order_id&&u.quantity==0?!0:Number(u.quantity)>=v:Number(u.quantity)>=v,[u.quantity,v,r==null?void 0:r.algo_type,n]);c.useEffect(()=>{if(!n&&O){let C=ue.findTPSLFromOrder(r);!u.tp_trigger_price&&C.tp_trigger_price&&_("tp_trigger_price",C.tp_trigger_price),!u.sl_trigger_price&&C.sl_trigger_price&&_("sl_trigger_price",C.sl_trigger_price)}},[n,O,u]),c.useEffect(()=>{let C=Number(u.quantity)<v?W.TP_SL:W.POSITIONAL_TP_SL;typeof e.onTPSLTypeChange=="function"&&a.current!==C&&e.onTPSLTypeChange(C),a.current=C},[u.quantity,v]);let T=()=>r!=null&&r.algo_order_id&&(r!=null&&r.symbol)?f(r==null?void 0:r.algo_order_id,r==null?void 0:r.symbol):Promise.reject("order id or symbol is invalid"),N=async()=>Promise.resolve().then(()=>typeof e.onConfirm!="function"||!l?d().then(()=>!0,C=>(C!=null&&C.message&&F.error(C.message),Promise.reject(!1))):e.onConfirm(u,{position:i,submit:d,cancel:T})).then(C=>{});return{isEditing:n,symbolInfo:o[s],maxQty:v,setQuantity:j,orderQuantity:u.quantity,isPosition:O,TPSL_OrderEntity:u,setOrderValue:h,setPnL:w,setOrderPrice:_,onSubmit:N,valid:q,errors:b,status:{isCreateMutating:m,isUpdateMutating:g}}},Rr=e=>{let{onCancel:i,onComplete:r,...n}=e,s=ua(n);return t.jsx(sa,{...s,onCancel:i,onComplete:r})},fi=e=>{let{position:i,order:r,baseDP:n,quoteDP:s,buttonProps:o,isEditing:a}=e,[l,u]=c.useState(!1),[d,f]=c.useState(!0),[h]=we("orderly_order_confirm",!0),x=a?(r==null?void 0:r.algo_type)===W.POSITIONAL_TP_SL:void 0;return t.jsxs(ei,{onOpenChange:b=>{d&&u(b)},open:l,children:[t.jsx(ti,{asChild:!0,onClick:()=>{u(!0)},children:e.children||t.jsx(J,{variant:"outlined",size:"sm",color:"secondary",...o,children:e.label})}),t.jsx(ii,{className:z("oui-w-[360px]",d?"oui-visible":"oui-invisible"),align:"end",side:"top",children:t.jsx(Rr,{position:i,order:r,isEditing:a,onComplete:()=>{u(!1)},onCancel:()=>{u(!1)},onConfirm:(b,m)=>{if(!h)return Promise.resolve(!0);f(!1);let g=Math.abs(Number(i.position_qty));if(`${b.tp_trigger_price??""}`.length===0&&`${b.sl_trigger_price??""}`.length===0)return he.confirm({title:"Cancel Order",content:"Are you sure you want to cancel this TP/SL order?",onOk:()=>m.cancel()}).then(()=>(u(!1),f(!0),!0),()=>(f(!0),Promise.reject(!1)));let j=a||!!b&&b.algo_type===W.POSITIONAL_TP_SL&&b.quantity===g;return he.confirm({title:j?"Edit Order":"Confirm Order",onOk:()=>m.submit(),classNames:{body:"!oui-pb-0"},content:t.jsx(Fr,{isPositionTPSL:x,isEditing:j,symbol:b.symbol,qty:Number(b.quantity),maxQty:g,tpPrice:Number(b.tp_trigger_price),slPrice:Number(b.sl_trigger_price),side:b.side,quoteDP:s??2,baseDP:n??2})}).then(()=>(u(!1),f(!0),!0),()=>(f(!0),Promise.reject(!1)))}})})]})},Ur=e=>{let{position:i,order:r,symbolInfo:n,isEditing:s}=e,{resolve:o,hide:a,updateArgs:l}=ri(),[u]=we("orderly_order_confirm",!0),d=s?(r==null?void 0:r.algo_type)===W.POSITIONAL_TP_SL:void 0,f=m=>{s||l({title:m})},h=()=>{o(),a()},{quote_dp:x,base_dp:b}=n;return t.jsxs(t.Fragment,{children:[t.jsx(da,{position:i,symbolInfo:n}),t.jsx(Rr,{...e,onTPSLTypeChange:m=>{f(m===W.TP_SL?"TP/SL":"Position TP/SL")},onComplete:h,onConfirm:(m,g)=>{if(!u)return Promise.resolve(!0);let j=Math.abs(Number(i.position_qty)),_=s||!!m&&m.algo_type===W.POSITIONAL_TP_SL&&m.quantity===j;return he.confirm({title:_?"Edit Order":"Confirm Order",bodyClassName:"oui-pb-0 lg:oui-pb-0",onOk:()=>g.submit(),content:t.jsx(Fr,{isPositionTPSL:d,isEditing:s,symbol:m.symbol,qty:Number(m.quantity),maxQty:j,tpPrice:Number(m.tp_trigger_price),slPrice:Number(m.sl_trigger_price),side:m.side,quoteDP:x??2,baseDP:b??2})}).then(()=>!0,w=>(w!=null&&w.message&&F.error(w.message),Promise.reject(!1)))},onCancel:()=>{a()}})]})},da=e=>{var a;let{position:i,symbolInfo:r}=e,{data:n}=Un(i.symbol),s=ri(),o=c.useMemo(()=>{var l;return((l=s.args)==null?void 0:l.title)==="Position TP/SL"},[(a=s.args)==null?void 0:a.title]);return t.jsxs(t.Fragment,{children:[t.jsxs(y,{justify:"between",pb:3,itemAlign:"center",children:[t.jsx(p.formatted,{rule:"symbol",className:"oui-text-xs",showIcon:!0,children:i.symbol}),t.jsxs(y,{gapX:1,children:[o&&t.jsx(B,{size:"xs",color:"primary",children:"Position"}),t.jsx(B,{size:"xs",color:"neutral",children:"TP/SL"}),i.position_qty<0?t.jsx(B,{size:"xs",color:"buy",children:"Buy"}):t.jsx(B,{size:"xs",color:"sell",children:"Sell"})]})]}),t.jsx(ve,{intensity:8}),t.jsxs(G,{py:3,className:"oui-space-y-1",children:[t.jsxs(y,{justify:"between",children:[t.jsx(p,{size:"sm",intensity:54,children:"Avg. open"}),t.jsx(p.numeral,{className:"oui-text-xs",unit:r.quote,dp:r.quote_dp,unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:i.average_open_price})]}),t.jsxs(y,{justify:"between",children:[t.jsx(p,{size:"sm",intensity:54,children:"Mark price"}),t.jsx(p.numeral,{className:"oui-text-xs",unit:r.quote,dp:r.quote_dp,unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:n})]})]})]})},Wr=c.createContext({}),Ae=()=>c.useContext(Wr),Br=e=>{var C;let[i,r]=c.useState(Math.abs(e.position.position_qty).toString());c.useEffect(()=>{r(Math.abs(e.position.position_qty).toString())},[e.position.position_qty]);let[n,s]=c.useState(""),[o,a]=c.useState(e.position.position_qty>0?je.SELL:je.BUY),[l,u]=c.useState(void 0),[d,f]=c.useState(ie.MARKET),h=Ee(),x=e.position.symbol,b=h==null?void 0:h[x],m=b("quote_dp"),g=b("base_dp"),j=b("base_tick"),{helper:_,onSubmit:w,submitting:v}=Qn((C=e.position)==null?void 0:C.symbol,o,!0),L=(S,I)=>{if(f(S),S===ie.LIMIT){if(!I)throw new Error("price is required");s(I)}else s("")},q=c.useMemo(()=>{let{position:S}=e;if(!S)return null;let I={order_quantity:i,symbol:e.position.symbol,order_type:d,side:o,reduce_only:!0};return d===ie.LIMIT&&(I.order_price=n),I},[e.position,n,d,i]),O=S=>{let I=_.calculate({},"order_quantity",S);r(I.order_quantity)},T=S=>{let I=_.calculate({},"order_price",S);s(I.order_price)};c.useEffect(()=>{let S=q;_.validator(S).then(I=>{u(I)})},[q]);let N=()=>w(q).catch(S=>(typeof S=="string"?F.error(S):F.error(S.message),Promise.resolve()));return t.jsx(Wr.Provider,{value:{quantity:i,price:n,type:d,side:o,position:e.position,updatePriceChange:T,updateQuantity:O,updateOrderType:L,tpslOrder:e.position.algo_order,onSubmit:N,submitting:v,closeOrderData:q,quoteDp:m,baseDp:g,baseTick:j,errors:l},children:e.children})},Qr=c.createContext({}),qe=()=>c.useContext(Qr),Mt=e=>{let i=Ee()[e.symbol];return t.jsx(Qr.Provider,{value:{base_dp:i("base_dp"),quote_dp:i("quote_dp"),base_tick:i("base_tick"),quote_tick:i("quote_tick"),base:i("base"),quote:i("quote"),symbol:e.symbol,origin:i(),quote_max:i("quote_max"),quote_min:i("quote_min")},children:e.children})},ca=()=>{let[e,i]=c.useState(!1),{onSubmit:r,price:n,quantity:s,closeOrderData:o,type:a,submitting:l,quoteDp:u,errors:d}=Ae(),{base:f,quote:h}=qe(),[x]=we("orderly_order_confirm",!0),b=()=>r().then(j=>{i(!1)},j=>{typeof j=="string"?F.error(j):F.error(j.message)}).catch(j=>{typeof j=="string"?F.error(j):F.error(j.message)}),m=()=>{i(!1)},g=c.useMemo(()=>a===ie.MARKET?!s:!n||!s,[n,s,a]);return t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"outlined",size:"sm",color:"secondary",disabled:g||l,loading:l,onClick:j=>{var v,L;j.stopPropagation();let _=(v=d==null?void 0:d.order_quantity)==null?void 0:v.message,w=(L=d==null?void 0:d.order_price)==null?void 0:L.message;if(_||w){F.error(_??w);return}if(!x){r();return}i(!0)},children:"Close"}),t.jsx(gt,{open:e,onOpenChange:i,size:"sm",children:a===ie.MARKET?t.jsx(hi,{base:f,quantity:s,onClose:m,onConfirm:b,submitting:l,classNames:{root:"oui-items-start"},hideCloseIcon:!0}):t.jsx(Kr,{base:f,quantity:s,price:n,onClose:m,onConfirm:b,submitting:l,quoteDp:u,order:o,hideCloseIcon:!0})})]})},Vr=e=>{let{hideCloseIcon:i=!1}=e;return t.jsxs("div",{className:"oui-pb-3 oui-border-b oui-border-line-4 oui-relative oui-w-full",children:[t.jsx(p,{size:"base",children:e.title}),!i&&t.jsx("button",{onClick:e.onClose,className:"oui-absolute oui-right-0 oui-top-0 oui-text-base-contrast-54 hover:oui-text-base-contrast-80 oui-p-2",children:t.jsx(fr,{size:18,color:"white"})})]})},Hr=({onCancel:e,onConfirm:i,submitting:r})=>t.jsxs(y,{id:"oui-positions-confirm-footer",gap:2,width:"100%",className:"oui-mt-3 oui-pb-1",children:[t.jsx(J,{id:"oui-positions-confirm-footer-cancel-button",color:"secondary",fullWidth:!0,onClick:e,size:"md",children:"Cancel"}),t.jsx(et,{id:"oui-positions-confirm-footer-confirm-button",onClick:i,fullWidth:!0,loading:r,size:"md",children:"Confirm"})]}),pa=e=>{let{quantity:i,price:r,quoteDp:n,side:s}=e,o=c.useMemo(()=>r&&i?new D(r).mul(i).toFixed(n,D.ROUND_DOWN):"--",[r,i]);return t.jsxs(y,{direction:"column",gap:1,width:"100%",className:"oui-text-sm oui-text-base-contrast-54",py:5,children:[t.jsxs(y,{justify:"between",width:"100%",gap:1,children:[t.jsx(p,{children:"Qty."}),t.jsx(p,{color:s===je.BUY?"success":"danger",children:i})]}),t.jsxs(y,{justify:"between",width:"100%",gap:1,children:[t.jsx(p,{children:"Price"}),t.jsx(p.formatted,{intensity:98,suffix:t.jsx(p,{intensity:54,children:"USDC"}),children:r})]}),t.jsxs(y,{justify:"between",width:"100%",gap:1,children:[t.jsx(p,{children:"Notional"}),t.jsx(p.formatted,{intensity:98,suffix:t.jsx(p,{intensity:54,children:"USDC"}),children:o})]})]})},hi=e=>{var r;let i=()=>{var n;(n=(e==null?void 0:e.onClose)??e.close)==null||n()};return t.jsxs(y,{direction:"column",className:(r=e.classNames)==null?void 0:r.root,children:[t.jsx(Vr,{onClose:i,title:"Market Close",hideCloseIcon:e.hideCloseIcon}),t.jsx(p,{intensity:54,size:"sm",className:"oui-my-5",children:`You agree closing ${X(e.quantity)} ${e.base} position at market price.`}),t.jsx(Hr,{onCancel:i,onConfirm:async()=>{var n;await((n=e.onConfirm)==null?void 0:n.call(e)),i()},submitting:e.submitting})]})},Kr=e=>{let{order:i,quoteDp:r,quantity:n,price:s,submitting:o}=e,{side:a}=i,l=()=>{var u;(u=e.onClose)==null||u.call(e)};return t.jsxs(t.Fragment,{children:[t.jsx(Vr,{onClose:l,title:"Limit Close",hideCloseIcon:e.hideCloseIcon}),t.jsx(p,{intensity:54,size:"sm",className:"oui-mt-5",children:`You agree closing ${mr(e.quantity)} ${e.base} position at limit price.`}),t.jsxs(y,{gap:2,mb:4,mt:5,justify:"between",children:[t.jsx(p.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,children:i.symbol}),t.jsxs(y,{gap:1,children:[t.jsx(B,{color:"neutral",size:"xs",children:"Limit"}),t.jsx(B,{color:a===je.BUY?"success":"danger",size:"xs",children:a===je.BUY?"Buy":"Sell"})]})]}),t.jsx(ve,{className:"oui-w-full"}),t.jsx(pa,{className:"oui-text-sm",price:s,quantity:n,side:i.side,quoteDp:r??2}),t.jsx(Hr,{onCancel:l,onConfirm:e.onConfirm,submitting:e.submitting})]})},ma=()=>{let{type:e,quoteDp:i,price:r,updatePriceChange:n,updateOrderType:s,position:o}=Ae(),[a,l]=c.useState(!1);return t.jsxs(rr,{children:[t.jsx(be,{size:"sm",value:e===ie.LIMIT?r:"Market",onValueChange:u=>n(u),formatters:[Q.numberFormatter,...i?[Q.dpFormatter(i)]:[]],onFocus:u=>{e===ie.MARKET&&s(ie.LIMIT,`${o.mark_price}`),l(!0)},onBlur:u=>{setTimeout(()=>{l(!1)},100)},suffix:t.jsx(nr,{asChild:!0,children:t.jsx("button",{className:"oui-px-1 oui-h-full",children:t.jsx(ur,{size:12,color:"white"})})}),classNames:{root:z("oui-outline-line-12 focus-within:oui-outline-primary-light")}}),t.jsx(sr,{align:"end",className:"oui-w-[96px] oui-min-w-[96px]",onCloseAutoFocus:u=>u.preventDefault(),children:t.jsx(Hn,{children:t.jsx(Kn,{size:"xs",onSelect:u=>{s(ie.MARKET)},children:t.jsx("span",{children:"Market"})})})})]})},fa=e=>{let[i,r]=c.useState(!1),[n,s]=c.useState(100),{baseDp:o,quoteDp:a,updateQuantity:l,quantity:u,type:d,errors:f,baseTick:h}=Ae();c.useEffect(()=>{let m=g=>{g.target.closest("[data-popover-root]")||r(!1)};return document.addEventListener("click",m),()=>{document.removeEventListener("click",m)}},[]);let x=m=>{b(`${e.value*(m/100)}`)},b=m=>{if(h&&h>0){let g=ue.formatNumber(m,h)??m;l(g)}};return t.jsxs(ei,{children:[t.jsx(ti,{children:t.jsx(be,{size:"sm",onFocus:()=>{r(!0)},classNames:{root:"oui-outline-line-12 "},formatters:[Q.numberFormatter,...o?[Q.dpFormatter(o)]:[]],value:u,onBlur:m=>b(m.target.value),onValueChange:m=>{if(l(m),m=="0"||m==""){s(0);return}let g=new D(m).div(e.value).mul(100).abs().toFixed(0,D.ROUND_DOWN);s(Math.min(100,Number(g)))}})}),t.jsx(ii,{className:"oui-w-[360px] oui-rounded-xl",align:"start",side:"bottom",onOpenAutoFocus:m=>{m.preventDefault()},children:t.jsxs(y,{p:1,gap:2,width:"100%",itemAlign:"start",children:[t.jsx(p,{size:"xs",intensity:98,className:"oui-min-w-[30px]",children:`${n}%`}),t.jsxs(y,{direction:"column",width:"100%",gap:2,children:[t.jsx(Ze,{markCount:4,value:[n],onValueChange:m=>{let g=Array.from(m.values());s(g[0]),x(g[0])}}),t.jsx(ha,{onClick:m=>{s(m*100),x(m*100)}})]})]})})]})},ha=e=>t.jsx(y,{gap:2,width:"100%",children:[{label:"0%",value:0},{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:"Max",value:1}].map((i,r)=>t.jsx(J,{variant:"outlined",color:"secondary",size:"xs",onClick:n=>{n.stopPropagation(),e.onClick(i.value)},className:"oui-w-1/5",children:i.label},r))}),xa=(e,i)=>{let r=qe();return t.jsx(p.numeral,{dp:r.base_dp,rm:D.ROUND_DOWN,padding:!1,coloring:!0,children:e})},ga=(e,i)=>t.jsx(fa,{value:i.position_qty}),ya=e=>t.jsx(ma,{}),ba=e=>{if(e.sharePnLConfig==null)return t.jsx(t.Fragment,{});let{position:i}=e;return t.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),he.show(e.modalId,{pnl:{entity:{symbol:i.symbol,pnl:i.unrealized_pnl,roi:new D(i.unrealized_pnl_ROI*100).toFixed(2,D.ROUND_DOWN),side:i.position_qty>0?"LONG":"SHORT",openPrice:i.average_open_price,openTime:i.timestamp,markPrice:i.mark_price,quantity:i.position_qty},refCode:e.refCode,leverage:e.leverage,...e.sharePnLConfig}})},children:t.jsx(pr,{color:"white",opacity:.54,size:e.iconSize??16})})},ja=e=>{let{sharePnLConfig:i,position:r,modalId:n,iconSize:s}=e,{getFirstRefCode:o}=Zt(),a=c.useMemo(()=>{var u;return(u=o())==null?void 0:u.code},[o]),l=cr(e.position.symbol);return{iconSize:s,position:r,refCode:a,leverage:l,sharePnLConfig:i,modalId:n}},Yr=e=>{let i=ja(e);return t.jsx(ba,{...i})},_a=()=>{let{position:e,baseDp:i,quoteDp:r,tpslOrder:n}=Ae();return t.jsx(fi,{position:e,order:n,label:"TP/SL",baseDP:i,quoteDP:r,isEditing:!1})},wa=()=>{let{position:e,baseDp:i,quoteDp:r,tpslOrder:n}=Ae();return t.jsx(fi,{position:e,order:n,baseDP:i,quoteDP:r,isEditing:!0,children:t.jsx(Yn,{opacity:1,className:"oui-text-base-contrast-54 oui-cursor-pointer",size:16})})},va=e=>{let{stopLossPrice:i,takeProfitPrice:r}=e,{tpslOrder:n,position:s}=Ae();return t.jsx(Na,{stopLossPrice:i,takeProfitPrice:r,direction:"column",order:n,position:s,tooltip:!0})},$i=e=>{let{qty:i,price:r,entryPrice:n,orderSide:s,orderType:o,symbolInfo:a}=e,l=ue.priceToPnl({qty:i,price:r,entryPrice:n,orderSide:s,orderType:o},{symbol:a}),u=o===fe.TAKE_PROFIT?"TP":"SL";return t.jsxs(y,{children:[t.jsx(p,{intensity:54,className:"oui-mr-1",children:`${u} PnL:`}),t.jsx(p.formatted,{rule:"price",className:l===0?"oui-text-base-contrast-36":l>0?"oui-text-trade-profit oui-gap-0":"oui-text-trade-loss oui-gap-0",prefix:t.jsx(p,{children:l===0?"":l>0?"+":"-"}),suffix:t.jsx(p,{intensity:36,className:"oui-ml-1",children:"USDC"}),children:`${Math.abs(l)}`})]})},Na=e=>{let{direction:i="row",order:r,position:n}=e,s=Ee(),o=c.useMemo(()=>{let d=[];if(!e.tooltip||!r||!n)return;let f=r.quantity;return f===0&&r.child_orders[0].type==="CLOSE_POSITION"&&(f=n.position_qty),e.takeProfitPrice&&d.push(t.jsx($i,{qty:f,price:e.takeProfitPrice,entryPrice:n.average_open_price,orderSide:r.side,orderType:fe.TAKE_PROFIT,symbolInfo:s[r.symbol]()},"tp")),e.stopLossPrice&&d.push(t.jsx($i,{qty:f,price:e.stopLossPrice,entryPrice:n.average_open_price,orderSide:r.side,orderType:fe.STOP_LOSS,symbolInfo:s[r.symbol]()},"sl")),t.jsx("div",{children:d})},[e.takeProfitPrice,e.stopLossPrice,n==null?void 0:n.average_open_price,r==null?void 0:r.side,r==null?void 0:r.quantity,r==null?void 0:r.algo_type]),a=c.useMemo(()=>{let d=[];return r!=null&&r.symbol?(e.takeProfitPrice&&d.push(t.jsx(p.formatted,{className:z("oui-text-trade-profit oui-gap-0  oui-decoration-white/20"),rule:"price",dp:s[r.symbol]("quote_dp",2),children:e.takeProfitPrice,prefix:!e.stopLossPrice||i==="column"?t.jsx(p,{intensity:54,children:"TP - "}):""},"tp")),e.stopLossPrice&&d.push(t.jsx(p.formatted,{className:z("oui-text-trade-loss oui-gap-0 oui-decoration-white/20 "),rule:"price",dp:s[r.symbol]("quote_dp",2),children:e.stopLossPrice,prefix:!e.takeProfitPrice||i==="column"?t.jsx(p,{intensity:54,children:"SL - "}):""},"sl")),d.length===0?t.jsx(p,{children:"-"}):(d.length===2&&i==="row"&&d.splice(1,0,t.jsx(p,{children:"/"},"split")),d)):t.jsx("span",{children:"-"})},[e.takeProfitPrice,e.stopLossPrice,r==null?void 0:r.symbol]),l=t.jsx("div",{className:z("oui-inline-flex oui-text-base-contrast-36",e.direction==="column"?"oui-flex-col":"oui-flex-row oui-gap-1",e.className),children:a}),u=Array.isArray(a)?!!a.length:!a;return e.tooltip?t.jsxs(y,{gapX:2,children:[t.jsx(Ie,{content:o,children:l}),u&&t.jsx(wa,{})]}):l},Ca=e=>{let[i,r]=we("unPnlPriceBasis","markPrice");return t.jsxs(y,{direction:"column",gap:3,className:"oui-text-base-contrast-54 oui-items-start",children:[t.jsx(p,{children:"Current unrealized profit or loss on your open positions across all widgets calculated using Mark Price."}),t.jsx(ve,{className:"oui-w-full"}),t.jsx("div",{className:"oui-mb-0",children:"Unrealized PnL Price Basis"}),t.jsx(Sa,{value:i,onValueChange:r})]})},Sa=e=>{let{value:i,onValueChange:r}=e;return t.jsxs(y,{gap:2,children:[t.jsx(zi,{sel:i==="markPrice",label:"Mark price",value:"markPrice",onCheckChange:r}),t.jsx(zi,{sel:i==="lastPrice",label:"Last price",value:"lastPrice",onCheckChange:r})]})},zi=e=>{let{sel:i,label:r,value:n,onCheckChange:s}=e;return t.jsxs(y,{onClick:o=>{s(n),o.stopPropagation()},gap:1,className:"oui-cursor-pointer",children:[i?t.jsx(Pa,{}):t.jsx(La,{}),t.jsx(p,{size:"xs",intensity:i?98:54,children:r})]})},Pa=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-white",children:[t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),t.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),La=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),Bt=e=>{let{tick:i="quote_dp",...r}=e,n=qe();if(!n)throw new Error("NumeralWithCtx must be used inside SymbolProvider");return t.jsx(p.numeral,{as:"span",...r,dp:n[i]})},Oa=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r}=e;return c.useMemo(()=>[{title:"Symbol",dataIndex:"symbol",fixed:"left",width:140,onSort:(n,s)=>n.symbol.localeCompare(s.symbol),render:(n,s)=>t.jsxs(y,{gap:2,children:[t.jsx(G,{width:4,height:20,className:z("oui-rounded-[1px]",s.position_qty>0?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsx(p.formatted,{formatString:"base-type",className:"oui-cursor-pointer",onClick:o=>{var a;(a=e.onSymbolChange)==null||a.call(e,{symbol:n}),o.stopPropagation(),o.preventDefault()},children:`${n.split("_")[1]}-PERP`})]})},{title:"Quantity",dataIndex:"position_qty",onSort:(n,s)=>n.position_qty-s.position_qty,width:120,className:"oui-pl-6",render:xa},{title:"Avg. open",className:"oui-h-[48px]",width:120,onSort:!0,dataIndex:"average_open_price",render:(n,s)=>t.jsx(Bt,{rm:D.ROUND_DOWN,children:n})},{title:"Mark price",dataIndex:"mark_price",width:120,onSort:!0,className:"oui-h-[48px]",render:(n,s)=>t.jsx(Bt,{rm:D.ROUND_DOWN,children:n})},{title:t.jsx(Ie,{className:"oui-max-w-[280px] oui-text-2xs oui-text-base-contrast-54 oui-p-3 oui-bg-base-8",content:"Estimated price at which your position will be liquidated. Prices are estimated and depend on multiple factors across all positions.",children:t.jsx(p,{children:"Liq. price"})}),width:100,onSort:!0,dataIndex:"est_liq_price",render:(n,s)=>Number(n)===0?"--":t.jsx(Bt,{rm:D.ROUND_DOWN,className:Number(n)>0?"oui-text-warning-light":"",children:n??"--"})},{title:t.jsx(Vn,{content:t.jsx(Ca,{}),side:"top",align:"center",className:"oui-max-w-[280px] oui-text-2xs",children:t.jsx(p,{children:"Unreal. PnL"})}),dataIndex:"unrealized_pnl",width:150,onSort:!0,rule:"price",numeralProps:{coloring:!0},render:(n,s)=>t.jsxs(y,{gap:2,children:[t.jsxs(y,{children:[t.jsx(p.numeral,{dp:e.pnlNotionalDecimalPrecision,rm:D.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",children:n}),t.jsx(p.numeral,{rule:"percentages",dp:e.pnlNotionalDecimalPrecision,rm:D.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",prefix:"(",suffix:")",children:s.unrealized_pnl_ROI})]}),t.jsx(Yr,{position:s,sharePnLConfig:e.sharePnLConfig,modalId:pi})]})},{title:"TP/SL",dataIndex:"__",width:150,render:(n,s)=>t.jsx(va,{stopLossPrice:s.sl_trigger_price,takeProfitPrice:s.tp_trigger_price})},{title:"Notional",dataIndex:"notional",className:"oui-h-[48px]",width:100,onSort:!0,render:n=>t.jsx(p.numeral,{dp:i,children:n})},{title:t.jsx(Ie,{className:"oui-max-w-[280px] oui-text-2xs oui-text-base-contrast-54 oui-p-3 oui-bg-base-8",content:t.jsxs(y,{direction:"column",gap:3,className:"oui-text-base-contrast-54 oui-bg-base-8 oui-rounded-sm",children:[t.jsx("span",{children:"The minimum equity to keep your position. "}),t.jsx(ve,{className:"oui-w-full"}),t.jsx("span",{children:"Margin = Position size * Mark price * MMR"})]}),children:t.jsx(p,{children:"Margin"})}),dataIndex:"mm",onSort:!0,width:100,rule:"price",render:n=>t.jsx(p.numeral,{children:n})},{title:"Qty.",dataIndex:"close_qty",width:100,fixed:"right",render:ga},{title:"Price",dataIndex:"close_price",width:100,fixed:"right",render:ya},{title:"",dataIndex:"close_position",align:"right",width:160,fixed:"right",render:n=>t.jsxs(y,{gapX:2,justify:"end",children:[t.jsx(ca,{}),t.jsx(_a,{})]})}],[i,r])},ka=e=>{let{item:i}=e,r=i.position_qty>0;return t.jsx(p.formatted,{rule:"symbol",formatString:"base-type",size:"2xs",suffix:t.jsx(B,{color:r?"success":"danger",size:"xs",children:r?"Buy":"Sell"}),showIcon:!0,onClick:()=>{var n;(n=e.onSymbolChange)==null||n.call(e,{symbol:i.symbol})},children:i.symbol})},Da=e=>{let{item:i}=e;return t.jsxs(y,{gap:3,children:[t.jsxs(y,{direction:"column",className:"oui-text-2xs",itemAlign:"end",children:[t.jsxs(p,{intensity:36,children:["Unreal. PnL",t.jsx(p,{intensity:20,children:"(USDC)"})]}),t.jsx(p.numeral,{size:"xs",dp:e.pnlNotionalDecimalPrecision,rm:D.ROUND_DOWN,coloring:!0,className:"orderly-font-semibold",suffix:t.jsx(p.numeral,{rule:"percentages",dp:e.pnlNotionalDecimalPrecision,rm:D.ROUND_DOWN,prefix:"(",suffix:")",className:z("oui-ml-1",i.unrealized_pnl_ROI>0?"oui-text-success-darken":"oui-text-danger-darken"),children:i.unrealized_pnl_ROI}),children:i.unrealized_pnl})]}),t.jsx(Yr,{position:i,sharePnLConfig:e.sharePnLConfig,modalId:mi,iconSize:12})]})},Ta=e=>{let{item:i}=e;return t.jsx(ee,{label:"Qty.",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.base_dp,padding:!1,coloring:!0,children:i.position_qty})})},Ia=e=>{let{item:i}=e;return t.jsx(ee,{label:t.jsxs(p,{children:["Margin",t.jsx(p,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,intensity:80,children:i.mm})})},qa=e=>{let{item:i}=e;return t.jsx(ee,{align:"end",label:t.jsxs(p,{children:["Notional",t.jsx(p,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,intensity:80,children:i.notional})})},Ea=e=>{let{item:i}=e;return t.jsx(ee,{label:"Avg. open",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,intensity:80,children:i.average_open_price})})},Ma=e=>{let{item:i}=e;return t.jsx(ee,{label:"Mark price",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,intensity:80,children:i.mark_price})})},Aa=e=>{let{item:i}=e,r=i.est_liq_price&&i.est_liq_price>0?i.est_liq_price:"-";return t.jsx(ee,{label:"Liq. price",align:"end",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,color:"warning",children:r})})},$a=e=>{let{item:i}=e;return i.tp_trigger_price==null&&i.sl_trigger_price==null?t.jsx(t.Fragment,{}):t.jsxs(y,{className:"oui-text-2xs oui-text-base-contrast-36",children:[t.jsx(p,{children:"TP/SL: "}),t.jsxs(y,{className:"oui-gap-[2px]",children:[i.tp_trigger_price&&t.jsx(p.numeral,{color:"buy",children:i.tp_trigger_price}),i.sl_trigger_price&&"/",i.sl_trigger_price&&t.jsx(p.numeral,{color:"sell",children:i.sl_trigger_price})]})]})},za=e=>{var w,v,L,q,O,T,N,C;let{item:i,sheetOpen:r,setSheetOpen:n,dialogOpen:s,setDialogOpen:o,updatePriceChange:a,base:l,quantity:u,price:d,onClose:f,onConfirm:h,submitting:x,quote_dp:b,closeOrderData:m,onCloseDialog:g}=e,j=i.position_qty>0,_=S=>{if(e.baseTick&&e.baseTick>0){let I=ue.formatNumber(S,e.baseTick)??S;e.updateQuantity(I)}};return t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:()=>{a("limit"),n(!0)},children:"Limit Close"}),r&&t.jsx(Xn,{title:"Limit close",open:r,onOpenChange:n,children:t.jsxs(y,{direction:"column",gap:3,width:"100%",itemAlign:"start",className:"oui-text-sm",children:[t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(p.formatted,{rule:"symbol",showIcon:!0,children:i.symbol}),t.jsxs(y,{gap:1,children:[t.jsx(B,{color:"neutral",size:"xs",children:"Limit"}),j&&t.jsx(B,{color:"success",size:"xs",children:"Buy"}),!j&&t.jsx(B,{color:"danger",size:"xs",children:"Sell"})]})]}),t.jsx(ve,{className:"oui-w-full"}),t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(p,{intensity:54,children:"Last price"}),t.jsx(p.numeral,{dp:(v=(w=e.item)==null?void 0:w.symbolInfo)==null?void 0:v.quote_dp,suffix:t.jsx(p,{intensity:36,children:"USDC"}),children:e.curMarkPrice})]}),t.jsxs(y,{width:"100%",direction:"column",gap:2,children:[t.jsx(be.tooltip,{prefix:"Price",suffix:e.quote,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.quote_dp)],triggerClassName:"oui-w-full",tooltip:(q=(L=e.errors)==null?void 0:L.order_price)==null?void 0:q.message,color:(T=(O=e.errors)==null?void 0:O.order_price)!=null&&T.message?"danger":void 0,value:e.price,onValueChange:S=>e.updatePriceChange(S),classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:z("oui-outline-line-12 oui-w-full",(C=(N=e.errors)==null?void 0:N.order_price)!=null&&C.message?"oui-outline-danger":void 0)}}),t.jsx(be,{prefix:"Quantity",suffix:e.base,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.base_dp)],value:e.quantity,onBlur:S=>_(S.target.value),onValueChange:S=>{e.updateQuantity(S);let I=new D(S).div(e.item.position_qty).mul(100).toDecimalPlaces(2,D.ROUND_DOWN).toNumber();e.setSliderValue(I)},classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:z("oui-outline-line-12 oui-w-full")}}),t.jsx(Ze,{markCount:4,value:[e.sliderValue],color:"primary",onValueChange:S=>{e.setSliderValue(S[0]);let I=new D(S[0]).div(100).mul(e.item.position_qty).toFixed(e.base_dp,D.ROUND_DOWN);_(I)}}),t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(p,{color:"primary",size:"2xs",children:`${e.sliderValue}%`}),t.jsxs(y,{gap:1,children:[t.jsx(p,{size:"2xs",color:"primary",children:"Max"}),t.jsx(p.numeral,{intensity:54,size:"2xs",children:Math.abs(e.item.position_qty)})]})]})]}),t.jsxs(y,{width:"100%",gap:3,mt:2,children:[t.jsx(J,{fullWidth:!0,color:"secondary",onClick:S=>{f()},children:"Cancel"}),t.jsx(et,{fullWidth:!0,disabled:x,loading:x,onClick:S=>{var M,R;S.stopPropagation(),S.preventDefault();let I=e.errors,P=(M=I==null?void 0:I.order_quantity)==null?void 0:M.message,E=(R=I==null?void 0:I.order_price)==null?void 0:R.message;if(P||E){F.error(P??E);return}if(!e.orderConfirm){h();return}o(!0)},children:"Confirm"})]})]})}),s&&t.jsx(gt,{open:s,onOpenChange:o,size:"xs",children:t.jsx(Kr,{base:l,quantity:u,price:d,onClose:g,onConfirm:h,submitting:x,quoteDp:b,order:m,hideCloseIcon:!0})})]})},Fa=e=>{let{state:i}=e,[r,n]=c.useState(!1),[s,o]=c.useState(!1),{onSubmit:a,price:l,quantity:u,closeOrderData:d,submitting:f,type:h,updatePriceChange:x,updateOrderType:b,updateQuantity:m,errors:g,baseTick:j}=Ae(),_=c.useRef(!1),[w,v]=c.useState(100),[L]=we("orderly_order_confirm",!0),q=()=>a().then(M=>{n(!1),o(!1)},M=>{typeof M=="string"?F.error(M):F.error(M.message)}),O=()=>{n(!1)},T=()=>{o(!1)},N=Gn(),C=c.useMemo(()=>{var M;return((M=N==null?void 0:N.data)==null?void 0:M[i.item.symbol])??"--"},[N]),{quote_dp:S,base_dp:I,base:P,quote:E}=qe();return c.useEffect(()=>{!_.current&&C&&r&&(_.current=!0,b(ie.LIMIT,`${C}`))},[_,C,r]),c.useEffect(()=>{r||(b(ie.MARKET),_.current=!1)},[r]),{...i,sheetOpen:r,setSheetOpen:n,curMarkPrice:C,quote_dp:S,base_dp:I,base:P,quote:E,baseTick:j,orderConfirm:L,onClose:O,onConfirm:q,price:l,quantity:u,closeOrderData:d,submitting:f,updatePriceChange:x,updateQuantity:m,errors:g,sliderValue:w,setSliderValue:v,dialogOpen:s,setDialogOpen:o,onCloseDialog:T}},Ra=e=>{let i=Fa(e);return t.jsx(za,{...i})},Ua=e=>t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",disabled:e.submitting,loading:e.submitting,onClick:i=>{if(i.stopPropagation(),i.preventDefault(),e.updateOrderType(ie.MARKET),!e.orderConfirm){e.onConfirm();return}e.setDialogOpen(!0)},children:"Market Close"}),t.jsx(gt,{open:e.dialogOpen,onOpenChange:e.setDialogOpen,size:"xs",children:t.jsx(hi,{base:e.base,quantity:e.quantity,onClose:e.onClose,onConfirm:e.onConfirm,submitting:e.submitting,hideCloseIcon:!0})})]}),Wa=e=>{let i=qe(),[r,n]=c.useState(!1),{onSubmit:s,price:o,quantity:a,closeOrderData:l,submitting:u,type:d,updatePriceChange:f,updateOrderType:h,updateQuantity:x}=Ae(),[b]=we("orderly_order_confirm",!0);return{...e,...i,dialogOpen:r,setDialogOpen:n,orderConfirm:b,onSubmit:s,quantity:a,onClose:()=>{n(!1)},onConfirm:()=>s().then(m=>{n(!1)},m=>{typeof m=="string"?F.error(m):F.error(m.message)}),submitting:u,updateOrderType:h,updateQuantity:x}},Ba=e=>{let i=Wa(e);return t.jsx(Ua,{...i})},Qa=e=>t.jsx(J,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:i=>{i.stopPropagation(),i.preventDefault(),e.openTP_SL()},children:"TP/SL"}),Va=e=>{let i=Ee()[e.state.item.symbol](),{tpslOrder:r}=Ae();return{openTP_SL:()=>{he.sheet({title:"TP/SL",content:t.jsx(Ur,{position:e.state.item,symbolInfo:i,order:r,isEditing:!1})})},...e,...i}},Ha=e=>{let i=Va(e);return t.jsx(Qa,{...i})},Ka=e=>{let{className:i,...r}=e;return t.jsxs(y,{direction:"column",width:"100%",gap:2,p:2,r:"xl",itemAlign:"start",className:z(i,"oui-bg-base-9"),children:[t.jsx(Ya,{...r}),t.jsx(ve,{intensity:6,className:"oui-w-full"}),t.jsx(Ga,{...r}),t.jsx($a,{...r}),t.jsx(Xa,{...r})]})},Ya=e=>t.jsxs(y,{justify:"between",width:"100%",children:[t.jsx(ka,{...e}),t.jsx(Da,{...e})]}),Ga=e=>t.jsxs(Se,{cols:3,rows:2,gap:2,width:"100%",children:[t.jsx(Ta,{...e}),t.jsx(Ia,{...e}),t.jsx(qa,{...e}),t.jsx(Ea,{...e}),t.jsx(Ma,{...e}),t.jsx(Aa,{...e})]}),Xa=e=>t.jsxs(Se,{width:"100%",gap:2,cols:3,rows:1,children:[t.jsx(Ha,{state:e}),t.jsx(Ra,{state:e}),t.jsx(Ba,{state:e})]}),Ja=e=>{let i=qe();return{...e,...i}},Za=e=>{let i=Ja(e);return t.jsx(Ka,{...i,className:e.className})},el=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r,pagination:n}=e,s=Oa({pnlNotionalDecimalPrecision:i,sharePnLConfig:r,onSymbolChange:e.onSymbolChange});return t.jsx(It,{loading:e.isLoading,id:"oui-desktop-positions-content",columns:s,bordered:!0,dataSource:e.dataSource,generatedRowKey:o=>o.symbol,renderRowContainer:(o,a,l)=>t.jsx(Mt,{symbol:o.symbol,children:t.jsx(Br,{position:o,children:l})}),manualPagination:!1,pagination:n,testIds:{body:"oui-testid-dataList-position-tab-body"}})},tl=e=>{let{pnlNotionalDecimalPrecision:i,sharePnLConfig:r}=e;return t.jsx(Dt,{className:"oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",contentClassName:"!oui-space-y-1",dataSource:e.dataSource,renderItem:(n,s)=>t.jsx(Mt,{symbol:n.symbol,children:t.jsx(Br,{position:n,children:t.jsx(Za,{item:n,index:s,pnlNotionalDecimalPrecision:i,sharePnLConfig:r,onSymbolChange:e.onSymbolChange})})})})},Gr=e=>{let{symbol:i,calcMode:r,includedPendingOrder:n,pnlNotionalDecimalPrecision:s,sharePnLConfig:o,onSymbolChange:a}=e,{pagination:l,setPage:u}=kt({pageSize:50}),[d,f,{isLoading:h}]=Xi(i,{calcMode:r,includedPendingOrder:n});return c.useEffect(()=>{u(1)},[i]),{dataSource:Tt(d==null?void 0:d.rows)??void 0,isLoading:h,pnlNotionalDecimalPrecision:s,sharePnLConfig:o,symbol:i,onSymbolChange:a,pagination:l}},sd=e=>{let i=Gr(e);return t.jsx(el,{...i})},od=e=>{let i=Gr(e);return t.jsx(tl,{...i})},il=e=>{let{onSymbolChange:i,pnlNotionalDecimalPrecision:r}=e;return c.useMemo(()=>[{title:"Symbol",dataIndex:"symbol",fixed:"left",width:200,onSort:(n,s)=>n.symbol.localeCompare(s.symbol),render:(n,s)=>t.jsx(rl,{record:s,onSymbolChange:i})},{title:"Closed / Max closed",dataIndex:"close_maxClose",width:200,render:(n,s)=>t.jsx(nl,{record:s})},{title:"Net PnL",dataIndex:"netPnL",width:140,onSort:(n,s)=>n.netPnL==null||s.netPnL==null?-1:(n.netPnL??0)-(s.netPnL??0),render:(n,s)=>t.jsx(sl,{record:s,pnlNotionalDecimalPrecision:r})},{title:"Avg. open",dataIndex:"avg_open",width:140,render:(n,s)=>{let o=s.avg_open_price!=null?Math.abs(s.avg_open_price):"--",{quote_dp:a}=qe();return t.jsx(p.numeral,{dp:a,padding:!1,children:o})}},{title:"Avg. close",dataIndex:"avg_close",width:175,render:(n,s)=>{let o=s.avg_close_price!=null?Math.abs(s.avg_close_price):"--",{quote_dp:a}=qe();return t.jsx(p.numeral,{dp:a,padding:!1,children:o})}},{title:"Time opened",dataIndex:"open_timestamp",width:175,onSort:!0,render:(n,s)=>t.jsx(p.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:s.open_timestamp})},{title:"Time closed",dataIndex:"close_timestamp",width:175,onSort:!0,render:(n,s)=>s.position_status=="closed"&&s.close_timestamp?t.jsx(p.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:s.close_timestamp??"--"}):"--"},{title:"Updated time",dataIndex:"last_update_time",width:175,onSort:!0,render:(n,s)=>t.jsx(p.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:s.last_update_time})}],[r])},rl=e=>{let{record:i,onSymbolChange:r}=e,n=c.useMemo(()=>{let s=[];return s.push(t.jsx(B,{color:i.position_status!=="closed"?"primaryLight":"neutral",size:"xs",children:Xe(i.position_status==="partial_closed"?"Partially closed":i.position_status.replace("_"," "))})),i.type==="adl"?s.push(t.jsx(B,{color:"danger",size:"xs",children:Xe(i.type)})):i.type==="liquidated"&&s.push(t.jsx(Ie,{className:"oui-min-w-[204px] oui-bg-base-5",arrow:{className:"oui-fill-base-5"},content:t.jsxs(y,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[i.liquidation_id!=null&&t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Liquidation id"}),t.jsx(p,{intensity:98,children:i.liquidation_id})]}),t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Liquidator fee"}),t.jsx(p,{color:i.liquidator_fee>=0?"profit":"lose",children:X(i.liquidator_fee)})]}),t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Ins. Fund fee"}),t.jsx(p,{color:i.insurance_fund_fee>=0?"profit":"lose",children:X(i.insurance_fund_fee)})]})]}),children:t.jsx("div",{children:t.jsx(B,{size:"xs",color:"danger",className:"oui-cursor-pointer",children:t.jsx("span",{className:"oui-underline oui-decoration-dashed oui-decoration-[1px]",children:Xe(i.type)})})})})),s},[i]);return t.jsxs(y,{gap:2,height:48,children:[t.jsx(G,{width:4,height:38,className:z("oui-rounded-[1px] oui-shrink-0",i.side==="LONG"?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsxs(y,{direction:"column",itemAlign:"start",children:[t.jsx(p.formatted,{formatString:"base-type",className:"oui-cursor-pointer",onClick:s=>{r==null||r({symbol:i.symbol}),s.stopPropagation(),s.preventDefault()},children:`${i.symbol.split("_")[1]}-PERP`}),t.jsx(y,{gap:1,children:n})]})]})},nl=e=>{let{record:i}=e,{base_dp:r}=qe();return t.jsxs(y,{gap:1,direction:"column",itemAlign:"start",className:"oui-overflow-hidden oui-whitespace-nowrap oui-text-ellipsis",children:[t.jsx(p.numeral,{dp:r,children:Math.abs(i.closed_position_qty)}),t.jsx(p.numeral,{dp:r,className:"oui-truncate",children:Math.abs(i.max_position_qty)})]})},sl=e=>{let{record:i,pnlNotionalDecimalPrecision:r}=e,n=i.netPnL!=null?i.netPnL:void 0,s=()=>t.jsx(p.numeral,{dp:r,color:i.netPnL!=null?i.netPnL>0?"profit":"lose":void 0,className:n==null?"":"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",children:n??"--"});return i.netPnL==null?s():t.jsx(y,{children:t.jsx(Ie,{delayDuration:200,content:t.jsxs(y,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[t.jsx(p,{intensity:80,children:"Net PnL"}),t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Realized PnL"}),t.jsx(p,{color:i.realized_pnl>=0?"profit":"lose",className:"oui-cursor-pointer",children:X(i.realized_pnl)})]}),t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Funding fee"}),t.jsx(p,{color:i.accumulated_funding_fee>0?"lose":"profit",className:"oui-cursor-pointer",children:X(-i.accumulated_funding_fee)})]}),t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Trading fee"}),t.jsx(p,{color:i.trading_fee>0?"lose":"profit",className:"oui-cursor-pointer",children:X(-i.trading_fee)})]})]}),className:"oui-min-w-[204px] oui-bg-base-5",arrow:{className:"oui-fill-base-5"},children:t.jsx("div",{children:s()})})})};function xe(e){if(e==null)return e;let i=new Date(e);return i.setHours(0,0,0,0),i}function ge(e){if(e==null)return e;let i=new Date(e);return i.setHours(23,59,59,999),i}var St=e=>({from:xe(e.from),to:ge(e.to??e.from)}),Pt=(e,i)=>e.getTime()===i.getTime(),Xr=e=>{let{onSymbolChange:i,symbol:r,pnlNotionalDecimalPrecision:n}=e,{state:s}=ht(),{data:o,isLoading:a}=Ji(r?`/v1/position_history?symbol=${r}&limit=1000`:"/v1/position_history?limit=1000",{formatter(_){var w;return(w=_.rows??null)==null?void 0:w.map(v=>{if(v.realized_pnl!=null&&v.accumulated_funding_fee!=null&&v.trading_fee!=null){let L=v.realized_pnl-v.accumulated_funding_fee-v.trading_fee;return{...v,netPnL:L}}return v})},revalidateOnFocus:!0}),{pagination:l,setPage:u}=kt({pageSize:10}),{status:d,side:f,dateRange:h,filterDays:x,updateFilterDays:b,filterItems:m,onFilter:g}=ol();c.useEffect(()=>{u(1)},[d,f,h,x,r]);let j=c.useMemo(()=>o==null?o:o.filter(_=>{let w=f==="all"?!0:_.side.toLowerCase()===f.toLowerCase(),v=d==="all"?!0:_.position_status.toLowerCase()===d.toLowerCase(),L=(_==null?void 0:_.last_update_time)??_.open_timestamp,q=h.from&&h.to?L>=h.from.getTime()&&L<=h.to.getTime():!0,O=r?_.symbol==r:!0;return w&&v&&q&&O}),[d,f,h,o,r]);return{dataSource:Tt(j,{accountStatus:s.status===Ge.EnableTradingWithoutConnected?Ge.EnableTradingWithoutConnected:Ge.EnableTrading}),isLoading:a,onSymbolChange:i,pagination:l,filterItems:m,onFilter:g,symbol:r,filterDays:x,updateFilterDays:b,pnlNotionalDecimalPrecision:n}},ol=()=>{let[e,i]=c.useState("all"),[r,n]=c.useState("all"),s=St({to:ge(new Date),from:xe(_e(new Date,89))}),[o,a]=c.useState(90),[l,u]=c.useState(s),d=x=>{a(x),u({from:xe(_e(new Date,x-1)),to:ge(new Date)})},f=x=>{if(x.name==="side"&&n(x.value),x.name==="status"&&i(x.value),x.name==="dateRange"){let b=St(x.value);if(u(b),b.from&&b.to){let m=Math.abs(yr(b.from,b.to))+1,g={1:{from:xe(new Date),to:ge(new Date)},7:{from:xe(_e(new Date,6)),to:ge(new Date)},30:{from:xe(_e(new Date,29)),to:ge(new Date)},90:{from:xe(_e(new Date,89)),to:ge(new Date)}}[m];g&&Pt(g.from,b.from)&&Pt(g.to,b.to)?a(m):a(null)}}},{isMobile:h}=dr();return{filterItems:c.useMemo(()=>{let x={type:"select",name:"side",options:[{label:"All sides",value:"all"},{label:"Buy",value:"LONG"},{label:"Sell",value:"SHORT"}],value:r},b={type:"range",name:"dateRange",value:l,fromDate:xe(_e(new Date,89)),toDate:ge(new Date)},m={type:"select",name:"status",options:[{label:"All status",value:"all"},{label:"Closed",value:"closed"},{label:"Partially Closed",value:"partial_closed"}],value:e};return h?[x,m]:[x,m,b]},[r,e,l]),onFilter:f,side:r,dateRange:l,status:e,filterDays:o,updateFilterDays:d}},al=e=>{let{side:i,symbol:r}=e.item,n=i==="LONG";return t.jsx(p.formatted,{intensity:80,rule:"symbol",formatString:"base-type",size:"sm",prefix:t.jsx(B,{color:n?"success":"danger",size:"xs",children:n?"Buy":"Sell"}),onClick:()=>{var s;(s=e.onSymbolChange)==null||s.call(e,{symbol:r})},children:r})},ll=e=>{let{item:i}=e,r=()=>{he.alert({title:"Liquidation",message:t.jsxs(y,{direction:"column",width:"100%",gap:2,className:"oui-text-2xs oui-text-base-contrast-54",children:[i.liquidation_id!=null&&t.jsxs(y,{justify:"between",width:"100%",children:[t.jsx(p,{children:"Liquidation id"}),t.jsx(p,{intensity:98,children:i.liquidation_id})]}),t.jsxs(y,{justify:"between",width:"100%",children:[t.jsx(p,{children:"Liquidator fee"}),t.jsx(p,{color:i.liquidator_fee>=0?"profit":"lose",children:X(i.liquidator_fee)})]}),t.jsxs(y,{justify:"between",width:"100%",children:[t.jsx(p,{children:"Ins. Fund fee"}),t.jsx(p,{color:i.insurance_fund_fee>=0?"profit":"lose",children:X(i.insurance_fund_fee)})]})]})})},n=c.useMemo(()=>{let s=[];return s.push(t.jsx(B,{color:i.position_status!=="closed"?"primaryLight":"neutral",size:"xs",children:Xe(i.position_status==="partial_closed"?"Partially closed":i.position_status.replace("_"," "))})),i.type==="adl"?s.push(t.jsx(B,{color:"danger",size:"xs",children:Xe(i.type)})):i.type==="liquidated"&&s.push(t.jsx(B,{size:"xs",color:"danger",className:"oui-cursor-pointer",onClick:r,children:t.jsx("span",{className:"oui-underline oui-decoration-dashed oui-decoration-[1px]",children:Xe(i.type)})})),s},[i]);return t.jsx(y,{gap:1,children:n})},ul=e=>{let{item:i}=e;return t.jsx(ee,{label:t.jsx(p,{children:"Closed"}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.base_dp,padding:!1,coloring:!0,intensity:80,children:i.closed_position_qty})})},dl=e=>{let{item:i}=e;return t.jsx(ee,{label:t.jsx(p,{children:"Max closed"}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.base_dp,padding:!1,coloring:!0,intensity:80,children:i.max_position_qty})})},cl=e=>{let{item:i}=e;return t.jsx(ee,{label:t.jsxs(p,{children:["Avg. open",t.jsx(p,{intensity:20,children:" (USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,padding:!1,coloring:!0,intensity:80,children:i.avg_open_price})})},pl=e=>{let{item:i}=e;return t.jsx(ee,{label:t.jsxs(p,{children:["Avg. close",t.jsx(p,{intensity:20,children:" (USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,padding:!1,coloring:!0,intensity:80,children:i.avg_close_price})})},ml=e=>{let{item:i}=e;return t.jsx(ee,{label:"Time opened",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:t.jsx(p.formatted,{intensity:80,formatString:"yyyy-MM-dd HH:mm:ss",rule:"date",children:i.open_timestamp})})},fl=e=>{let{item:i}=e,r=i.position_status=="closed"&&i.close_timestamp?t.jsx(p.formatted,{intensity:80,formatString:"yyyy-MM-dd HH:mm:ss",rule:"date",children:i.close_timestamp}):"--";return t.jsx(ee,{label:"Time closed",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:r})},hl=e=>{var i;return t.jsxs(y,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:(i=e.classNames)==null?void 0:i.root,children:[t.jsx(xl,{...e}),t.jsx(ve,{intensity:6,className:"oui-w-full"}),t.jsx(gl,{...e})]})},xl=e=>{let i=()=>{let{item:r}=e;he.alert({title:"Net PnL",message:t.jsxs(y,{direction:"column",width:"100%",gap:2,className:"oui-text-2xs oui-text-base-contrast-54",children:[t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Realized PnL"}),t.jsx(p,{color:r.realized_pnl>=0?"profit":"lose",children:X(r.realized_pnl)})]}),t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Funding fee"}),t.jsx(p,{color:r.accumulated_funding_fee>0?"lose":"profit",children:X(-r.accumulated_funding_fee)})]}),t.jsxs(y,{justify:"between",width:"100%",gap:2,children:[t.jsx(p,{intensity:54,children:"Trading fee"}),t.jsx(p,{color:r.trading_fee>0?"lose":"profit",children:X(-r.trading_fee)})]})]})})};return t.jsxs(y,{gap:1,width:"100%",children:[t.jsxs(y,{direction:"column",itemAlign:"start",className:"oui-flex-1",gap:1,children:[t.jsx(al,{...e}),t.jsx(ll,{...e})]}),t.jsxs(y,{direction:"column",itemAlign:"end",className:"oui-flex-1",children:[t.jsx(p,{size:"2xs",intensity:36,children:"Net PnL"}),t.jsx("button",{onClick:i,children:t.jsx(p.numeral,{size:"xs",coloring:!0,children:e.item.netPnL??"--"})})]})]})},gl=e=>t.jsxs(Se,{cols:3,rows:2,width:"100%",gap:0,className:"oui-grid-cols-[1fr,1fr,135px]",children:[t.jsx(ul,{...e}),t.jsx(dl,{...e}),t.jsx(ml,{...e}),t.jsx(cl,{...e}),t.jsx(pl,{...e}),t.jsx(fl,{...e})]}),yl=e=>{let i=qe();return{...e,...i}},bl=e=>{let i=yl(e);return t.jsx(hl,{...i})},jl=e=>{let{onSymbolChange:i,pagination:r,pnlNotionalDecimalPrecision:n}=e,s=il({onSymbolChange:i,pnlNotionalDecimalPrecision:n});return t.jsxs(y,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[t.jsxs(y,{gap:3,children:[e.filterItems.length>0&&t.jsx(xt,{items:e.filterItems,onFilter:o=>{e.onFilter(o)}}),[1,7,30,90].map(o=>t.jsxs("button",{className:"oui-relative oui-px-2 oui-py-[2px] oui-text-sm",children:[t.jsx("div",{className:"oui-z-10",children:t.jsx(p.gradient,{color:e.filterDays===o?"brand":void 0,className:e.filterDays!==o?"oui-text-base-contrast-54":"",children:`${o}D`})}),t.jsx("div",{className:"oui-gradient-primary oui-opacity-[.12] oui-absolute oui-left-0 oui-right-0 oui-top-0 oui-bottom-0 oui-rounded",onClick:()=>{e.updateFilterDays(o)}})]}))]}),t.jsx(It,{loading:e.isLoading,id:"oui-desktop-positions-content",columns:s,bordered:!0,dataSource:e.dataSource,generatedRowKey:o=>`${o.symbol}_${o.position_id}`,renderRowContainer:(o,a,l)=>t.jsx(Mt,{symbol:o.symbol,children:l}),manualPagination:!1,pagination:r,testIds:{body:"oui-testid-dataList-positionHistory-tab-body"},classNames:{root:"!oui-h-[calc(100%_-_49px)]"}})]})},_l=e=>{var i,r;return t.jsxs(Se,{cols:1,rows:2,className:"oui-grid-rows-[auto,1fr] oui-w-full",gap:1,children:[t.jsx(y,{gap:2,p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:t.jsx(xt,{className:"oui-pt-0 oui-pb-0 oui-border-none",items:e.filterItems,onFilter:n=>{e.onFilter(n)}})}),t.jsx(Dt,{className:z("oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",(i=e.classNames)==null?void 0:i.root),contentClassName:z("!oui-space-y-1",(r=e.classNames)==null?void 0:r.content),dataSource:e.dataSource,renderItem:(n,s)=>{var o;return t.jsx(Mt,{symbol:n.symbol,children:t.jsx(bl,{item:n,index:s,onSymbolChange:e.onSymbolChange,classNames:{root:(o=e.classNames)==null?void 0:o.cell}})})}})]})},ad=e=>{let i=Xr(e);return t.jsx(jl,{...i})},ld=e=>{let{classNames:i,...r}=e,n=Xr(r);return t.jsx(_l,{...n,classNames:i})},wl=e=>c.useMemo(()=>[{title:"Time",dataIndex:"timestamp",fixed:"left",width:202,render:i=>t.jsx(p.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:i})},{title:"Liquidation id",dataIndex:"liquidation_id",width:202,render:i=>t.jsx(p,{children:i})},{title:"Ins. fund transfer",dataIndex:"transfer_amount_to_insurance_fund",width:202,render:i=>t.jsx(p,{children:X(i)})},{title:"Symbol ",dataIndex:"Symbol",width:202,render:(i,r)=>{var n;return t.jsx(y,{direction:"column",itemAlign:"start",children:(n=r.positions_by_perp)==null?void 0:n.map(s=>t.jsx(p.formatted,{rule:"symbol",formatString:"base-quote",children:s.symbol}))})}},{title:"Price (USDC)",dataIndex:"Price_(USDC)",width:202,render:(i,r)=>{var n;return t.jsx(y,{direction:"column",itemAlign:"start",children:(n=r.positions_by_perp)==null?void 0:n.map(s=>t.jsx(Qt,{value:s.transfer_price,type:"quote"}))})}},{title:"Quantity",dataIndex:"Quantity",width:202,render:(i,r)=>{var n;return t.jsx(y,{direction:"column",itemAlign:"start",children:(n=r.positions_by_perp)==null?void 0:n.map(s=>t.jsx(Qt,{value:s.position_qty,type:"base"}))})}},{title:"Liquidation fee",dataIndex:"abs_liquidation_fee",width:202,render:(i,r)=>{var n;return t.jsx(y,{direction:"column",itemAlign:"start",children:(n=r.positions_by_perp)==null?void 0:n.map(s=>t.jsx(Qt,{value:s.abs_liquidation_fee,type:"quote"}))})}}],[]),Qt=e=>t.jsx(p,{children:X(e.value)}),vl=e=>t.jsxs(y,{width:"100%",justify:"between",children:[t.jsxs(p,{size:"2xs",intensity:36,children:["Price",t.jsx(p,{intensity:20,children:" (USDC)"})]}),t.jsx(p,{size:"2xs",intensity:80,children:X(e.transfer_price)})]}),Nl=e=>t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(p,{size:"2xs",intensity:36,children:"Quantity"}),t.jsx(p,{size:"2xs",intensity:80,children:X(e.position_qty)})]}),Cl=e=>t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(p,{size:"2xs",intensity:36,children:"Liquidation fee"}),t.jsx(p,{size:"2xs",intensity:80,children:X(e.abs_liquidation_fee)})]}),Sl=e=>{var i;return t.jsxs(y,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:(i=e.classNames)==null?void 0:i.root,children:[t.jsx(Pl,{...e}),t.jsx(Ll,{...e})]},e.item.timestamp)},Pl=e=>t.jsxs(y,{gap:1,width:"100%",children:[t.jsxs(y,{direction:"column",itemAlign:"start",className:"oui-flex-1",gap:1,children:[t.jsx(p.formatted,{size:"2xs",intensity:36,rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:e.item.timestamp}),t.jsxs(y,{gap:1,children:[t.jsx(p,{size:"2xs",intensity:36,children:"Liquidation id:"}),t.jsx(p,{size:"2xs",intensity:80,children:` ${e.item.liquidation_id}`})]})]}),t.jsxs(y,{direction:"column",itemAlign:"end",className:"oui-flex-1",children:[t.jsx(p,{size:"2xs",intensity:36,children:"Ins. Fund Transfer:"}),t.jsx(p,{intensity:80,size:"xs",children:X(e.item.transfer_amount_to_insurance_fund)})]})]}),Ll=e=>{var i;return t.jsx(y,{direction:"column",width:"100%",children:(i=e.item.positions_by_perp)==null?void 0:i.map((r,n)=>t.jsx(Ol,{isLast:n===e.item.positions_by_perp.length-1,...r},`${n}-${r.symbol}`))})},Ol=e=>t.jsxs(y,{width:"100%",itemAlign:"start",className:z("oui-border-t-[1px] oui-border-line-6 oui-pt-2",!e.isLast&&"oui-pb-2"),children:[t.jsx(p.formatted,{rule:"symbol",formatString:"base-quote",size:"xs",intensity:80,className:"oui-flex-1",children:e.symbol}),t.jsxs(Se,{cols:1,rows:3,width:"100%",gap:1,className:"oui-flex-1",children:[t.jsx(vl,{...e}),t.jsx(Nl,{...e}),t.jsx(Cl,{...e})]})]},e.key),kl=e=>({...e}),Dl=e=>{let{classNames:i,...r}=e,n=kl(r);return t.jsx(Sl,{classNames:i,...n})},Tl=e=>{let i=wl();return t.jsxs(y,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[t.jsxs(y,{gap:3,children:[e.filterItems.length>0&&t.jsx(xt,{items:e.filterItems,onFilter:r=>{e.onFilter(r)}}),[1,7,30,90].map(r=>t.jsxs("button",{className:"oui-relative oui-px-2 oui-py-[2px] oui-text-sm",children:[t.jsx("div",{className:"oui-z-10",children:t.jsx(p.gradient,{color:e.filterDays===r?"brand":void 0,className:e.filterDays!==r?"oui-text-base-contrast-54":"",children:`${r}D`})}),t.jsx("div",{className:"oui-gradient-primary oui-opacity-[.12] oui-absolute oui-left-0 oui-right-0 oui-top-0 oui-bottom-0 oui-rounded",onClick:()=>{e.updateFilterDays(r)}})]}))]}),t.jsx(It,{loading:e.isLoading,id:"oui-desktop-liquidation-content",columns:i,bordered:!0,dataSource:e.dataSource,generatedRowKey:r=>`${r.liquidation_id}`,pagination:e.pagination,testIds:{body:"oui-testid-dataList-liquidation-tab-body"},classNames:{root:"!oui-h-[calc(100%_-_49px)]"}})]})},Il=e=>{var i,r;return t.jsxs(Se,{cols:1,rows:2,className:"oui-grid-rows-[auto,1fr] oui-w-full",gap:1,children:[t.jsx(y,{gap:2,p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:t.jsx(xt,{className:"oui-pt-0 oui-pb-0 oui-border-none",items:e.filterItems,onFilter:n=>{e.onFilter(n)}})}),t.jsx(Dt,{className:z("oui-w-full oui-hide-scrollbar oui-overflow-y-hidden oui-space-y-0",(i=e.classNames)==null?void 0:i.root),contentClassName:z("!oui-space-y-1",(r=e.classNames)==null?void 0:r.content),dataSource:e.dataSource,loadMore:e.loadMore,renderItem:(n,s)=>{var o;return t.jsx(Dl,{item:n,index:s,classNames:{root:(o=e.classNames)==null?void 0:o.cell}})}})]})},Jr=e=>{let{symbol:i,enableLoadMore:r}=e,{page:n,pageSize:s,setPage:o,parsePagination:a}=kt({pageSize:10}),{dateRange:l,filterDays:u,updateFilterDays:d,filterItems:f,onFilter:h}=El();c.useEffect(()=>{o(1)},[i,l,u]);let[x,{meta:b,isLoading:m,loadMore:g}]=ql({page:r?void 0:n,size:s,symbol:i,start_t:l.from!=null?l.from.getTime():void 0,end_t:l.to!=null?l.to.getTime():void 0});return{dataSource:Tt(x),isLoading:m,loadMore:g,pagination:a(b),dateRange:l,filterDays:u,updateFilterDays:d,filterItems:f,onFilter:h}},ql=e=>{var o;let i=Bn(Ml(e),{initialSize:1,formatter:a=>a,revalidateOnFocus:!0}),r=c.useMemo(()=>{var a,l;return(l=(a=i.data)==null?void 0:a[0])==null?void 0:l.meta},[(o=i.data)==null?void 0:o[0]]),n=c.useMemo(()=>{var a,l;return(l=(a=i.data)==null?void 0:a.map(u=>u.rows))==null?void 0:l.flat()},[i.data]),s=i.isLoading;return[n,{meta:r,isLoading:s,loadMore:()=>{i.setSize(i.size+1)}}]},El=()=>{let e=St({to:ge(new Date),from:xe(_e(new Date,89))}),[i,r]=c.useState(90),[n,s]=c.useState(e),o=u=>{r(u),s({from:xe(_e(new Date,u-1)),to:ge(new Date)})},a=u=>{if(u.name==="dateRange"){let d=St(u.value);if(s(d),d.from&&d.to){let f=Math.abs(yr(d.from,d.to))+1,h={1:{from:xe(new Date),to:ge(new Date)},7:{from:xe(_e(new Date,6)),to:ge(new Date)},30:{from:xe(_e(new Date,29)),to:ge(new Date)},90:{from:xe(_e(new Date,89)),to:ge(new Date)}}[f];h&&Pt(h.from,d.from)&&Pt(h.to,d.to)?r(f):r(null)}}},{isMobile:l}=dr();return{filterItems:c.useMemo(()=>{let u={type:"range",name:"dateRange",value:n,fromDate:xe(_e(new Date,89)),toDate:ge(new Date)};return l?[u]:[u]},[n]),onFilter:a,dateRange:n,filterDays:i,updateFilterDays:o}},Ml=e=>(i,r)=>{var d;if(r&&!((d=r.rows)!=null&&d.length))return null;let{symbol:n,size:s=10,page:o,end_t:a,start_t:l}=e,u=new URLSearchParams([["size",s.toString()],["page",`${i+1}`]]);return o&&u.set("page",`${o}`),n&&u.set("symbol",n),a&&u.set("end_t",`${a}`),l&&u.set("start_t",`${l}`),`/v1/liquidations?${u.toString()}`},ud=e=>{let i=Jr(e);return t.jsx(Tl,{...i})},dd=e=>{let{classNames:i,...r}=e,n=Jr(r);return t.jsx(Il,{classNames:i,...n})},Al="MarketCloseConfirmID";Lt(Al,hi,{size:"md",closable:!1});var $l=e=>{let{current:i,pnlNotionalDecimalPrecision:r,sharePnLConfig:n}=e,s=c.useRef(null);return c.useImperativeHandle(e.ref,()=>({download:()=>{var o,a;(a=(o=s.current)==null?void 0:o.download)==null||a.call(o)}})),{current:i,pnlNotionalDecimalPrecision:r,orderListRef:s,sharePnLConfig:n}},Oe=e=>e===void 0||e.length===0?e:e.length===1?e.charAt(0).toUpperCase():e.charAt(0).toUpperCase()+e.toLowerCase().slice(1);function ft(e){var i,r;if(typeof e.type<"u"){let n=new Array;if(e.parent_algo_type){if(e.algo_type===fe.STOP_LOSS){let o=e.type===ie.CLOSE_POSITION?["Position","SL"]:["SL"];n.push(...o)}if(e.algo_type===fe.TAKE_PROFIT){let o=e.type===ie.CLOSE_POSITION?["Position","TP"]:["TP"];n.push(...o)}return n}(typeof e.type=="string"?[e.type.replace("_ORDER","").toLowerCase()]:[e.type]).map(o=>Oe(o));let s=typeof e.type=="string"?e.type.replace("_ORDER","").toLowerCase():Oe(e.type);return[ie.ASK,ie.BID].includes(e.type)?[Oe(ie.LIMIT)]:e.algo_order_id===void 0||e.algo_order_id&&e.algo_type==="BRACKET"?[Oe(s)]:[`Stop ${s}`]}if(typeof e.algo_type<"u"){let n=new Array;e.algo_type===W.POSITIONAL_TP_SL&&n.push("Position");let s=(i=e==null?void 0:e.child_orders)==null?void 0:i.find(a=>a.algo_type===fe.TAKE_PROFIT&&!!a.trigger_price),o=(r=e==null?void 0:e.child_orders)==null?void 0:r.find(a=>a.algo_type===fe.STOP_LOSS&&!!a.trigger_price);return(s||o)&&n.push(s&&o?"TP/SL":s?"TP":"SL"),n}}function bt(e){return e.status===Z.CANCELLED||e.algo_status===Z.CANCELLED}function zl(e){var s,o,a;if(e.algo_type!==W.BRACKET)return{tpOrder:void 0,slOrder:void 0};let i=(s=e.child_orders)==null?void 0:s[0];if(!i)return{tpOrder:void 0,slOrder:void 0};let r=(o=i==null?void 0:i.child_orders)==null?void 0:o.find(l=>l.algo_type===fe.TAKE_PROFIT),n=(a=i==null?void 0:i.child_orders)==null?void 0:a.find(l=>l.algo_type===fe.STOP_LOSS);return{tpOrder:r,slOrder:n}}function Zr(e){let i={pnl:{tpPnL:void 0,slPnL:void 0},roi:{tpRoi:void 0,slRoi:void 0}},{tpOrder:r,slOrder:n}=zl(e);if(!r&&!n||typeof e.price===void 0||!e.price)return i;let s=e.side===je.BUY?e.quantity:e.quantity*-1,o=(r==null?void 0:r.trigger_price)&&ue.priceToPnl({qty:s,price:r==null?void 0:r.trigger_price,entryPrice:e.price,orderSide:e.side,orderType:r.algo_type}),a=(n==null?void 0:n.trigger_price)&&ue.priceToPnl({qty:s,price:n==null?void 0:n.trigger_price,entryPrice:e.price,orderSide:e.side,orderType:n.algo_type}),l=o?ue.calcTPSL_ROI({pnl:o,qty:e.quantity,price:e.price}):void 0,u=a?ue.calcTPSL_ROI({pnl:a,qty:e.quantity,price:e.price}):void 0;return{pnl:{tpPnL:o,slPnL:a},roi:{tpRoi:l,slRoi:u}}}var en=c.createContext({}),ze=()=>c.useContext(en),tn=e=>{let i=Ee()[e.symbol];return t.jsx(en.Provider,{value:{base_dp:i("base_dp"),quote_dp:i("quote_dp"),base_tick:i("base_tick"),quote_tick:i("quote_tick"),base:i("base"),quote:i("quote"),symbol:e.symbol,origin:i(),quote_max:i("quote_max"),quote_min:i("quote_min")},children:e.children})},rn=c.createContext({}),rt=()=>c.useContext(rn),nn=e=>{let{cancelOrder:i,editOrder:r,cancelAlgoOrder:n,editAlgoOrder:s}=e,o=Ee(),a=c.useCallback(async d=>d.algo_order_id!==void 0?"root_algo_order_id"in d&&d.root_algo_order_id!==d.algo_order_id?n(d.root_algo_order_id,d.symbol):n(d.algo_order_id,d.symbol).then(()=>{}):i(d.order_id,d.symbol).then(()=>{}),[]),l=c.useCallback(async(d,f)=>{d.visible_quantity!==void 0?d.visible_quantity:d.visible!==void 0&&d.visible,await he.sheet({title:"Edit Order",classNames:{content:"oui-edit-order-sheet-content"},content:t.jsx(t.Fragment,{children:"Content"})})},[]),u=c.useCallback((d,f,h)=>{let{min_notional:x}=o[d]();return ts(f)},[o]);return t.jsx(rn.Provider,{value:{onCancelOrder:a,onEditOrder:l,editOrder:r,editAlgoOrder:s,checkMinNotional:u},children:e.children})},sn=c.createContext({}),We=()=>c.useContext(sn),on=e=>{let{quote_dp:i}=ze(),[r,n]=c.useState(),[s]=Yt("/v1/algo/order","DELETE"),[o]=Yt("/v1/algo/order","PUT"),a=is(),{state:l}=ht(),u=c.useMemo(()=>rs(()=>["/v1/positions",l.accountId]),[l.accountId]),d=async j=>s(null,{order_id:j.algo_order_id,symbol:j.symbol}),f=async(j,_)=>o({order_id:j.algo_order_id,child_orders:j.child_orders.map(w=>({order_id:w.algo_order_id,quantity:_.order_quantity}))}),h=j=>{var _;return(_=a.cache.get(u))==null?void 0:_.data.rows.find(w=>w.symbol===j)},{sl_trigger_price:x,tp_trigger_price:b,tpPnL:m,slPnL:g}=Fl({order:e.order,position:r,quote_dp:i});return c.useEffect(()=>{var j;if("algo_type"in e.order||(((j=e.order)==null?void 0:j.reduce_only)??!1)){let _=h(e.order.symbol);_&&n(_)}},[e.order.symbol]),t.jsx(sn.Provider,{value:{order:e.order,sl_trigger_price:x,tp_trigger_price:b,tpPnL:m,slPnL:g,onCancelOrder:d,onUpdateOrder:f,getRelatedPosition:h,position:r},children:e.children})};function Fl(e){var f;let{order:i,position:r,quote_dp:n}=e;if(!r)return{sl_trigger_price:void 0,tp_trigger_price:void 0,slPnL:void 0,tpPnL:void 0};let{sl_trigger_price:s,tp_trigger_price:o}=!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:ue.findTPSLFromOrder(i),a=i.quantity;a===0&&((f=i.child_orders)==null?void 0:f[0].type)==="CLOSE_POSITION"&&(a=r.position_qty);let l=r.average_open_price,u=typeof a=="number"&&typeof o=="number"&&typeof l=="number"?ue.priceToPnl({qty:a,price:o,entryPrice:r.average_open_price,orderSide:i.side,orderType:fe.TAKE_PROFIT},{symbol:{quote_dp:n}}):void 0,d=typeof a=="number"&&typeof s=="number"&&typeof l=="number"?ue.priceToPnl({qty:a,price:s,entryPrice:r.average_open_price,orderSide:i.side,orderType:fe.STOP_LOSS},{symbol:{quote_dp:n}}):void 0;return{sl_trigger_price:s,tp_trigger_price:o,slPnL:d,tpPnL:u}}var xi=e=>{let{type:i,base:r,value:n,cancelPopover:s,isSubmitting:o,onConfirm:a}=e,l=c.useMemo(()=>{switch(i){case 0:return`You agree changing the quantity of ${r}-PERP order to `;case 1:return`You agree changing the price of ${r}-PERP order to `;case 2:return`You agree changing the trigger price of ${r}-PERP order to `}},[i]);return t.jsxs("div",{className:"oui-pt-5 oui-relative",children:[t.jsxs("div",{className:"oui-text-base-contrast-54 oui-text-2xs desktop:oui-text-sm",children:[l,t.jsx("span",{className:"oui-text-warning-darken",children:mr(n)}),"."]}),t.jsxs("div",{className:"oui-grid oui-grid-cols-2 oui-gap-2 oui-mt-5",children:[t.jsx(J,{color:"secondary",size:"md",onClick:s,disabled:o,children:"Cancel"}),t.jsx(et,{size:"md",loading:o,onClick:a,children:"Confirm"})]}),t.jsx("button",{className:"oui-absolute oui-right-0 oui-top-0 oui-text-base-contrast-54",onClick:s,children:t.jsx(fr,{size:16,color:"white",opacity:1})})]})},gi=e=>{let{inputRef:i,dp:r,value:n,setValue:s,setEditing:o,error:a,handleKeyDown:l,onClick:u,onClose:d,onFocus:f,onBlur:h,hintInfo:x}=e;c.useEffect(()=>{let m=i.current;if(m){let g=m.value.length;m.setSelectionRange(g,g)}o(!0)},[]);let b=((x==null?void 0:x.length)||0)>0;return t.jsx(Ie,{content:x,open:b,children:t.jsx(be,{ref:i,type:"text",size:"sm",formatters:[Q.numberFormatter,Q.dpFormatter(r),Q.currencyFormatter],value:n,onValueChange:m=>s(m),helpText:a,onClick:m=>{m.stopPropagation(),m.preventDefault()},autoComplete:"off",onFocus:f,onBlur:h,onKeyDown:l,autoFocus:!0,color:b?"danger":void 0,classNames:{root:"oui-bg-base-700 oui-px-2 oui-py-1 oui-rounded",input:"oui-pr-2"},suffix:t.jsx("button",{onClick:u,children:t.jsx(ss,{size:18,color:"white",opacity:1,className:"oui-cursor-pointer oui-opacity-50 hover:oui-opacity-100"})})})})},an=e=>{let{order:i,otherOrderQuantity:r}=e,{reduce_only:n}=i,[s,o]=c.useState(i.quantity.toString()),[a,l]=c.useState(!1);c.useEffect(()=>{L(i.quantity.toString())},[e.order.quantity]);let[u,d]=c.useState(!1),[f,h]=c.useState(),{editOrder:x,editAlgoOrder:b,checkMinNotional:m}=rt(),{onUpdateOrder:g,position:j}=We(),{base_dp:_,base:w,base_tick:v}=ze(),L=async(k,U)=>{o(k);let te=Math.abs((j==null?void 0:j.position_qty)||0);if(j&&n&&Number(k)>te)h(`Quantity should be less than position quantity : ${te}`);else{let V=Number(k);U&&V>U?h(`Quantity should be less than ${X(U,{fix:_})}`):h(void 0)}return Promise.resolve()},q=()=>{d(!1),l(!1)},O=()=>{d(!1),L(i.quantity.toString()),l(!1)},[T,N]=c.useState(!1),C=c.useRef(null),S=()=>{if(f)return;if(Number(s)===Number(i.quantity)){l(!1);return}let k=i.algo_order_id!==void 0?i.trigger_price:i.price;if(k!==null&&i.reduce_only!==!0){let U=m(i.symbol,k,s);if(U){F.error(U),N(!1),O();return}}d(!0)},I=k=>{k==null||k.stopPropagation(),k==null||k.preventDefault(),S()},P=k=>{k.key==="Enter"&&(k==null||k.stopPropagation(),k==null||k.preventDefault(),S())},E=c.useCallback(()=>{N(!0);let k={symbol:i.symbol,order_type:i.type,side:i.side,order_price:i.price,order_quantity:s,algo_order_id:i.algo_order_id};if(typeof k.algo_order_id<"u"&&k.order_type==="MARKET"){let{order_price:te,...V}=k;k=V}typeof i.reduce_only<"u"&&(k.reduce_only=i.reduce_only),i.order_tag!==void 0&&(k={...k,order_tag:i.order_tag}),(i==null?void 0:i.visible_quantity)===0&&(k.visible_quantity=0),(i==null?void 0:i.tag)!==void 0&&(k.order_tag=i.tag);let U;"algo_type"in i&&i.algo_type===W.TP_SL?U=g(i,k):i.algo_order_id!==void 0?U=b(i.algo_order_id.toString(),k):U=x(i.order_id.toString(),k),U.then(te=>{q(),L(s.toString())},te=>{F.error(te.message),L(i.quantity.toString()),O()}).finally(()=>N(!1))},[s]),M=c.useRef(null),R=c.useRef(null),se=k=>{M.current&&R.current&&!M.current.contains(k.target)&&!R.current.contains(k.target)&&!u&&O()};c.useEffect(()=>(document.addEventListener("mousedown",se),()=>{document.removeEventListener("mousedown",se)}),[u,i.quantity]);let re=()=>!a||e.disableEdit?t.jsx(Rl,{order:i,quantity:s,setEditing:l,disableEdit:e.disableEdit}):t.jsx(Ul,{inputRef:C,quantitySliderRef:R,base_dp:_,base_tick:v,quantity:s,setQuantity:L,editing:a,setEditing:l,handleKeyDown:P,onClick:I,onClose:O,symbol:i.symbol,reduce_only:n,positionQty:j==null?void 0:j.position_qty,error:f,confirmOpen:u,side:i.side,order:i,setError:h});return t.jsx(ni,{open:u,onOpenChange:d,content:t.jsx(xi,{type:0,base:w,value:s,cancelPopover:O,isSubmitting:T,onConfirm:E}),contentProps:{onOpenAutoFocus:k=>{}},children:t.jsx("div",{onClick:k=>{k.stopPropagation(),k.preventDefault()},ref:M,children:re()})})},Rl=e=>{let{order:i,quantity:r}=e,n=i.total_executed_quantity;return t.jsxs(y,{direction:"row",justify:"start",gap:1,className:z("oui-max-w-[110px] oui-relative",i.side===je.BUY&&"oui-text-trade-profit",i.side===je.SELL&&"oui-text-trade-loss",bt(i)&&"oui-text-base-contrast-20"),onClick:s=>{s.stopPropagation(),s.preventDefault(),e.setEditing(!0)},children:["algo_type"in i&&i.algo_type===W.TP_SL?null:t.jsxs(t.Fragment,{children:[t.jsx("span",{children:n}),t.jsx("span",{children:"/"})]}),t.jsx(y,{r:"base",className:z("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2 oui-border oui-border-line-12"),children:t.jsx(p,{size:"2xs",children:r})})]})},Ul=e=>{let{inputRef:i,quantitySliderRef:r,base_dp:n,base_tick:s,quantity:o,setQuantity:a,editing:l,setEditing:u,handleKeyDown:d,onClick:f,onClose:h,error:x,symbol:b,reduce_only:m,positionQty:g,confirmOpen:j,side:_,order:w}=e,v=xr(b,w.side,w.reduce_only),L=c.useMemo(()=>m?Math.abs(g??0):w.quantity+Math.abs(v),[w.quantity,v,m,g]),[q,O]=c.useState(void 0);c.useEffect(()=>{if(q===void 0){let N=new D(o).div(L).abs().mul(100).toNumber();O(N)}},[q,L,o]);let T=async N=>(s>0&&(N=ue.formatNumber(N,s)??N),a(`${N}`,L));return t.jsxs(ei,{open:!j,children:[t.jsx(ti,{children:t.jsx(gi,{inputRef:i,dp:n,value:o,setValue:N=>{let C=Math.abs(Math.min(Number(N),L)).toString();if(a(N,L),N.endsWith("."))return;if(Number(C)===0){O(0);return}let S=new D(N).div(L).mul(100).toDecimalPlaces(2,D.ROUND_DOWN).toNumber();O(Math.min(100,S))},setEditing:u,handleKeyDown:d,onClick:f,onClose:h,onBlur:N=>{T(N.target.value)},hintInfo:x})}),t.jsx(ii,{className:"oui-w-[360px] oui-rounded-xl",align:"start",side:"bottom",onOpenAutoFocus:N=>{N.preventDefault()},children:t.jsxs(y,{p:1,gap:2,width:"100%",itemAlign:"start",ref:r,children:[t.jsx(p.numeral,{size:"xs",intensity:98,className:"oui-min-w-[30px] ",dp:2,padding:!1,unit:"%",rm:D.ROUND_DOWN,children:`${q}`}),t.jsxs(y,{direction:"column",width:"100%",gap:2,className:"oui-mt-[6px]",children:[t.jsx(Ze,{markCount:4,value:[q??0],onValueChange:N=>{let C=Array.from(N.values());O(C[0]);let S=new D(C[0]).div(100).mul(L).abs().toFixed(n,D.ROUND_DOWN);a(S,L)},onValueCommit:N=>{let C=new D(N[0]).div(100).mul(L).abs().toFixed(n,D.ROUND_DOWN);T(C).finally(()=>{i.current.focus()})}}),t.jsx(Wl,{onClick:N=>{O(N*100);let C=new D(N).mul(L).abs().toFixed(n,D.ROUND_DOWN);C=ue.formatNumber(C,s)??C,a(C,L),setTimeout(()=>{i.current.focus(),i.current.setSelectionRange(C.length,C.length)},100)}})]})]})})]})},Wl=e=>t.jsx(y,{gap:2,width:"100%",children:[{label:"0%",value:0},{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:"Max",value:1}].map((i,r)=>t.jsx(J,{variant:"outlined",color:"secondary",size:"xs",onClick:n=>{n.stopPropagation(),n.preventDefault(),e.onClick(i.value)},className:"oui-w-1/5",children:i.label},r))}),Bl=e=>{let{order:i}=e,[r,n]=c.useState(()=>{var P;return i.type===ie.MARKET&&!i.price?"Market":((P=i.price)==null?void 0:P.toString())??"Market"}),[s,o]=c.useState(!1),[a,l]=c.useState(!1),u=(i==null?void 0:i.algo_order_id)!==void 0,d=(i==null?void 0:i.type)==="MARKET"&&u,[f,h]=c.useState(!1),{editOrder:x,editAlgoOrder:b,checkMinNotional:m}=rt(),{base:g,quote_dp:j}=ze(),_=ns(i.symbol,i.side,u?i.trigger_price:void 0),w=()=>{o(!1),l(!1)},v=()=>{var P;o(!1),n(((P=i.price)==null?void 0:P.toString())??"Market"),l(!1)},L=c.useMemo(()=>!_||d||!a?"":Number(r)>_.max?`Price can not be greater than ${_.max} USDC.`:Number(r)<_.min?`Price can not be less than ${_.min} USDC.`:"",[d,a,_,r]),q=P=>{if(P==null||P.stopPropagation(),P==null||P.preventDefault(),!(L.length>0)){if(r===`${i.price}`){l(!1);return}if(i.reduce_only!==!0){let E=m(i.symbol,r,i.quantity);if(E){F.error(E),h(!1),v();return}}o(!0)}},O=P=>{P.key==="Enter"&&q(P)},T=()=>{h(!0);let P=i.order_id,E={order_price:r,order_quantity:i.quantity,symbol:i.symbol,order_type:i.type,side:i.side};typeof i.reduce_only<"u"&&(E.reduce_only=i.reduce_only),i.order_tag!==void 0&&(E={...E,order_tag:i.order_tag}),u&&(P=i.algo_order_id,E={...E,order_id:P,price:r,algo_order_id:P}),(i==null?void 0:i.visible_quantity)===0&&(E.visible_quantity=0),i.tag!==void 0&&(E.order_tag=i.tag);let M;i.algo_order_id!==void 0?M=b(i.algo_order_id.toString(),E):M=x(i.order_id.toString(),E),M.then(R=>{w(),n(r)},R=>{F.error(R.message),v()}).finally(()=>h(!1))},N=c.useRef(null);c.useEffect(()=>{e.order.price&&n(`${e.order.price}`)},[e.order.price]);let C=c.useRef(null),S=P=>{C.current&&!C.current.contains(P.target)&&!s&&v()};if(c.useEffect(()=>(document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}),[s,i.price]),i.algo_order_id&&i.type=="MARKET"||r==="Market")return t.jsx("span",{children:"Market"});let I=()=>!a||e.disableEdit?t.jsx(Ql,{order:i,price:r,setEditing:l,disableEdit:e.disableEdit}):t.jsx(gi,{inputRef:N,dp:j,value:r,setValue:n,setEditing:l,handleKeyDown:O,onClick:q,onClose:v,hintInfo:L});return t.jsx(ni,{open:s,onOpenChange:o,content:t.jsx(xi,{type:1,base:g,value:r,cancelPopover:v,isSubmitting:f,onConfirm:T}),children:t.jsx("div",{onClick:P=>{P.stopPropagation(),P.preventDefault()},ref:C,children:I()})})},Ql=e=>{let{order:i,price:r}=e;return t.jsx("div",{className:z("oui-flex oui-max-w-[110px] oui-justify-start oui-items-center oui-gap-1 oui-relative oui-font-semibold",bt(i)&&"oui-text-base-contrast-20"),onClick:n=>{n.stopPropagation(),n.preventDefault(),e.setEditing(!0)},children:t.jsx(y,{r:"base",className:z("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2  oui-border oui-border-line-12"),children:t.jsx(p,{size:"2xs",children:X(r)})})})},Vl=e=>{let{order:i}=e,[r,n]=c.useState("");c.useEffect(()=>{var P;n(((P=i.trigger_price)==null?void 0:P.toString())??"0")},[i.trigger_price]);let s=(i==null?void 0:i.algo_order_id)!==void 0,o=(i==null?void 0:i.algo_type)==="BRACKET",[a,l]=c.useState(!1),[u,d]=c.useState(!1),[f,h]=c.useState(!1),{editAlgoOrder:x,checkMinNotional:b}=rt(),{base:m,quote_dp:g,quote_max:j,quote_min:_}=ze(),w=c.useMemo(()=>{if(!((!s||o)&&!u)){if(Number(r)>j)return`Trigger price must be less than ${j}`;if(Number(r)<_)return`Trigger price must be greater than ${_}`}},[u,r,s,o]),v=()=>{l(!1),d(!1)},L=()=>{var P;n(((P=i.trigger_price)==null?void 0:P.toString())??"0"),l(!1),d(!1)},q=c.useRef(null),O=P=>{q.current&&!q.current.contains(P.target)&&!a&&L()};c.useEffect(()=>(document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O)}),[a,i.trigger_price]);let T=P=>{if(P==null||P.stopPropagation(),P==null||P.preventDefault(),d(!1),Number(r)!==Number(i.trigger_price)){if(i.price&&i.reduce_only!==!0){let E=b(i.symbol,i.price,i.quantity);if(E){F.error(E),h(!1),L();return}}l(!0)}},N=P=>{P.key==="Enter"&&T(P)},C=()=>{if((w??"").length>0)return;h(!0);let P={quantity:i.quantity,trigger_price:r,symbol:i.symbol,algo_order_id:i.algo_order_id};i.order_tag!==void 0&&(P={...P,order_tag:i.order_tag}),x(`${i.algo_order_id}`,P).then(E=>{v(),n(r)},E=>{var M;F.error(E.message),n(((M=i.trigger_price)==null?void 0:M.toString())??"--"),L()}).finally(()=>h(!1))},S=c.useRef(null);if(!s||o)return t.jsx(p,{children:"--"});let I=()=>!u||e.disableEdit?t.jsx(Hl,{order:i,price:r,setEditing:d,disableEdit:e.disableEdit}):t.jsx(gi,{inputRef:S,dp:g,value:r,setValue:n,setEditing:d,handleKeyDown:N,onClick:T,onClose:L,hintInfo:w});return t.jsx(ni,{open:a,onOpenChange:l,content:t.jsx(xi,{type:2,base:m,value:r,cancelPopover:L,isSubmitting:f,onConfirm:C}),children:t.jsx("div",{onClick:P=>{P.stopPropagation(),P.preventDefault()},ref:q,children:I()})})},Hl=e=>{let{order:i,price:r}=e;return t.jsx("div",{className:z("oui-flex oui-max-w-[110px] oui-justify-start oui-items-center oui-gap-1 oui-relative oui-font-semibold",bt(i)&&"oui-text-base-contrast-20"),onClick:n=>{n.stopPropagation(),n.preventDefault(),e.setEditing(!0)},children:t.jsx(y,{r:"base",className:z("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2 oui-border oui-border-line-12"),children:t.jsx(p,{size:"2xs",children:r})})})},yi=e=>{let{order:i}=e,{onCancelOrder:r}=rt(),[n,s]=c.useState(!1);return t.jsx(et,{size:"sm",variant:"outlined",color:"secondary",onClick:o=>{r&&(o.preventDefault(),o.stopPropagation(),s(!0),r(i).then(a=>a,a=>{F.error(a.message)}).finally(()=>{s(!1)}))},loading:n,children:"Cancel"})},Kl=e=>{let{record:i}=e,[r,n]=c.useState(!1),[s,{data:o,error:a,reset:l,isMutating:u}]=Yt("/v1/order"),d=Je("brokerId"),f=c.useCallback(()=>{n(!1);let h={symbol:i.symbol,order_type:i.type,order_price:i.price,order_quantity:i.quantity,order_amount:i.amount,side:i.side,broker_id:d};Number(i.visible_quantity)<Number(i.quantity)&&(h.visible_quantity=0),typeof i.reduce_only<"u"&&(h.reduce_only=i.reduce_only),s(h)},[]);return t.jsx(J,{size:"sm",variant:"outlined",color:"secondary",loading:u,disabled:u,onClick:h=>{u||(h.preventDefault(),h.stopPropagation(),f())},children:"Renew"})},Yl=()=>{let{sl_trigger_price:e,tp_trigger_price:i,order:r,position:n}=We();return t.jsx(Gl,{stopLossPrice:e,takeProfitPrice:i,direction:"column",order:r,position:n,tooltip:!0})},Gl=e=>{let{direction:i="row",order:r,position:n}=e,s=Ee(),o=c.useMemo(()=>{var f;let u=[];if(!e.tooltip||!r||!n)return;let d=r.quantity;return d===0&&((f=r.child_orders)==null?void 0:f[0].type)==="CLOSE_POSITION"&&(d=n.position_qty),e.takeProfitPrice&&u.push(t.jsx(Fi,{qty:d,price:e.takeProfitPrice,entryPrice:n.average_open_price,orderSide:r.side,orderType:fe.TAKE_PROFIT,symbolInfo:s[r.symbol]()},"tp")),e.stopLossPrice&&u.push(t.jsx(Fi,{qty:d,price:e.stopLossPrice,entryPrice:n.average_open_price,orderSide:r.side,orderType:fe.STOP_LOSS,symbolInfo:s[r.symbol]()},"sl")),t.jsx("div",{children:u})},[e.takeProfitPrice,e.stopLossPrice,n==null?void 0:n.average_open_price,r==null?void 0:r.side,r==null?void 0:r.quantity,r==null?void 0:r.algo_type]),a=c.useMemo(()=>{let u=[];return r!=null&&r.symbol?(e.takeProfitPrice&&u.push(t.jsx(p.numeral,{className:z("oui-text-trade-profit oui-gap-0  oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12"),rule:"price",dp:s[r.symbol]("quote_dp",2),children:e.takeProfitPrice,prefix:!e.stopLossPrice||i==="column"?t.jsx("span",{className:"oui-text-base-contrast-54",children:"TP - "}):""},"tp")),e.stopLossPrice&&u.push(t.jsx(p.numeral,{className:z("oui-text-trade-loss oui-gap-0 oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12"),rule:"price",dp:s[r.symbol]("quote_dp",2),children:e.stopLossPrice,prefix:!e.takeProfitPrice||i==="column"?t.jsx("span",{className:"oui-text-base-contrast-54",children:"SL - "}):""},"sl")),u.length===0?t.jsx("span",{children:"-"}):(u.length===2&&i==="row"&&u.splice(1,0,t.jsx("span",{children:"/"},"split")),u)):t.jsx("span",{children:"-"})},[e.takeProfitPrice,e.stopLossPrice,r==null?void 0:r.symbol]),l=t.jsx("div",{className:z("oui-inline-flex oui-text-base-contrast-36",e.direction==="column"?"oui-flex-col":"oui-flex-row oui-gap-1",e.className),children:a});return e.tooltip?t.jsx(Ie,{content:o,className:"oui-bg-base-5",arrow:{className:"oui-fill-base-5"},children:l}):l},Fi=e=>{let{qty:i,price:r,entryPrice:n,orderSide:s,orderType:o,symbolInfo:a}=e,l=ue.priceToPnl({qty:i,price:r,entryPrice:n,orderSide:s,orderType:o},{symbol:a}),u=o===fe.TAKE_PROFIT?"TP":"SL";return t.jsxs("div",{className:"oui-flex oui-items-center",children:[t.jsx("span",{className:"oui-text-base-contrast-54 oui-mr-1",children:`${u} PnL:`}),t.jsx(p.numeral,{rule:"price",dp:a.quote_dp,padding:!1,className:l===0?"oui-text-base-contrast-36":l>0?"oui-text-trade-profit oui-gap-0":"oui-text-trade-loss oui-gap-0",prefix:t.jsx("span",{children:l===0?"":l>0?"+":"-"}),suffix:t.jsx("span",{className:"oui-text-base-contrast-36 oui-ml-1",children:"USDC"}),children:`${Math.abs(l)}`})]})},Xl=e=>{let{order:i}=e,{quote_dp:r,base_dp:n}=ze(),{sl_trigger_price:s,tp_trigger_price:o}=c.useMemo(()=>!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:ue.findTPSLFromOrder(e.order.child_orders[0]),[e.order]),{pnl:a,roi:l}=Zr(i);return!o&&!s?"--":t.jsx(Ie,{content:t.jsxs(y,{direction:"column",itemAlign:"start",gap:1,children:[typeof a.tpPnL<"u"&&t.jsx(p.numeral,{prefix:t.jsx(p,{intensity:80,children:"TP PnL:  "}),suffix:t.jsx(p,{intensity:20,children:" USDC"}),dp:r,color:"buy",showIdentifier:!0,children:a.tpPnL}),typeof a.slPnL<"u"&&t.jsx(p.numeral,{prefix:t.jsx(p,{intensity:80,children:"SL PnL:  "}),suffix:t.jsx(p,{intensity:20,children:" USDC"}),dp:r,color:"sell",children:a.slPnL})]}),className:"oui-bg-base-6",children:t.jsxs(y,{direction:"column",width:"100%",justify:"start",itemAlign:"start",children:[t.jsx(Ri,{type:"TP",value:o,quote_dp:r}),t.jsx(Ri,{type:"SL",value:s,quote_dp:r})]})})},Ri=e=>{let{type:i,value:r,quote_dp:n}=e;return r?t.jsx(p.numeral,{className:z("oui-gap-0 oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12",i==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),rule:"price",dp:n,prefix:t.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${i}`," - "]}),children:r},"tp"):t.jsx(t.Fragment,{})},Jl=e=>{let{position:i,order:r}=We(),{quote_dp:n,base_dp:s}=ze();return t.jsx(fi,{quoteDP:n,baseDP:s,position:i,order:r,label:"Edit",isEditing:!0})},Zl=()=>{let{sl_trigger_price:e,tp_trigger_price:i}=We();return t.jsxs("div",{children:[i?t.jsxs("div",{className:"oui-text-base-contrast-80 oui-td-bg-transparent",children:[t.jsx("span",{className:"oui-text-base-contrast-54",children:"TP - "}),t.jsx("span",{children:"Market"})]}):null,e?t.jsxs("div",{className:"oui-text-base-contrast-80 oui-td-bg-transparent",children:[t.jsx("span",{className:"oui-text-base-contrast-54",children:"SL - "}),t.jsx("span",{children:"Market"})]}):null]})};function eu(e){let{sl_trigger_price:i,tp_trigger_price:r}=!("algo_type"in e)||!Array.isArray(e.child_orders)?{}:ue.findTPSLFromOrder(e);return{tpTriggerPrice:r?"TP - Market":void 0,slTriggerPrice:i?"SL - Market":void 0}}var tu=e=>e.sharePnLConfig==null?t.jsx(t.Fragment,{}):t.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),he.show(e.modalId,{pnl:{entity:{symbol:e.order.symbol,pnl:e.order.realized_pnl,side:e.order.side=="BUY"?"LONG":"SHORT",openPrice:e.order.average_executed_price,openTime:e.order.updated_time,quantity:e.order.quantity},refCode:e.refCode,leverage:e.leverage,...e.sharePnLConfig}})},children:t.jsx(pr,{color:"white",opacity:.54,size:e.iconSize??16})}),iu=e=>{let{sharePnLConfig:i,order:r,modalId:n,iconSize:s}=e,{getFirstRefCode:o}=Zt(),a=c.useMemo(()=>{var u;return(u=o())==null?void 0:u.code},[o]),l=cr(e.order.symbol);return{iconSize:s,order:r,refCode:a,leverage:l,sharePnLConfig:i,modalId:n}},ln=e=>{let i=iu(e);return t.jsx(tu,{...i})},ru=e=>{let{_type:i,onSymbolChange:r,pnlNotionalDecimalPrecision:n,sharePnLConfig:s}=e;return c.useMemo(()=>{switch(i){case"all":return[Fe({width:130,showType:!0,onSymbolChange:r,enableSort:!1}),Qe({width:130,disableEdit:!0,className:"oui-pl-0 oui-pr-0",enableSort:!1}),Ve({width:130,title:"Order price",disableEdit:!0,enableSort:!1}),wt({width:130,enableSort:!1}),Ui({width:130,symbolsInfo:e.symbolsInfo}),Vt({width:124,pnlNotionalDecimalPrecision:n,sharePnLConfig:s,symbolsInfo:e.symbolsInfo}),He({width:130,enableSort:!1}),at({width:130}),lt({width:130}),Re({width:130}),Ke({width:130}),Wi({width:130})];case"pending":return[Fe({width:172,showType:!0,onSymbolChange:r,enableSort:!1}),Qe({width:162,className:"oui-pr-0",enableSort:!1}),Ve({width:162,className:"oui-pr-0",enableSort:!1}),st({width:162,className:"oui-pr-0"}),au({width:130}),He({width:162,isPending:!0}),Re({width:162}),Ke({width:162}),ot({width:162,enableSort:!1}),uu({width:162})];case"tp_sl":return[Fe({width:176,showType:!0,onSymbolChange:r,enableSort:!1}),nu({width:176}),Ui({width:176,symbolsInfo:e.symbolsInfo}),su({width:176}),lu({width:176}),Re({width:176}),ot({width:176,enableSort:!1}),du({width:176})];case"filled":return[Fe({showType:!0,width:154,onSymbolChange:r}),Qe({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0"}),Ve({width:124,title:"Order price",disableEdit:!0}),ou({width:124}),st({width:124,disableEdit:!0}),Vt({width:124,pnlNotionalDecimalPrecision:n,sharePnLConfig:s,symbolsInfo:e.symbolsInfo}),He({width:124}),at({width:124}),lt({width:124}),Re({width:124}),Ke({width:124}),ot({width:176})];case"cancelled":return[Fe({showType:!0,width:154,onSymbolChange:r,enableSort:!1}),Qe({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0",enableSort:!1}),Ve({width:124,disableEdit:!0,enableSort:!1}),wt({width:124,enableSort:!1}),st({width:124,disableEdit:!0}),He({width:124}),at({width:124}),lt({width:124}),Re({width:124}),Ke({width:124})];case"rejected":return[Fe({showType:!0,width:154,onSymbolChange:r}),Qe({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0"}),Ve({width:124,disableEdit:!0}),wt({width:124}),st({width:124,disableEdit:!0}),He({width:124}),at({width:124}),lt({width:124}),Re({width:124}),Ke({width:124}),ot({width:176})];case"orderHistory":return[Fe({showType:!0,width:154,onSymbolChange:r}),Qe({width:150,disableEdit:!0,className:"oui-pl-6 oui-pr-0"}),Ve({width:124,disableEdit:!0}),wt({width:124}),st({width:124,disableEdit:!0}),Vt({width:124,pnlNotionalDecimalPrecision:n,sharePnLConfig:s,symbolsInfo:e.symbolsInfo}),He({width:124}),at({width:124}),lt({width:124}),Re({width:124}),Ke({width:124}),ot({width:150}),Wi({width:80})]}},[i,n,s])};function Fe(e){return{title:"Symbol",dataIndex:"symbol",fixed:"left",width:e==null?void 0:e.width,onSort:e!=null&&e.enableSort?(i,r)=>i.symbol.localeCompare(r.symbol):void 0,renderPlantText:(i,r)=>{var s;let n=(s=ft(r))==null?void 0:s.join(",");return`${i.split("_")[1]}-PERP (${n})`},render:(i,r)=>{var s;let n=bt(r);return t.jsxs(y,{gap:2,children:[t.jsx("div",{className:z("oui-rounded-[1px] oui-w-1 oui-h-7 oui-shrink-0",r.side===je.BUY?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsxs(y,{direction:"column",itemAlign:"start",children:[t.jsx(p.formatted,{size:"xs",className:"oui-cursor-pointer oui-text-xs",onClick:o=>{var a;(a=e==null?void 0:e.onSymbolChange)==null||a.call(e,{symbol:i}),o.stopPropagation(),o.preventDefault()},children:`${i.split("_")[1]}-PERP`}),(e==null?void 0:e.showType)&&t.jsx(y,{direction:"row",gap:1,children:(s=ft(r))==null?void 0:s.map((o,a)=>t.jsx(B,{color:o.toLocaleLowerCase()==="position"?n?"neutral":"primary":"neutral",size:"xs",children:o},a))})]})]})}}}function Qe(e){return{title:"Filled / Quantity",dataIndex:"fill_quantity",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>{let n=(i.algo_type===W.POSITIONAL_TP_SL?0:i.quantity)??0,s=(r.algo_type===W.POSITIONAL_TP_SL?0:r.quantity)??0;return jt(n,s)}:void 0,renderPlantText:(i,r)=>{if(r.type===ie.CLOSE_POSITION&&r.status!==Z.FILLED)return"Entire position";let n=r.total_executed_quantity;return("algo_type"in r&&r.algo_type===W.TP_SL?"":`${n} / `)+`${r.quantity}`},render:(i,r)=>r.type===ie.CLOSE_POSITION&&r.status!==Z.FILLED?"Entire position":t.jsx(an,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function nu(e){return{title:"Quantity",className:e==null?void 0:e.className,dataIndex:"quantity",width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>{let n=(i.algo_type===W.POSITIONAL_TP_SL?0:i.quantity)??0,s=(r.algo_type===W.POSITIONAL_TP_SL?0:r.quantity)??0;return jt(n,s)}:void 0,renderPlantText:(i,r)=>{if(r.algo_type===W.POSITIONAL_TP_SL)return"Entire position";let n=r.total_executed_quantity;return("algo_type"in r&&r.algo_type===W.TP_SL?"":`${n}/`)+`${r.quantity}`},render:(i,r)=>r.algo_type===W.POSITIONAL_TP_SL?"Entire position":t.jsx(an,{order:r})}}function Ve(e){return{title:(e==null?void 0:e.title)??"Price",dataIndex:"price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r,n)=>jt(i.price??0,r.price??0):void 0,renderPlantText:(i,r)=>{var n;return X((n=r.price)==null?void 0:n.toString(),{fallback:"Market"})},render:(i,r)=>t.jsx(Bl,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function su(e){return{title:(e==null?void 0:e.title)??"Price",dataIndex:"price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let{tpTriggerPrice:n,slTriggerPrice:s}=eu(r),o=`${n||""}${s?`${n?`
`:""}${s}`:""}`;return o.length>0?o:"--"},render:(i,r)=>t.jsx(Zl,{})}}function ou(e){return{title:"Avg. price",dataIndex:"average_executed_price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,render:(i,r)=>X(i)}}function st(e){return{title:"Trigger",className:e==null?void 0:e.className,dataIndex:"trigger_price",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let n=(r==null?void 0:r.algo_order_id)!==void 0,s=(r==null?void 0:r.algo_type)==="BRACKET";return!n||s?"--":X(i)},render:(i,r)=>t.jsx(Vl,{order:r,disableEdit:e==null?void 0:e.disableEdit})}}function Ui(e){return{title:(e==null?void 0:e.title)??"Trigger",className:e==null?void 0:e.className,dataIndex:"tpsl_trigger_price",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{var u;let n=(u=e==null?void 0:e.symbolsInfo)==null?void 0:u[r.symbol],s=n==null?void 0:n("quote_dp"),{sl_trigger_price:o,tp_trigger_price:a}=!("algo_type"in r)||!Array.isArray(r.child_orders)?{}:ue.findTPSLFromOrder(r),l=(a!=null?`TP: ${X(a,{fix:s,padEnd:!0})}`:"")+(o!=null?`${a?`
`:""}SL: ${X(o,{fix:s,padEnd:!0})}`:"");return l.length>0?l:"--"},render:(i,r)=>t.jsx(Yl,{})}}function au(e){return{title:"TP/SL",className:e==null?void 0:e.className,dataIndex:"bracketOrderPrice",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(i,r)=>{let n=()=>!("algo_type"in r)||!Array.isArray(r.child_orders)?{}:ue.findTPSLFromOrder(r.child_orders[0]),{sl_trigger_price:s,tp_trigger_price:o}=n(),a=(o!=null?`TP: ${o}`:"")+(s!=null?`${o?`
`:""}SL: ${s}`:"");return a.length>0?a:"--"},render:(i,r)=>t.jsx(Xl,{order:r})}}function He(e){return{title:"Notional",dataIndex:"executed",width:e==null?void 0:e.width,className:e==null?void 0:e.className,onSort:(e==null?void 0:e.enableSort)??!1?(i,r,n)=>{let s=i.type===ie.CLOSE_POSITION&&i.status!==Z.FILLED||i.total_executed_quantity===0||Number.isNaN(i.average_executed_price)||i.average_executed_price===null?0:i.total_executed_quantity*i.average_executed_price,o=r.type===ie.CLOSE_POSITION&&r.status!==Z.FILLED||r.total_executed_quantity===0||Number.isNaN(r.average_executed_price)||r.average_executed_price===null?0:r.total_executed_quantity*r.average_executed_price;return jt(s,o)}:void 0,renderPlantText:(i,r)=>Ht(r,(e==null?void 0:e.isPending)??!1)==="Entire position"?"Entire position":X(Ht(r,(e==null?void 0:e.isPending)??!1),{fix:2}),render:(i,r)=>{let n=Ht(r,(e==null?void 0:e.isPending)??!1);return n==="Entire position"?"Entire position":t.jsx(p.numeral,{rm:D.ROUND_DOWN,dp:2,children:n})}}}function Vt(e){return{title:"Real. PnL",dataIndex:"realized_pnl",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>{var u;let n=(u=e==null?void 0:e.symbolsInfo)==null?void 0:u[r.symbol],s=n==null?void 0:n("quote_dp"),o=(e==null?void 0:e.pnlNotionalDecimalPrecision)??s,a=new D(i??0).toDecimalPlaces(o,D.ROUND_DOWN).toNumber(),l=X(a);return a>0?`+${l}`:l},render:(i,r)=>{let{quote_dp:n}=ze(),s=(e==null?void 0:e.pnlNotionalDecimalPrecision)??n,o=new D(i??0).toDecimalPlaces(s,D.ROUND_DOWN).toNumber();return t.jsxs(y,{gap:1,children:[t.jsx(p.numeral,{dp:s,rm:D.ROUND_DOWN,padding:!1,intensity:(o??0)==0?80:void 0,showIdentifier:(o??0)>0,coloring:(o??0)!=0,children:o??"--"}),t.jsx(ln,{order:r,sharePnLConfig:e==null?void 0:e.sharePnLConfig,modalId:pi})]})}}}function Re(e){return{title:"Reduce only",dataIndex:"reduce_only",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>i?"Yes":"No",render:i=>t.jsx(p,{children:i?"Yes":"No"})}}function Ke(e){return{title:"Hidden",dataIndex:"visible",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(i,r)=>i!==0?"No":"Yes",render:(i,r)=>t.jsx(p,{children:r.visible_quantity!==0?"No":"Yes"})}}function ot(e){return{title:"Order time",dataIndex:"created_time",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(i,r)=>{let n=new Date(i);return hr(n,"yyyy-MM-dd HH:mm:ss")},render:i=>t.jsx(p.formatted,{rule:"date",formatString:(e==null?void 0:e.formatString)||"yyyy-MM-dd HH:mm:ss",className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:i})}}function at(e){return{title:"Fee",dataIndex:"total_fee",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className}}function lu(e){return{title:"Notional",dataIndex:"executed",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(i,r)=>r.algo_type===W.POSITIONAL_TP_SL?"Entire position":X(r.quantity===0?"--":`${new D(r.mark_price).mul(r.quantity).todp(2).toNumber()}`),render:(i,r)=>r.algo_type===W.POSITIONAL_TP_SL?"Entire position":t.jsx(p.numeral,{className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:r.quantity===0?"--":`${new D(r.mark_price).mul(r.quantity).todp(2).toNumber()}`})}}function lt(e){return{title:"Status",dataIndex:"status",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(i,r)=>{let n=i||r.algo_status;return Oe(n==="NEW"?"pending":n)},render:(i,r)=>{let n=i||r.algo_status;return Oe(n==="NEW"?"pending":n)}}}function wt(e){return{title:"Avg. open",dataIndex:"average_executed_price",width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(i,r)=>jt(i.average_executed_price??0,r.average_executed_price??0):void 0,className:e==null?void 0:e.className,render:(i,r)=>r.type===ie.MARKET&&!i?"--":t.jsx(p.numeral,{className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:i}),renderPlantText:(i,r)=>X(i,{fix:2})}}function Wi(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>r.status===Z.CANCELLED?t.jsx(Kl,{record:r}):r.status===Z.NEW||r.algo_status===Z.NEW?t.jsx(yi,{order:r}):null}}function uu(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>t.jsx(yi,{order:r})}}function du(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(i,r)=>t.jsxs(y,{gap:3,children:[t.jsx(Jl,{order:r}),t.jsx(yi,{order:r})]})}}function jt(e,i){return e>i?1:e<i?-1:0}function Ht(e,i){return i?e.price&&e.quantity?new D(e.price).mul(e.quantity).toFixed(2,D.ROUND_DOWN):"--":e.type===ie.CLOSE_POSITION&&e.status!==Z.FILLED?"Entire position":e.total_executed_quantity===0||Number.isNaN(e.average_executed_price)||e.average_executed_price===null?"--":`${e.total_executed_quantity*e.average_executed_price}`}var cu=e=>{let{item:i}=e,r=i.side===je.BUY;return t.jsx(p.formatted,{intensity:80,rule:"symbol",formatString:"base-type",size:"sm",prefix:t.jsx(B,{color:r?"success":"danger",size:"xs",children:r?"Buy":"Sell"}),onClick:()=>{var n;(n=e.onSymbolChange)==null||n.call(e,{symbol:i.symbol})},children:i.symbol})},pu=e=>{var r;let{item:i}=e;return c.useCallback(()=>{let n=typeof i.type=="string"?i.type.replace("_ORDER","").toLowerCase():i.type;return i.algo_order_id&&i.algo_type!==W.BRACKET?`Stop ${n}`:Oe(i.type)},[i]),t.jsx(y,{direction:"row",gap:1,children:(r=ft(e.item))==null?void 0:r.map((n,s)=>t.jsx(B,{color:n.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:n},s))})},mu=e=>{let{item:i}=e;return t.jsx(p.formatted,{rule:"date",formatString:"yyyy-MM-dd hh:mm:ss",intensity:36,size:"2xs",children:i.updated_time})},fu=e=>{let{item:i}=e,r=i.status||i.algo_status,n=()=>Oe(r==="NEW"?"pending":r);return t.jsx(p.formatted,{intensity:80,size:"2xs",children:n()})},Bi=e=>{let{item:i}=e,r=i.type===ie.CLOSE_POSITION&&(i==null?void 0:i.status)!==Z.FILLED;return t.jsx(ee,{label:"Qty.",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.base_dp,padding:!1,coloring:!0,placeholder:"Entire position",intensity:80,children:r?"--":i.quantity})})},Qi=e=>{let{item:i}=e;return t.jsx(ee,{label:t.jsx(p,{children:"Filled"}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.base_dp,intensity:80,padding:!1,rm:D.ROUND_DOWN,children:i.total_executed_quantity})})},hu=e=>{let{item:i}=e,r=c.useMemo(()=>i.price&&i.quantity?new D(i.price).mul(i.quantity).toFixed(e.quote_dp,D.ROUND_DOWN):"--",[i.price,i.quantity]);return t.jsx(ee,{align:"end",label:t.jsxs(p,{children:["Notional",t.jsx(p,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,coloring:!0,intensity:80,padding:!1,rm:D.ROUND_DOWN,children:r})})},Vi=e=>{let{item:i}=e;return t.jsx(ee,{label:"Trigger price",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:e.align,children:t.jsx(p.numeral,{dp:e.quote_dp,intensity:80,padding:!1,rm:D.ROUND_DOWN,children:i.trigger_price??"--"})})},xu=e=>{let{item:i}=e;return t.jsx(ee,{label:"Mark price",align:"end",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,intensity:80,padding:!1,children:i.mark_price})})},gu=e=>{let{item:i}=e,r=(i==null?void 0:i.algo_order_id)!==void 0,n=(i==null?void 0:i.type)==="MARKET"&&r;return t.jsx(ee,{label:"Limit price",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n?t.jsx(p,{children:"Market"}):t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,intensity:80,padding:!1,children:i.price??"--"})})},yu=e=>{let{tp_trigger_price:i,tpPnL:r}=We();return t.jsx(ee,{label:"TP trigger",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(bi,{content:r&&t.jsx(p.numeral,{size:"2xs",showIdentifier:!0,prefix:t.jsx(p,{intensity:54,children:"TP PnL:  "}),suffix:t.jsx(p,{intensity:20,children:" USDC"}),coloring:!0,children:r}),classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},children:t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,color:"buy",padding:!1,className:i?"oui-border-b oui-border-dashed oui-border-base-contrast-12":void 0,children:i??"--"})})})},bu=e=>{let{sl_trigger_price:i,slPnL:r}=We();return t.jsx(ee,{label:"SL trigger",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(bi,{content:r&&t.jsx(p.numeral,{size:"2xs",prefix:t.jsx(p,{intensity:54,children:"SL PnL:  "}),suffix:t.jsx(p,{intensity:20,children:" USDC"}),coloring:!0,children:r}),classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},children:t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,color:"sell",padding:!1,className:i?"oui-border-b oui-border-dashed oui-border-base-contrast-12":void 0,children:i??"--"})})})},ju=e=>t.jsx(ee,{label:"TP price",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p,{intensity:80,children:"Market"})}),_u=e=>t.jsx(ee,{label:"SL price",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p,{intensity:80,children:"Market"})}),wu=e=>{let{item:i}=e,r=c.useMemo(()=>i.algo_type===W.POSITIONAL_TP_SL?t.jsx("span",{className:"oui-text-base-contrast-80",children:"Entire position"}):t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,intensity:80,padding:!1,children:i.quantity}),[i]);return t.jsx(ee,{label:"Quantity",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:r})},vu=e=>{var i;return t.jsx(ee,{label:t.jsxs(p,{children:["Avg price",t.jsx(p,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,intensity:80,padding:!1,children:((i=e.item)==null?void 0:i.average_executed_price)??"--"})})},Nu=e=>{var i;return t.jsx(ee,{label:t.jsxs(p,{children:["Order price",t.jsx(p,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,intensity:80,padding:!1,placeholder:"Market",children:((i=e.item)==null?void 0:i.price)??"--"})})},Cu=e=>{var r;let i=(r=e==null?void 0:e.item)==null?void 0:r.realized_pnl;return t.jsx(ee,{label:t.jsxs(p,{children:["Real. PnL",t.jsx(p,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:t.jsxs(y,{gap:1,children:[t.jsx(p.numeral,{dp:e.quote_dp,rm:D.ROUND_DOWN,padding:!1,intensity:(i??0)==0?80:void 0,showIdentifier:(i??0)>0,coloring:(i??0)!=0,children:i??"--"}),t.jsx(ln,{order:e.item,sharePnLConfig:e.sharePnLConfig,modalId:mi,iconSize:12})]})})},bi=e=>{let{classNames:i,content:r}=e,[n,s]=c.useState(!1);return typeof r>"u"?e.children:t.jsx(Ie,{content:r,className:i==null?void 0:i.content,open:n,onOpenChange:s,arrow:{className:i==null?void 0:i.arrow},children:t.jsx("div",{onClick:()=>s(o=>!o),children:e.children})})},Su=e=>{let{item:i}=e;return i.quantity>0,t.jsx(t.Fragment,{children:t.jsx(J,{variant:"outlined",fullWidth:!0,color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:()=>{e.onShowEditSheet()},children:"Edit"})})},Pu=e=>{var l;let{side:i}=e.item,{price:r,quantity:n,triggerPrice:s,isAlgoOrder:o}=e,a=i===je.BUY;return t.jsxs("div",{className:"oui-pt-2",children:[t.jsx(p,{intensity:80,children:`You agree to edit your ${e.base}-PERP order.`}),t.jsxs(y,{gap:2,mb:3,mt:2,justify:"between",children:[t.jsx(p.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,children:e.item.symbol}),t.jsxs(y,{direction:"row",gap:1,children:[(l=ft(e.item))==null?void 0:l.map((u,d)=>t.jsx(B,{color:u.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:u},d)),a&&t.jsx(B,{color:"success",size:"xs",children:"Buy"}),!a&&t.jsx(B,{color:"danger",size:"xs",children:"Sell"})]})]}),t.jsx(ve,{}),t.jsxs(y,{direction:"column",gap:1,width:"100%",className:"oui-text-sm oui-text-base-contrast-54",py:3,children:[o&&t.jsxs(y,{justify:"between",width:"100%",gap:1,children:[t.jsx(p,{children:"Trigger price"}),t.jsx(p.numeral,{intensity:80,dp:e.quote_dp,padding:!1,rm:D.ROUND_DOWN,suffix:t.jsx(p,{intensity:54,children:" USDC"}),children:s??"--"})]}),t.jsxs(y,{justify:"between",width:"100%",gap:1,children:[t.jsx(p,{children:"Price"}),t.jsx(p.numeral,{intensity:80,dp:e.quote_dp,padding:!1,rm:D.ROUND_DOWN,suffix:t.jsx(p,{intensity:54,children:" USDC"}),placeholder:e.isStopMarket?"Market":"--",children:e.isStopMarket?"Market":r??"--"})]}),t.jsxs(y,{justify:"between",width:"100%",gap:1,children:[t.jsx(p,{children:"Qty."}),t.jsx(p.numeral,{color:i===je.BUY?"buy":"sell",dp:e.base_dp,padding:!1,rm:D.ROUND_DOWN,children:n??"--"})]})]}),t.jsxs(y,{className:"oui-gap-[2px]",children:[t.jsx(lr,{color:"white",id:"oui-checkbox-disableOrderConfirmation",checked:!e.orderConfirm,onCheckedChange:u=>{e.setOrderConfirm(!u)}}),t.jsx("label",{className:"oui-text-2xs oui-text-base-contrast-54",htmlFor:"oui-checkbox-disableOrderConfirmation",children:"Disable order confirmation"})]})]})},Lu=e=>{var o,a,l,u,d,f,h,x,b,m,g,j,_,w,v,L,q,O,T,N,C;let{item:i}=e,r=i.side===je.BUY,n=e.quantity&&e.maxQty?Math.min(Number(e.quantity)/e.maxQty,1):void 0,s=S=>{let I=e.baseTick;if(I&&I>0){let P=ue.formatNumber(S,I)??S;e.setQuantity(P)}};return t.jsxs(t.Fragment,{children:[t.jsxs(y,{direction:"column",gap:3,width:"100%",itemAlign:"start",className:"oui-text-sm",children:[t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(p.formatted,{rule:"symbol",showIcon:!0,intensity:80,children:i.symbol}),t.jsxs(y,{direction:"row",gap:1,children:[(o=ft(e.item))==null?void 0:o.map((S,I)=>t.jsx(B,{color:S.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:S},I)),r&&t.jsx(B,{color:"success",size:"xs",children:"Buy"}),!r&&t.jsx(B,{color:"danger",size:"xs",children:"Sell"})]})]}),t.jsx(ve,{intensity:8,className:"oui-w-full"}),t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(p,{children:"Last price"}),t.jsx(p.numeral,{dp:(l=(a=e.item)==null?void 0:a.symbolInfo)==null?void 0:l.duote_dp,children:e.curMarkPrice??"--"})]}),t.jsxs(y,{width:"100%",direction:"column",itemAlign:"stretch",gap:2,children:[e.isAlgoOrder&&t.jsx(be.tooltip,{prefix:t.jsx(p,{intensity:54,className:"oui-px-3",children:"Trigger price"}),suffix:t.jsx(p,{intensity:54,className:"oui-px-3",children:e.quote}),color:(d=(u=e.errors)==null?void 0:u.trigger_price)!=null&&d.message?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.quote_dp)],value:e.triggerPrice,onValueChange:S=>e.setTriggerPrice(S),tooltip:(h=(f=e.errors)==null?void 0:f.trigger_price)==null?void 0:h.message,tooltipProps:{content:{className:"oui-bg-base-6 oui-text-base-contrast-80"},arrow:{className:"oui-fill-base-6"}},classNames:{input:"oui-text-base-contrast-98 oui-w-full",root:z("oui-outline-line-12",((b=(x=e.errors)==null?void 0:x.trigger_price)==null?void 0:b.message)&&"oui-outline-danger")}}),t.jsx(be.tooltip,{prefix:t.jsx(p,{intensity:54,className:"oui-px-3",children:"Price"}),suffix:t.jsx(p,{intensity:54,className:"oui-px-3",children:e.quote}),color:(g=(m=e.errors)==null?void 0:m.order_price)!=null&&g.message?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.quote_dp)],disabled:!e.priceEdit,value:e.isStopMarket?"Market":e.price,onValueChange:S=>e.setPrice(S),tooltip:(_=(j=e.errors)==null?void 0:j.order_price)==null?void 0:_.message,tooltipProps:{content:{className:"oui-bg-base-5"},arrow:{className:"oui-fill-base-5"}},classNames:{input:"oui-text-base-contrast-98",root:z("oui-outline-line-12",((v=(w=e.errors)==null?void 0:w.order_price)==null?void 0:v.message)&&"oui-outline-danger")}}),t.jsx(be.tooltip,{prefix:t.jsx(p,{intensity:54,className:"oui-px-3",children:"Quantity"}),suffix:t.jsx(p,{intensity:54,className:"oui-px-3",children:e.base}),color:(q=(L=e.errors)==null?void 0:L.order_quantity)!=null&&q.message?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[Q.numberFormatter,Q.dpFormatter(e.base_dp)],value:e.quantity,onValueChange:S=>{e.setQuantity(S)},onBlur:S=>s(S.target.value),tooltip:(T=(O=e.errors)==null?void 0:O.order_quantity)==null?void 0:T.message,tooltipProps:{content:{className:"oui-bg-base-6"},arrow:{className:"oui-fill-base-6"}},classNames:{input:"oui-text-base-contrast-98",root:z("oui-outline-line-12",((C=(N=e.errors)==null?void 0:N.order_quantity)==null?void 0:C.message)&&"oui-outline-danger")}}),t.jsx(Ze,{markCount:4,value:[e.sliderValue??0],onValueChange:S=>{e.setSliderValue(S[0])},color:"primary"}),t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(p.numeral,{color:"primary",size:"2xs",dp:2,padding:!1,rule:"percentages",children:`${n??0}`}),t.jsxs(y,{gap:1,children:[t.jsx(p,{size:"2xs",color:"primary",children:"Max"}),t.jsx(p.numeral,{intensity:54,size:"2xs",dp:e.base_dp,children:e.maxQty})]})]})]}),t.jsxs(y,{width:"100%",gap:3,mt:2,children:[t.jsx(J,{fullWidth:!0,color:"secondary",onClick:S=>{e.onClose()},children:"Cancel"}),t.jsx(et,{fullWidth:!0,onClick:S=>{S.stopPropagation(),S.preventDefault(),e.onSheetConfirm()},loading:e.submitting,disabled:!e.isChanged,children:"Confirm"})]})]}),t.jsx(gt,{open:e.dialogOpen,onOpenChange:e.setDialogOpen,title:"Edit order",size:"xs",actions:{primary:{label:"Confirm",onClick:e.onDialogConfirm,loading:e.submitting,fullWidth:!0},secondary:{label:"Cancel",onClick:e.onCloseDialog,fullWidth:!0}},classNames:{content:"oui-pb-4",body:"oui-p-0",footer:"oui-pt-3 oui-pb-0"},children:t.jsx(Pu,{...e})})]})},Ou=e=>{let{state:i,editAlgoOrder:r,editOrder:n,autoCheckInput:s=!0,position:o}=e,{item:a}=i,{hide:l}=ri(),[u,d]=c.useState(!1),f=(a==null?void 0:a.algo_order_id)!==void 0&&a.algo_type!==W.BRACKET,h=(a==null?void 0:a.type)==="MARKET"&&f;h||(a==null||a.type);let[x,b]=c.useState(!1),m=c.useMemo(()=>f&&a.algo_type!==W.BRACKET?`STOP_${a.type}`:a.type,[a,f]),[g,j]=we("orderly_order_confirm",!0),{base_dp:_,base_tick:w}=e.state,{formattedOrder:v,setValue:L,markPrice:q,errors:O,validate:T,maxQty:N}=ku({order:a,orderType:m,position:o}),C=()=>{T().then(k=>{g?d(!0):E(v)},k=>{var U;(U=k==null?void 0:k.total)!=null&&U.message&&F.error(k==null?void 0:k.total.message)}).catch(k=>{})},S=c.useCallback(()=>{d(!1)},[]),I=()=>v?E(v):Promise.reject(),P=c.useCallback(()=>{l()},[]),E=c.useCallback(async k=>{let U,te=a.visible_quantity!==void 0?a.visible_quantity===0:a.visible!==void 0?a.visible===0:!1;if(a.algo_order_id!==void 0){if(h&&"order_price"in k){let{order_price:V,...Ne}=k;k=Ne}U=r(a.algo_order_id.toString(),{...k})}else U=n(a.order_id.toString(),{...k,...te?{visible_quantity:0}:{}});try{b(!0);let V=await U;P()}catch(V){F.error((V==null?void 0:V.message)??`${V}`)}finally{b(!1)}},[r,n]),M=c.useMemo(()=>{let k=v.order_quantity;return k&&Number(k)!==0&&N!==0?new D(k).div(N).mul(100).toDecimalPlaces(2,D.ROUND_DOWN).toNumber():0},[v.order_quantity,N]),R=a.price!=v.order_price||a.quantity!=v.order_quantity||a.trigger_price!=v.trigger_price,se=os(k=>{let U=new D(k).div(100).mul(N).toDecimalPlaces(_,D.ROUND_DOWN).toNumber();L("order_quantity",ue.formatNumber(U,w))},50,{}),re=(k,U)=>{L(k,U)};return{...i,curMarkPrice:q,isAlgoOrder:f,isStopMarket:h,price:v.order_price,setPrice:k=>re("order_price",k),priceEdit:!h,triggerPrice:v.trigger_price,setTriggerPrice:k=>re("trigger_price",k),quantity:v.order_quantity,setQuantity:k=>{re("order_quantity",k)},maxQty:N,sliderValue:M,setSliderValue:se,onClose:P,onSheetConfirm:C,errors:O,orderType:m,isChanged:R,baseTick:w,dialogOpen:u,setDialogOpen:d,onDialogConfirm:I,onCloseDialog:S,submitting:x,orderConfirm:g,setOrderConfirm:j}},ku=e=>{let{order:i,orderType:r,position:n}=e,[s,o]=c.useState({side:i.side,order_type:r,order_price:i.price,order_quantity:i.quantity,trigger_price:i.trigger_price,reduce_only:i.reduce_only,symbol:i.symbol}),{reduce_only:a}=i,l=n==null?void 0:n.position_qty,u=xr(i.symbol,i.side,i.reduce_only),d=c.useMemo(()=>a?Math.abs(l??0):i.quantity+Math.abs(u),[i.quantity,u,a,l]),{symbolInfo:f,markPrice:h,errors:x,validate:b}=as({...s,symbol:i.symbol},{maxQty:d});return{symbolInfo:f,markPrice:h,errors:x,validate:b,setValue:(m,g)=>{o(j=>({...j,[m]:g}))},formattedOrder:s,maxQty:d}},Du=e=>{let i=Ou(e);return t.jsx(Lu,{...i})},Tu=e=>{let{state:i}=e,{editAlgoOrder:r,editOrder:n}=rt(),{order:s,position:o}=We(),a=c.useCallback(()=>{e.state.type==="tp_sl"?he.sheet({title:"TP/SL",content:t.jsx(Ur,{isEditing:!0,order:e.state.item,position:o,symbolInfo:e.state.origin})}).catch(l=>{}):he.sheet({title:"Edit order",classNames:{content:"oui-bg-base-8"},content:t.jsx(Du,{position:o,state:i,editAlgoOrder:r,editOrder:n})}).catch(l=>{})},[i]);return{...i,onShowEditSheet:a}},Iu=e=>{let i=Tu(e);return t.jsx(Su,{...i})},qu=e=>t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"outlined",fullWidth:!0,color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:i=>e.setOpen(!0),children:"Cancel"}),e.open&&t.jsx(gt,{size:"xs",open:e.open,onOpenChange:e.setOpen,title:"Cancel order",actions:{primary:{label:"Confirm",loading:e.isLoading,fullWidth:!0,size:"md",onClick:i=>{e.onCancel(i)}},secondary:{label:"Cancel",fullWidth:!0,size:"md",onClick:()=>{e.onClose()}}},children:t.jsx(p,{size:"2xs",intensity:54,children:"Are you sure you want to cancel your pending order."})})]}),Eu=e=>{let{state:i}=e,[r,n]=c.useState(!1),{onCancelOrder:s}=rt(),[o,a]=c.useState(!1);return{...i,open:r,setOpen:n,onCancel:l=>s?(l==null||l.preventDefault(),l==null||l.stopPropagation(),a(!0),s(i.item).then(u=>{n(!1)},u=>{F.error(u.message)}).finally(()=>{a(!1)})):Promise.resolve(),onClose:()=>{n(!1)},isLoading:o}},Mu=e=>{let i=Eu(e);return t.jsx(qu,{...i})},Au=e=>{var i,r,n,s;return!e.sl_trigger_price&&!e.tp_trigger_price?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:t.jsx(bi,{classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},content:t.jsxs(y,{direction:"column",itemAlign:"start",gap:1,children:[typeof((i=e.pnl)==null?void 0:i.tpPnL)<"u"&&t.jsx(p.numeral,{prefix:t.jsx(p,{intensity:80,children:"TP PnL:  "}),suffix:t.jsx(p,{intensity:20,children:" USDC"}),dp:e.quote_dp,color:"buy",showIdentifier:!0,children:(r=e.pnl)==null?void 0:r.tpPnL}),typeof((n=e.pnl)==null?void 0:n.slPnL)<"u"&&t.jsx(p.numeral,{prefix:t.jsx(p,{intensity:80,children:"SL PnL:  "}),suffix:t.jsx(p,{intensity:20,children:" USDC"}),dp:e.quote_dp,color:"sell",children:(s=e.pnl)==null?void 0:s.slPnL})]}),children:t.jsx("button",{onClick:()=>{e.setOpen(!e.open)},children:t.jsxs(y,{gap:1,width:"1",children:[e.tp_trigger_price&&t.jsx(Hi,{type:"TP",value:e.tp_trigger_price,quote_dp:e.quote_dp}),e.sl_trigger_price&&t.jsx(Hi,{type:"SL",value:e.sl_trigger_price,quote_dp:e.quote_dp})]})})})})},Hi=e=>{let{type:i,value:r,quote_dp:n}=e;return r?t.jsx(p.numeral,{size:"2xs",className:z("oui-border-b oui-border-dashed oui-border-base-contrast-12",i==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),rule:"price",dp:n,padding:!1,rm:D.ROUND_DOWN,prefix:t.jsxs("span",{className:"oui-text-base-contrast-36",children:[`${i} `,":  "]}),children:r},"tp"):t.jsx(t.Fragment,{})},$u=e=>{let{item:i,quote_dp:r,base_dp:n}=e,[s,o]=c.useState(!1),{sl_trigger_price:a,tp_trigger_price:l}=c.useMemo(()=>!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:ue.findTPSLFromOrder(i.child_orders[0]),[i]),{pnl:u,roi:d}=Zr(i);return{sl_trigger_price:a,tp_trigger_price:l,pnl:u,roi:d,quote_dp:r,open:s,setOpen:o}},zu=e=>{let i=$u(e);return t.jsx(Au,{...i})},Fu=e=>t.jsxs(y,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:e.className,children:[t.jsx(Ru,{...e}),t.jsx(ve,{intensity:6,className:"oui-w-full"}),t.jsx(Uu,{...e}),e.type==="pending"&&t.jsx(zu,{...e}),e.type!=="orderHistory"&&t.jsx(Wu,{...e})]}),Ru=e=>t.jsxs(y,{direction:"column",gap:1,width:"100%",children:[t.jsxs(y,{justify:"between",width:"100%",children:[t.jsx(cu,{...e}),t.jsx(mu,{...e})]}),t.jsxs(y,{width:"100%",justify:"between",children:[t.jsx(pu,{...e}),e.type==="orderHistory"&&t.jsx(fu,{...e})]})]}),Uu=e=>t.jsx(Se,{cols:3,rows:2,width:"100%",gap:1,children:Bu(e)}),Wu=e=>t.jsxs(Se,{cols:3,rows:1,width:"100%",gap:2,children:[t.jsx("div",{}),t.jsx(Iu,{state:e}),t.jsx(Mu,{state:e})]});function Bu(e){switch(e.type){case"all":return t.jsx(t.Fragment,{});case"pending":return t.jsxs(t.Fragment,{children:[t.jsx(Bi,{...e}),t.jsx(Qi,{...e}),t.jsx(hu,{...e}),t.jsx(Vi,{...e}),t.jsx(gu,{...e}),t.jsx(xu,{...e})]});case"tp_sl":return t.jsxs(t.Fragment,{children:[t.jsx(yu,{...e}),t.jsx(ju,{...e}),t.jsx(wu,{...e}),t.jsx(bu,{...e}),t.jsx(_u,{...e})]});case"filled":return t.jsx(t.Fragment,{});case"cancelled":return t.jsx(t.Fragment,{});case"rejected":return t.jsx(t.Fragment,{});case"orderHistory":return t.jsxs(t.Fragment,{children:[t.jsx(Bi,{...e}),t.jsx(Qi,{...e}),t.jsx(Vi,{...e,align:"end"}),t.jsx(vu,{...e}),t.jsx(Nu,{...e}),t.jsx(Cu,{...e})]})}}var Qu=e=>{let i=ze();return{...e,...i}},Vu=e=>{let{className:i,...r}=e,n=Qu(r);return t.jsx(Fu,{...n,className:i})},Hu=e=>{var s;let{sharePnLConfig:i,...r}=e,n=ru({_type:e.type,onSymbolChange:e.onSymbolChange,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:i,symbolsInfo:e.symbolsInfo});return t.jsx(nn,{cancelOrder:e.cancelOrder,editOrder:e.updateOrder,cancelAlgoOrder:e.cancelAlgoOrder,editAlgoOrder:e.updateAlgoOrder,children:t.jsxs(y,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[e.filterItems.length>0&&t.jsx(xt,{items:e.filterItems,onFilter:o=>{e.onFilter(o)},trailing:["pending","tp_sl"].includes(e.type)&&t.jsx(Yu,{...e})}),t.jsx(It,{columns:n,loading:e.isLoading,dataSource:e.dataSource,bordered:!0,ignoreLoadingCheck:!0,testIds:{body:(s=e.testIds)==null?void 0:s.tableBody},classNames:{header:"oui-h-[38px]",root:"oui-items-start !oui-h-[calc(100%_-_49px)]"},onRow:(o,a)=>({className:z("oui-h-[48px]",bt(o)?"oui-text-base-contrast-20":"oui-text-base-contrast-80")}),generatedRowKey:(o,a)=>`${e.type}${a}${o.order_id||o.algo_order_id}_index${a}`,renderRowContainer:(o,a,l)=>((e.type==="tp_sl"||e.type==="pending")&&(l=t.jsx(on,{order:o,children:l})),t.jsx(tn,{symbol:o.symbol,children:l})),pagination:e.pagination,manualPagination:e.manualPagination,features:[Zn.DownloadFeature],getTableInstance:o=>{e.tableInstance.current=o}})]})})},Ku=e=>{var i,r;return t.jsx(nn,{cancelOrder:e.cancelOrder,editOrder:e.updateOrder,cancelAlgoOrder:e.cancelAlgoOrder,editAlgoOrder:e.updateAlgoOrder,children:t.jsxs(Se,{cols:1,rows:2,className:"oui-grid-rows-[auto,1fr] oui-w-full",gap:2,children:[e.showFilter?t.jsx(y,{gap:2,p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:e.filterItems.map(n=>n.type!=="select"?t.jsx(t.Fragment,{}):t.jsx(es,{options:n.options,size:"sm",value:n.value,className:"oui-text-2xs oui-text-base-contrast-54 ",placeholder:n.name==="side"?"All sides":n.name==="status"?"All status":"",onValueChange:s=>{var o;(o=e.onFilter)==null||o.call(e,{name:n.name,value:s})}}))}):t.jsx("div",{}),t.jsx(Dt,{className:(i=e.classNames)==null?void 0:i.root,contentClassName:(r=e.classNames)==null?void 0:r.content,dataSource:e.dataSource,loadMore:e.loadMore,isLoading:e.isLoading,renderItem:(n,s)=>{var a;let o=t.jsx(Vu,{item:n,index:s,className:(a=e.classNames)==null?void 0:a.cell,type:e.type,onSymbolChange:e.onSymbolChange,sharePnLConfig:e.sharePnLConfig});return["tp_sl","pending"].includes(e.type)&&(o=t.jsx(on,{order:n,children:o})),t.jsx(tn,{symbol:n.symbol,children:o})}})]})})},Yu=e=>{var i;return t.jsx(J,{variant:"outlined",color:"secondary",size:"xs",disabled:(((i=e.dataSource)==null?void 0:i.length)??0)==0,className:"disabled:oui-bg-transport",onClick:r=>e.onCancelAll(),"data-testid":`oui-testid-dataList-${e.type.toLowerCase()}-cancelAll-button`,children:"Cancel all"})},Gu=e=>c.useMemo(()=>{let i=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.algo_type===W.POSITIONAL_TP_SL||n.algo_type===W.TP_SL)if(n.algo_status!==Z.FILLED&&n.algo_status!==Z.PARTIAL_FILLED)for(let s=0;s<n.child_orders.length;s++){let o=n.child_orders[s];!o.is_activated||!o.trigger_price||(o.parent_algo_type=n.algo_type,i.push(o))}else for(let s=0;s<n.child_orders.length;s++){let o=n.child_orders[s];o&&(o.algo_status===Z.FILLED||o.algo_status===Z.PARTIAL_FILLED)&&(o.parent_algo_type=n.algo_type,i.push(o))}else i.push(n)}return i},[e]),un=e=>{let{ordersStatus:i,type:r,enableLoadMore:n=!1,onSymbolChange:s,filterConfig:o,pnlNotionalDecimalPrecision:a,sharePnLConfig:l}=e,u=Ee(),d=c.useMemo(()=>i!==Z.INCOMPLETE,[i]),f=50,{page:h,pageSize:x,setPage:b,pagination:m,parsePagination:g}=kt({pageSize:f});c.useEffect(()=>{b(1)},[e.symbol]);let{orderStatus:j,ordersSide:_,dateRange:w,filterItems:v,onFilter:L}=Xu(r,{ordersStatus:i,setPage:b,filterConfig:o}),q=c.useMemo(()=>{if(r==="tp_sl")return[W.POSITIONAL_TP_SL,W.TP_SL]},[r]),O=c.useMemo(()=>{if(r==="pending")return[W.POSITIONAL_TP_SL,W.TP_SL]},[r]),T=c.useRef();c.useImperativeHandle(e.ref,()=>({download:()=>{var de;let Pe=`orders_${hr(new Date,"yyyyMMdd_HHmmss")}`;(de=T.current)==null||de.download(Pe)}}));let[N,{isLoading:C,loadMore:S,cancelOrder:I,updateOrder:P,cancelAlgoOrder:E,updateAlgoOrder:M,cancelAllOrders:R,cancelAllTPSLOrders:se,meta:re,refresh:k}]=Jn({symbol:e.symbol,status:j,side:_,page:n||!d?void 0:h,size:d?x:500,dateRange:w,includes:q,excludes:O}),U=`orderly_${r}_pageSize`,[te,V]=we(U,f);c.useEffect(()=>{te!==x&&V(x)},[x,te]);let Ne=c.useCallback(()=>{let Pe=e.type==="pending"?"Cancel all pending orders":e.type==="tp_sl"?"Cancel all TP/SL orders":"";he.confirm({title:Pe,content:t.jsx(p,{size:"sm",children:"Are you sure you want to cancel all of your pending orders?"}),onCancel:async()=>{},onOk:async()=>{try{return r==="tp_sl"?await se():await R(),k(),Promise.resolve(!0)}catch(ae){return(ae==null?void 0:ae.message)!==void 0&&toast.error(ae.message),Promise.resolve(!1)}finally{Promise.resolve()}}})},[r]),De=Gu(N??[]),pe=Tt(r!=="tp_sl"?De:N)??void 0,H=c.useMemo(()=>d?g(re):m,[re,d,g,m]);return{type:r,dataSource:pe,isLoading:C,loadMore:S,cancelOrder:I,updateOrder:P,cancelAlgoOrder:E,updateAlgoOrder:M,pagination:H,manualPagination:d,pnlNotionalDecimalPrecision:a,onFilter:L,filterItems:v,onCancelAll:Ne,onSymbolChange:s,sharePnLConfig:l,tableInstance:T,symbolsInfo:u}},Xu=(e,i)=>{var f,h;let[r,n]=c.useState(i.ordersStatus??"all"),[s,o]=c.useState(((f=i.filterConfig)==null?void 0:f.side)??"all"),a=((h=i.filterConfig)==null?void 0:h.range)??(e==="all"||e==="orderHistory"?Ki({to:new Date,from:dn(_e(new Date,7))}):{}),[l,u]=c.useState(a),d=x=>{x.name==="side"&&(o(x.value),i.setPage(1)),x.name==="status"&&(n(x.value),i.setPage(1)),x.name==="dateRange"&&(u(Ki(x.value)),i.setPage(1))};return{filterItems:c.useMemo(()=>{let x={type:"select",name:"side",options:[{label:"All sides",value:"all"},{label:"Buy",value:"BUY"},{label:"Sell",value:"SELL"}],value:s},b={type:"range",name:"dateRange",value:l},m={type:"select",name:"status",options:[{label:"All status",value:"all"},{label:"Pending",value:Z.INCOMPLETE},{label:"Filled",value:Z.FILLED},{label:"Partial filled",value:Z.PARTIAL_FILLED},{label:"Canceled",value:Z.CANCELLED},{label:"Rejected",value:Z.REJECTED}],value:r};switch(e){case"all":return[x,m,b];case"pending":return[x];case"tp_sl":return[x];case"filled":return[x];case"cancelled":return[x];case"rejected":return[x];case"orderHistory":return[x,m,b]}},[e,s,r,l]),onFilter:d,ordersSide:s==="all"?void 0:s,dateRange:l,orderStatus:r==="all"?void 0:r}};function Ju(e){if(e==null)return e;let i=new Date(e);return i.setHours(0,0,0,0),i}function dn(e){if(e==null)return e;let i=new Date(e);return i.setHours(23,59,59,999),i}var Ki=e=>({from:Ju(e.from),to:dn(e.to??e.from)}),Ye=c.forwardRef((e,i)=>{let{testIds:r,...n}=e,s=un({...n,ref:i});return t.jsx(Hu,{...s,testIds:r})}),cd=e=>{let i=un({...e,enableLoadMore:!0});return t.jsx(Ku,{...i,classNames:e.classNames,showFilter:e.showFilter})},Zu=e=>{let i={pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision};return t.jsxs(Gi,{defaultValue:e.current||"all",variant:"contained",className:"oui-h-full",classNames:{tabsContent:"oui-h-[calc(100%_-_28px)]"},children:[t.jsx($e,{value:"all",title:"All",children:t.jsx(Ye,{ref:e.orderListRef,type:"all",pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,...i})}),t.jsx($e,{value:"pending",title:"Pending",children:t.jsx(Ye,{ref:e.orderListRef,type:"pending",ordersStatus:Z.INCOMPLETE,...i})}),t.jsx($e,{value:"tp_sl",title:"TP/SL",children:t.jsx(Ye,{ref:e.orderListRef,type:"tp_sl",ordersStatus:Z.INCOMPLETE,...i})}),t.jsx($e,{value:"filled",title:"Filled",children:t.jsx(Ye,{ref:e.orderListRef,type:"filled",ordersStatus:Z.FILLED,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,...i})}),t.jsx($e,{value:"cancelled",title:"Cancelled",children:t.jsx(Ye,{ref:e.orderListRef,type:"cancelled",ordersStatus:Z.CANCELLED,...i})}),t.jsx($e,{value:"rejected",title:"Rejected",children:t.jsx(Ye,{ref:e.orderListRef,type:"rejected",ordersStatus:Z.REJECTED,...i})})]})},ed=(e=>(e.all="all",e.pending="pending",e.tp_sl="tp_sl",e.filled="filled",e.cancelled="cancelled",e.rejected="rejected",e.orderHistory="orderHistory",e))(ed||{}),pd=c.forwardRef((e,i)=>{let r=$l({...e,ref:i});return t.jsx(Zu,{...r})});export{hs as $,ud as D,dd as F,Ys as N,Ye as P,Ks as S,ps as a,yr as d,ad as i,cd as l,pd as m,ed as p,sd as q,ld as r,od as v};
