import{P as M,O as U,a as F,Y as J,U as K,b as Y,u as A,c as q,d as z,e as H,f as R,g as B,h as L,W as G,S as V,i as Q,j as X,k as Z,z as ee,l as P,A as _,m as b,n as te,o as re,p as ae,q as E,L as v,r as ne,s as se,t as D,C as le}from"./index-B30QhG-o.js";import{j as m,r as c}from"./jsx-runtime-CXrgMc3u.js";var ce=()=>{c.useEffect(()=>{let t=new URLSearchParams(window.location.search).get("ref");t&&localStorage.setItem("referral_code",t)},[])},N="orderly:wallet-info";function oe(){let{connectedChain:t,disconnect:e}=R(),[a,r]=B("orderly_selected_chainId",void 0),{account:s}=L(),{isMobile:d}=G(),f=async l=>{localStorage.removeItem(N),await s.disconnect(),await e({label:l})};c.useEffect(()=>{let l=x(),o=JSON.parse(localStorage.getItem(N)??"{}");l&&o&&f(o.label)},[]);let n=c.useCallback(async()=>{let l=x();if(!l)return;let{address:o,key:h,chainId:y}=l;if(!await s.importOrderlyKey(o,h))return;r(y);let p=new URL(window.location.href);p.searchParams.delete("link");let g=decodeURIComponent(p.toString());history.replaceState(null,"",g)},[s,t]);return c.useEffect(()=>{d&&!t&&n()},[s,t,d]),c.useEffect(()=>{let l=localStorage.getItem("orderly_selected_chainId");if(d&&!t&&l){let o=s.keyStore.getAddress(),h=s.keyStore.getOrderlyKey(),y=s.keyStore.getAccountId(o);s.checkOrderlyKey(o,h,y)}},[s,d,t]),{linkDevice:n}}function x(){let t=new URL(window.location.href).searchParams.get("link");if(!t)return;let{addr:e,k:a,id:r}=ie(t)||{};if(e&&a&&r)return{address:e,key:a,chainId:r}}function ie(t){try{let e=JSON.parse(window.atob(t)),a=Math.floor(Date.now()/1e3),r=e.t;return!r||a>r?void 0:e}catch{}}var j="orderly:wallet-info",de=t=>{let{wallet:e,connect:a,connectedChain:r,disconnect:s,namespace:d}=R();if(typeof a!="function")throw new V("Please provide a wallet connector provider");let f=c.useRef(!1),{account:n,state:l}=L(),o=Q(),h=X("networkId"),[y,{checkChainSupport:p}]=Z(),[g,I]=c.useState(!1),C=c.useMemo(()=>{var i,u;return(u=(i=e==null?void 0:e.accounts)==null?void 0:i[0])==null?void 0:u.address},[e]),w=c.useMemo(()=>{var S,k,O,$;let i=(k=(S=e==null?void 0:e.chains)==null?void 0:S[0])==null?void 0:k.id,u=($=(O=e==null?void 0:e.chains)==null?void 0:O[0])==null?void 0:$.namespace;if(!(typeof i>"u"))return{id:ee(i),namespace:u}},[e]);return c.useEffect(()=>{if(!r){I(!1);return}let i=p(r.id,h);I(!i)},[r,y,p,h]),c.useEffect(()=>{P(()=>{let i=o.getAddress(),u=JSON.parse(localStorage.getItem(j)??"{}");(r==null?void 0:r.namespace)!==le.solana&&i&&n.address!==i&&u.label&&a({autoSelect:{label:u.label,disableModals:!0}}).then(S=>{},S=>{})})},[e,n.address]),c.useEffect(()=>{if(e===null&&l.status>_.NotConnected&&!l.validating){n.disconnect();return}if(g||!r||f.current)return;let i=x();C&&C!==n.address&&!i&&(n.setAddress(C,{provider:e==null?void 0:e.provider,chain:{id:b(w.id),namespace:w.namespace.toUpperCase()},wallet:{name:e.label}}),P(()=>{localStorage.setItem(j,JSON.stringify({label:e.label}))})),(w==null?void 0:w.id)!==n.chainId&&n.switchChainId(w==null?void 0:w.id)},[e,r,C,w,n.address,l,n.chainId,g]),{connectWallet:async()=>(f.current=!0,a({chainId:t.currentChainId}).then(async i=>{if(Array.isArray(i)&&i.length>0&&i[0]&&i[0].accounts.length>0){let u=i[0],S=b(u.chains[0].id);if(!p(S,h))return{wrongNetwork:!0};if(!n)throw new Error("account is not initialized");l.status===_.EnableTradingWithoutConnected&&(localStorage.removeItem("orderly_selected_chainId"),await n.disconnect());let k=await n.setAddress(u.accounts[0].address,{provider:u.provider,chain:{id:b(u.chains[0].id),namespace:u.chains[0].namespace.toUpperCase()},wallet:{name:u.label}});return{wallet:u,status:k,wrongNetwork:!1}}return null}).finally(()=>{f.current=!1})),wrongNetwork:g}};function ue(){let t=A(),e=c.useRef({}),[a,r]=te("orderly_wallet_change_id",{});e.current=a,re({onMessage:s=>{let{id:d,side:f,transStatus:n}=s,l=!0;if(["DEPOSIT","WITHDRAW"].includes(f)&&["COMPLETED","FAILED"].includes(n)){let o=e.current[d];r({...a,[d]:o?void 0:!0}),l=!o}if(n==="COMPLETED"&&l){let o=`${v(f)} completed`;E.success(o)}else if(n==="FAILED"&&l){let o=`${v(f)} failed`;E.error(o)}t.emit("wallet:changed",s)}})}function fe(){ae({onMessage:t=>{let{status:e}=t;switch(e){case"COMPLETED":E.success("Settlement completed");break;case"FAILED":E.error("Settlement failed");break}}})}function he(){let t=A();return c.useEffect(()=>{t.on("wallet:connect-error",e=>{E.error(e.message)})},[t]),{}}var T=c.createContext({}),pe=()=>c.useContext(T),me=t=>{let[e,a]=c.useState();oe();let{connectWallet:r,wrongNetwork:s}=de({currentChainId:e});ue(),fe(),he();let d=H((t==null?void 0:t.restrictedInfo)??{});return m.jsx(T.Provider,{value:{connectWallet:r,wrongNetwork:s,currentChainId:e,setCurrentChainId:a,onChainChanged:t.onChainChanged,restrictedInfo:d},children:t.children})},W=c.createContext({}),Ce=()=>c.useContext(W),ge=t=>m.jsx(W.Provider,{value:t,children:t.children});function ye(t,e){let{symbol:a,side:r,quantity:s}=t,d="total_executed_quantity"in t?t.total_executed_quantity:0,f="status"in t?t.status:t.algo_status,n=e[a],l=n("base_dp"),o=v(r),h=ne(a),y="algo_type"in t&&t.algo_type===se.POSITIONAL_TP_SL?"Entire position":l===void 0?s:D(s,{dp:l}),p="",g="";switch(f){case"NEW":p="Order opened",g=`${o} ${h} ${y}`;break;case"FILLED":case"PARTIAL_FILLED":let I=l===void 0?d:D(d,{dp:l});p="Order filled",g=`${o} ${h} ${I} / ${y}`;break;case"CANCELLED":p="Order cancelled",g=`${o} ${h} ${y}`;break;case"REJECTED":p="Order rejected",g=`${o} ${h} ${y}`;break;case"REPLACED":p="Order edited",g=`${r} ${h} ${d} / ${y}`;break}return{title:p,msg:g}}function we(){let t=A(),e=q(),a=c.useRef({});c.useEffect(()=>{a.current=e},[e]);let r=z(s=>{(d=>{let{title:f,msg:n}=ye(d,a.current);f&&n&&E.success(m.jsxs("div",{children:[f,m.jsx("br",{}),m.jsx("div",{className:"orderly-text-white/[0.54] orderly-text-xs",children:n})]}))})(s)},100);c.useEffect(()=>(t.on("orders:changed",r),()=>{t.off("orders:changed",r)}),[])}var Se=t=>{let{onChainChanged:e,components:a,appIcons:r,...s}=t;return ce(),we(),m.jsx(ge,{appIcons:r,brokerName:t.brokerName,children:m.jsx(M,{components:a,overrides:t.overrides,children:m.jsxs(U,{...s,children:[m.jsx(me,{onChainChanged:e,restrictedInfo:t.restrictedInfo,children:m.jsx(F,{children:m.jsx(J,{delayDuration:300,children:m.jsx(K,{children:t.children})})})}),m.jsx(Y,{})]})})})};Se.displayName="OrderlyAppProvider";var ke=(t,e)=>{let{wrongNetwork:a}=pe(),{state:r}=L();return e!=null&&e.skip?t:a||typeof(e==null?void 0:e.accountStatus)<"u"&&r.status<e.accountStatus?typeof(e==null?void 0:e.fallbackData)<"u"?e.fallbackData:null:t};export{Se as G,Ce as T,ke as Y,pe as w};
